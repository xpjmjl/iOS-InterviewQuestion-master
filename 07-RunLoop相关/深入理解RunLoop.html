<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="zh-CN">
<!--<![endif]-->
<head>
	<meta charset="UTF-8" />
	<title>深入理解RunLoop | Garan no dou</title>
			
	
	<link rel="pingback" href="https://blog.ibireme.com/xmlrpc.php" />

		<!--[if lt IE 9]>
	<script src="https://blog.ibireme.com/wp-content/themes/Divi/js/html5.js" type="text/javascript"></script>
	<![endif]-->

	<script type="text/javascript">
		document.documentElement.className = 'js';
	</script>

	<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Garan no dou &raquo; Feed" href="https://blog.ibireme.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Garan no dou &raquo; 评论Feed" href="https://blog.ibireme.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Garan no dou &raquo; 深入理解RunLoop评论Feed" href="https://blog.ibireme.com/2015/05/18/runloop/feed/" />
<meta content="Divi v.2.5.3" name="generator"/><link rel='stylesheet' id='scap.flashblock-css'  href='https://blog.ibireme.com/wp-content/plugins/compact-wp-audio-player/css/flashblock.css?ver=5.2.5' type='text/css' media='all' />
<link rel='stylesheet' id='scap.player-css'  href='https://blog.ibireme.com/wp-content/plugins/compact-wp-audio-player/css/player.css?ver=5.2.5' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-css'  href='https://blog.ibireme.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-familiar-mynew-css'  href='https://blog.ibireme.com/wp-content/uploads/crayon-syntax-highlighter/themes/familiar-mynew/familiar-mynew.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-consolas-css'  href='https://blog.ibireme.com/wp-content/plugins/crayon-syntax-highlighter/fonts/consolas.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-easyarchives-css'  href='https://blog.ibireme.com/wp-content/plugins/wp-easyarchives/css/wp-easyarchives.css?ver=3.1.2' type='text/css' media='screen' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://blog.ibireme.com/wp-includes/css/dist/block-library/style.min.css?ver=5.2.5' type='text/css' media='all' />
<link rel='stylesheet' id='math-captcha-frontend-css'  href='https://blog.ibireme.com/wp-content/plugins/wp-math-captcha/css/frontend.css?ver=5.2.5' type='text/css' media='all' />
<link rel='stylesheet' id='wp-pagenavi-css'  href='https://blog.ibireme.com/wp-content/plugins/wp-pagenavi/pagenavi-css.css?ver=2.70' type='text/css' media='all' />
<link rel='stylesheet' id='divi-fonts-css'  href='https://fonts.googleapis.ibireme.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='et-gf-chinese-css'  href='//fonts.googleapis.ibireme.com/earlyaccess/cwtexfangsong.css' type='text/css' media='all' />
<link rel='stylesheet' id='divi-style-css'  href='https://blog.ibireme.com/wp-content/themes/Divi/style.css?ver=2.5.3' type='text/css' media='all' />
<link rel='stylesheet' id='et-shortcodes-css-css'  href='https://blog.ibireme.com/wp-content/themes/Divi/epanel/shortcodes/css/shortcodes.css?ver=3.0' type='text/css' media='all' />
<link rel='stylesheet' id='et-shortcodes-responsive-css-css'  href='https://blog.ibireme.com/wp-content/themes/Divi/epanel/shortcodes/css/shortcodes_responsive.css?ver=3.0' type='text/css' media='all' />
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/plugins/compact-wp-audio-player/js/soundmanager2-nodebug-jsmin.js?ver=5.2.5'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/blog.ibireme.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/plugins/simplesmileyshow/jquery.insertatcaret.js'></script>
<link rel='https://api.w.org/' href='https://blog.ibireme.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.ibireme.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.ibireme.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='2015年了呢&#8230;' href='https://blog.ibireme.com/2015/01/02/2015/' />
<link rel='next' title='最近一段时间的工作整理' href='https://blog.ibireme.com/2015/10/23/daily/' />
<meta name="generator" content="WordPress 5.2.5" />
<link rel="canonical" href="https://blog.ibireme.com/2015/05/18/runloop/" />
<link rel='shortlink' href='https://blog.ibireme.com/?p=41710' />
<link rel="alternate" type="application/json+oembed" href="https://blog.ibireme.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.ibireme.com%2F2015%2F05%2F18%2Frunloop%2F" />

<!-- Generated By Show-UserAgent 1.0.8 - http://zlz.im/show-useragent/ -->
<link rel="stylesheet" href="https://blog.ibireme.com/wp-content/plugins/show-useragent/show-useragent.css" type="text/css" media="screen" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />		<style id="theme-customizer-css">
													.woocommerce #respond input#submit, .woocommerce-page #respond input#submit, .woocommerce #content input.button, .woocommerce-page #content input.button, .woocommerce-message, .woocommerce-error, .woocommerce-info { background: #a9d300 !important; }
			#et_search_icon:hover, .mobile_menu_bar:before, .et-social-icon a:hover, .et_pb_sum, .et_pb_pricing li a, .et_pb_pricing_table_button, .et_overlay:before, .entry-summary p.price ins, .woocommerce div.product span.price, .woocommerce-page div.product span.price, .woocommerce #content div.product span.price, .woocommerce-page #content div.product span.price, .woocommerce div.product p.price, .woocommerce-page div.product p.price, .woocommerce #content div.product p.price, .woocommerce-page #content div.product p.price, .et_pb_member_social_links a:hover, .woocommerce .star-rating span:before, .woocommerce-page .star-rating span:before, .et_pb_widget li a:hover, .et_pb_filterable_portfolio .et_pb_portfolio_filters li a.active, .et_pb_filterable_portfolio .et_pb_portofolio_pagination ul li a.active, .et_pb_gallery .et_pb_gallery_pagination ul li a.active, .wp-pagenavi span.current, .wp-pagenavi a:hover, .nav-single a, .posted_in a { color: #a9d300; }
			.et_pb_contact_submit, .et_password_protected_form .et_submit_button, .et_pb_bg_layout_light .et_pb_newsletter_button, .comment-reply-link, .form-submit input, .et_pb_bg_layout_light .et_pb_promo_button, .et_pb_bg_layout_light .et_pb_more_button, .woocommerce a.button.alt, .woocommerce-page a.button.alt, .woocommerce button.button.alt, .woocommerce-page button.button.alt, .woocommerce input.button.alt, .woocommerce-page input.button.alt, .woocommerce #respond input#submit.alt, .woocommerce-page #respond input#submit.alt, .woocommerce #content input.button.alt, .woocommerce-page #content input.button.alt, .woocommerce a.button, .woocommerce-page a.button, .woocommerce button.button, .woocommerce-page button.button, .woocommerce input.button, .woocommerce-page input.button { color: #a9d300; }
			.footer-widget h4 { color: #a9d300; }
			.et-search-form, .nav li ul, .et_mobile_menu, .footer-widget li:before, .et_pb_pricing li:before, blockquote { border-color: #a9d300; }
			.et_pb_counter_amount, .et_pb_featured_table .et_pb_pricing_heading, .et_quote_content, .et_link_content, .et_audio_content { background-color: #a9d300; }
							.container, .et_pb_row, .et_pb_slider .et_pb_container, .et_pb_fullwidth_section .et_pb_title_container, .et_pb_fullwidth_section .et_pb_title_featured_container, .et_pb_fullwidth_header:not(.et_pb_fullscreen) .et_pb_fullwidth_header_container { max-width: 960px; }
			.et_boxed_layout #page-container, .et_fixed_nav.et_boxed_layout #page-container #top-header, .et_fixed_nav.et_boxed_layout #page-container #main-header, .et_boxed_layout #page-container .container, .et_boxed_layout #page-container .et_pb_row { max-width: 1120px; }
							a { color: #209afc; }
													#top-header, #et-secondary-nav li ul { background-color: #a9d300; }
								#top-header, #top-header a { color: rgba(0,0,0,0.7); }
												
		
					#top-menu li.current-menu-ancestor > a, #top-menu li.current-menu-item > a,
			.et_color_scheme_red #top-menu li.current-menu-ancestor > a, .et_color_scheme_red #top-menu li.current-menu-item > a,
			.et_color_scheme_pink #top-menu li.current-menu-ancestor > a, .et_color_scheme_pink #top-menu li.current-menu-item > a,
			.et_color_scheme_orange #top-menu li.current-menu-ancestor > a, .et_color_scheme_orange #top-menu li.current-menu-item > a,
			.et_color_scheme_green #top-menu li.current-menu-ancestor > a, .et_color_scheme_green #top-menu li.current-menu-item > a { color: #209afc; }
													#main-footer .footer-widget h4 { color: #a9d300; }
							.footer-widget li:before { border-color: #a9d300; }
																
		
		
		@media only screen and ( min-width: 981px ) {
																																								.et-fixed-header#top-header, .et-fixed-header#top-header #et-secondary-nav li ul { background-color: #a9d300; }
																			.et-fixed-header #top-menu li.current-menu-ancestor > a,
				.et-fixed-header #top-menu li.current-menu-item > a { color: #209afc !important; }
										.et-fixed-header#top-header a { color: rgba(0,0,0,0.7); }
			
					}
		@media only screen and ( min-width: 1200px) {
			.et_pb_row { padding: 24px 0; }
			.et_pb_section { padding: 48px 0; }
			.single.et_pb_pagebuilder_layout.et_full_width_page .et_post_meta_wrapper { padding-top: 72px; }
			.et_pb_section.et_pb_section_first { padding-top: inherit; }
			.et_pb_fullwidth_section { padding: 0; }
		}
		@media only screen and ( max-width: 980px ) {
																				}
		@media only screen and ( max-width: 767px ) {
														}
	</style>

	<style class="et_one_font_languages">h1, h2, h3, h4, h5, h6, body, input, textarea, select { font-family: 'cwTeXFangSong', serif; }</style>
	
	<style id="module-customizer-css">
			</style>

	<!-- All in one Favicon 4.7 --><link rel="icon" href="https://blog.ibireme.com/wp-content/uploads/2013/08/favicon.png" type="image/png"/>
<link rel="apple-touch-icon-precomposed" href="https://blog.ibireme.com/wp-content/uploads/2013/08/favicon2.png" />
<style type="text/css" id="et-custom-css">
h1, h2, h3, h4, h5, h6, body, input, textarea, select {
font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, Verdana, 'Hiragino Sans GB', 'Noto Sans CJK SC', 'Source Han Sans CN', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;
font-weight: 400;
}

body { 
	font-size: 16px;
	color: #1d1d1d;
	word-wrap:break-word;
	word-break: normal;
}

p {
	margin: 0.9em 0 0.5em;
	padding-bottom: 0.6em;
	font-size: 100%;
	vertical-align: baseline;
}

.et_pb_post h2 {
	font-weight: bold;
}

.et_pb_post .post-meta {
	14px "Classic Grotesque W01", Arial, sans-serif;
}

.et_pb_post {
	border-bottom: 1px solid #e2e2e2;
	padding-bottom: 20px;
}

.et_pb_post:last-of-type {
	border-bottom: 0px solid #e2e2e2;
}

#main-content .container {
	padding-top: 30px;
}

.et_right_sidebar #sidebar {
	padding-top: 30px;
}

.home #content-area #left-area {
	padding-top: 0px;
}

.single-post #content-area #left-area {
	padding-top: 30px;
}

.et_pb_post {
  margin-bottom: 40px;
}

.et_pb_post .entry-content, 
.project .entry-content {
  padding-top: 10px;
}

.widget_aboutmewidget .clearfix,
.et_pb_widget li {
	font-size: 93%;
}

.widgettitle {
	font-size: 120%;
}

.et_pb_scroll_top {
    bottom: 15px;
}

#top-menu li > a, 
.fullwidth-menu li > a {
	font-size: 14px;
	font-weight: 400;
}

#footer-bottom {
	padding: 5px 0 7px;
}

img.wp-smiley {
	max-height: 1.2em !important;
	height: 1.2em !important;
	width: 1.2em !important;
}

.wp-smileylink {
	max-width: 22px !important;
}

#left-area a:hover {
	text-decoration: underline;
}

#commentform textarea, 
#commentform input[type="text"] {
    font-size: 16px;
}

@media only screen and ( max-width: 767px ) {
	.et_pb_row, .container, .et_pb_container { width: 85%; }
	.et_pb_post h2, .et_pb_portfolio_item h2 { font-size: 24px; }
	.comment-body { padding: 0 0 25px 100px; }
}

#dynamic-to-top {
	display:none;
	overflow:hidden;
	width:auto;
	z-index:90;
	position:fixed;
	top:auto;
	left:auto;
	font-family:sans-serif;
	font-size:1em;
	color:#fff;
	text-decoration:none;
	text-shadow:0 1px 0 #333;
	font-weight:bold;
	padding:17px 16px;
	border:0px solid #000;
	background:#111;
	-webkit-background-origin:border;
	-moz-background-origin:border;
	-icab-background-origin:border;
	-khtml-background-origin:border;
	-o-background-origin:border;
	background-origin:border;
	-webkit-background-clip:padding-box;
	-moz-background-clip:padding-box;
	-icab-background-clip:padding-box;
	-khtml-background-clip:padding-box;
	-o-background-clip:padding-box;
	background-clip:padding-box;
	-webkit-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-ms-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-moz-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-o-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-khtml-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-icab-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-webkit-border-radius:23px;
	-moz-border-radius:23px;
	-icab-border-radius:23px;
	-khtml-border-radius:23px;
	border-radius:23px
}
#dynamic-to-top:hover {
	background:#4d4dac;
	background:#08f -webkit-gradient( linear, 0% 0%, 0% 100%, from( rgba( 255, 255, 255, .2 ) ), to( rgba( 0, 0, 0, 0 ) ) );
	background:#08f -webkit-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f -khtml-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f -moz-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f -o-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f -ms-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f -icab-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	cursor:pointer
}
#dynamic-to-top:active {
	background:#111;
	background:#111 -webkit-gradient( linear, 0% 0%, 0% 100%, from( rgba( 0, 0, 0, .3 ) ), to( rgba( 0, 0, 0, 0 ) ) );
	background:#111 -webkit-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 -moz-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 -khtml-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 -o-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 -ms-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 -icab-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) )
}
#dynamic-to-top,#dynamic-to-top:active,#dynamic-to-top:focus,#dynamic-to-top:hover {
	outline:none
}
#dynamic-to-top span {
	display:block;
	overflow:hidden;
	width:14px;
	height:12px;
	background:url(/wp-content/plugins/dynamic-to-top/css/images/up.png )no-repeat center center
}

.entry-content table, body.et-pb-preview #main-content .container table {
    border: 1px solid #C1C1C1;
    line-height: 1.4em;

    border-collapse: separate;
}

thead {
	background-color: #F1F1F1;
}

p#copyright {
    color: #717171;
}
</style></head>
<body class="post-template-default single single-post postid-41710 single-format-standard et_pb_button_helper_class et_fixed_nav et_show_nav et_cover_background et_pb_gutter osx et_pb_gutters3 et_primary_nav_dropdown_animation_fade et_secondary_nav_dropdown_animation_fade et_pb_footer_columns4 et_header_style_left et_right_sidebar chrome">
	<div id="page-container">

	
		<header id="main-header" data-height-onload="66">
			<div class="container clearfix et_menu_container">
							<div class="logo_container">
					<span class="logo_helper"></span>
					<a href="https://blog.ibireme.com/">
						<img src="https://blog.ibireme.com/wp-content/uploads/2015/05/logo1.png" alt="Garan no dou" id="logo" data-height-percentage="54" />
					</a>
				</div>
				<div id="et-top-navigation" data-height="66" data-fixed-height="40">
					<nav id="top-menu-nav">
											<ul id="top-menu" class="nav">
															<li ><a href="https://blog.ibireme.com/">首页</a></li>
							
							<li class="page_item page-item-34"><a href="https://blog.ibireme.com/about/">About</a></li>
<li class="page_item page-item-41502"><a href="https://blog.ibireme.com/archive/">Archive</a></li>
								<li class="cat-item cat-item-4"><a href="https://blog.ibireme.com/category/acg/">ACG</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://blog.ibireme.com/category/other/">其他</a>
</li>
	<li class="cat-item cat-item-10"><a href="https://blog.ibireme.com/category/chirrup/">吐槽</a>
</li>
	<li class="cat-item cat-item-11"><a href="https://blog.ibireme.com/category/tec/">技术</a>
<ul class='children'>
	<li class="cat-item cat-item-30"><a href="https://blog.ibireme.com/category/tec/ios-tec/">iOS</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-7"><a href="https://blog.ibireme.com/category/daily/">日常</a>
</li>
	<li class="cat-item cat-item-12"><a href="https://blog.ibireme.com/category/design/">设计</a>
</li>
						</ul>
										</nav>

					
					
					<div id="et_mobile_nav_menu">
			<div class="mobile_nav closed">
				<span class="select_page">选择页面</span>
				<span class="mobile_menu_bar"></span>
			</div>
		</div>				</div> <!-- #et-top-navigation -->
			</div> <!-- .container -->
			<div class="et_search_outer">
				<div class="container et_search_form_container">
					<form role="search" method="get" class="et-search-form" action="https://blog.ibireme.com/">
					<input type="search" class="et-search-field" placeholder="搜索 &hellip;" value="" name="s" title="搜索：" />					</form>
					<span class="et_close_search_field"></span>
				</div>
			</div>
		</header> <!-- #main-header -->

		<div id="et-main-area">
<div id="main-content">
	<div class="container">
		<div id="content-area" class="clearfix">
			<div id="left-area">
							
				<article id="post-41710" class="et_pb_post post-41710 post type-post status-publish format-standard hentry category-ios-tec category-tec">
											<div class="et_post_meta_wrapper">
							<h1>深入理解RunLoop</h1>

						<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2015-05-18 | <a href="https://blog.ibireme.com/category/tec/ios-tec/" rel="category tag">iOS</a>, <a href="https://blog.ibireme.com/category/tec/" rel="category tag">技术</a></p>
												</div> <!-- .et_post_meta_wrapper -->
				
					<div class="entry-content">
					<p>RunLoop 是 iOS 和 OSX 开发中非常基础的一个概念，这篇文章将从 CFRunLoop 的源码入手，介绍 RunLoop 的概念以及底层实现原理。之后会介绍一下在 iOS 中，苹果是如何利用 RunLoop 实现自动释放池、延迟回调、触摸事件、屏幕刷新等功能的。</p>
<p>Index<br />
<a href="#base">RunLoop 的概念</a><br />
<a href="#thread">RunLoop 与线程的关系</a><br />
<a href="#api">RunLoop 对外的接口</a><br />
<a href="#mode">RunLoop 的 Mode</a><br />
<a href="#inner">RunLoop 的内部逻辑</a><br />
<a href="#core">RunLoop 的底层实现</a><br />
<a href="#apple">苹果用 RunLoop 实现的功能</a><br />
<a style="padding-left: 30px;" href="#autorelease">AutoreleasePool</a><br />
<a style="padding-left: 30px;" href="#event">事件响应</a><br />
<a style="padding-left: 30px;" href="#gesture">手势识别</a><br />
<a style="padding-left: 30px;" href="#ui">界面更新</a><br />
<a style="padding-left: 30px;" href="#timer">定时器</a><br />
<a style="padding-left: 30px;" href="#perform">PerformSelecter</a><br />
<a style="padding-left: 30px;" href="#gce">关于GCD</a><br />
<a style="padding-left: 30px;" href="#network">关于网络请求</a><br />
<a href="#example">RunLoop 的实际应用举例</a><br />
<a style="padding-left: 30px;" href="#AFNetworking">AFNetworking</a><br />
<a style="padding-left: 30px;" href="#AsyncDisplayKit">AsyncDisplayKit</a></p>
<p><span id="more-41710"></span></p>
<p><a name="base"></a></p>
<h2>RunLoop 的概念</h2>
<p>一般来讲，一个线程一次只能执行一个任务，执行完成后线程就会退出。如果我们需要一个机制，让线程能随时处理事件但并不退出，通常的代码逻辑是这样的：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e840039611959" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
function loop() {
    initialize();
    do {
        var message = get_next_message();
        process_message(message);
    } while (message != quit);
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e840039611959-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e840039611959-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e840039611959-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e840039611959-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e840039611959-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e840039611959-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e840039611959-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e840039611959-1"><span class="crayon-t">function</span><span class="crayon-h"> </span><span class="crayon-e">loop</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e840039611959-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">initialize</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e840039611959-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">do</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e840039611959-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">message</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_next_message</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e840039611959-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">process_message</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e840039611959-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-v">quit</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e840039611959-7"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>这种模型通常被称作 <a href="http://en.wikipedia.org/wiki/Event_loop" target="_blank">Event Loop</a>。 Event Loop 在很多系统和框架里都有实现，比如 Node.js 的事件处理，比如 Windows 程序的消息循环，再比如 OSX/iOS 里的 RunLoop。实现这种模型的关键点在于：如何管理事件/消息，如何让线程在没有处理消息时休眠以避免资源占用、在有消息到来时立刻被唤醒。</p>
<p>所以，RunLoop 实际上就是一个对象，这个对象管理了其需要处理的事件和消息，并提供了一个入口函数来执行上面 Event Loop 的逻辑。线程执行了这个函数后，就会一直处于这个函数内部 &#8220;接受消息-&gt;等待-&gt;处理&#8221; 的循环中，直到这个循环结束（比如传入 quit 的消息），函数返回。</p>
<p>OSX/iOS 系统中，提供了两个这样的对象：NSRunLoop 和 CFRunLoopRef。<br />
CFRunLoopRef 是在 CoreFoundation 框架内的，它提供了纯 C 函数的 API，所有这些 API 都是线程安全的。<br />
NSRunLoop 是基于 CFRunLoopRef 的封装，提供了面向对象的 API，但是这些 API 不是线程安全的。</p>
<p>CFRunLoopRef 的代码是<a href="http://opensource.apple.com/source/CF/CF-855.17/CFRunLoop.c" target="_blank">开源</a>的，你可以在这里 <a href="http://opensource.apple.com/tarballs/CF/" target="_blank">http://opensource.apple.com/tarballs/CF/</a> 下载到整个 CoreFoundation 的源码来查看。</p>
<p>(Update: Swift 开源后，苹果又维护了一个跨平台的 CoreFoundation 版本：<a href="https://github.com/apple/swift-corelibs-foundation/" target="_blank">https://github.com/apple/swift-corelibs-foundation/</a>，这个版本的源码可能和现有 iOS 系统中的实现略不一样，但更容易编译，而且已经适配了 Linux/Windows。)</p>
<p><a name="thread"></a></p>
<h2>RunLoop 与线程的关系</h2>
<p>首先，iOS 开发中能遇到两个线程对象: pthread_t 和 NSThread。过去苹果有份<a href="http://www.fenestrated.net/~macman/mirrors/Apple%20Technotes%20(As%20of%202002)/tn/tn2028.html" target="_blank">文档</a>标明了 NSThread 只是 pthread_t 的封装，但那份文档已经失效了，现在它们也有可能都是直接包装自最底层的 mach thread。苹果并没有提供这两个对象相互转换的接口，但不管怎么样，可以肯定的是 pthread_t 和 NSThread 是一一对应的。比如，你可以通过 pthread_main_thread_np() 或 [NSThread mainThread] 来获取主线程；也可以通过 pthread_self() 或 [NSThread currentThread] 来获取当前线程。CFRunLoop 是基于 pthread 来管理的。</p>
<p>苹果不允许直接创建 RunLoop，它只提供了两个自动获取的函数：CFRunLoopGetMain() 和 CFRunLoopGetCurrent()。 这两个函数内部的逻辑大概是下面这样:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e848582851403" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
/// 全局的Dictionary，key 是 pthread_t， value 是 CFRunLoopRef
static CFMutableDictionaryRef loopsDic;
/// 访问 loopsDic 时的锁
static CFSpinLock_t loopsLock;

/// 获取一个 pthread 对应的 RunLoop。
CFRunLoopRef _CFRunLoopGet(pthread_t thread) {
    OSSpinLockLock(&amp;loopsLock);
    
    if (!loopsDic) {
        // 第一次进入时，初始化全局Dic，并先为主线程创建一个 RunLoop。
        loopsDic = CFDictionaryCreateMutable();
        CFRunLoopRef mainLoop = _CFRunLoopCreate();
        CFDictionarySetValue(loopsDic, pthread_main_thread_np(), mainLoop);
    }
    
    /// 直接从 Dictionary 里获取。
    CFRunLoopRef loop = CFDictionaryGetValue(loopsDic, thread));
    
    if (!loop) {
        /// 取不到时，创建一个
        loop = _CFRunLoopCreate();
        CFDictionarySetValue(loopsDic, thread, loop);
        /// 注册一个回调，当线程销毁时，顺便也销毁其对应的 RunLoop。
        _CFSetTSD(..., thread, loop, __CFFinalizeRunLoop);
    }
    
    OSSpinLockUnLock(&amp;loopsLock);
    return loop;
}

CFRunLoopRef CFRunLoopGetMain() {
    return _CFRunLoopGet(pthread_main_thread_np());
}

CFRunLoopRef CFRunLoopGetCurrent() {
    return _CFRunLoopGet(pthread_self());
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-8">8</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-9">9</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-10">10</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-11">11</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-12">12</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-13">13</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-14">14</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-15">15</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-16">16</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-17">17</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-18">18</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-19">19</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-20">20</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-21">21</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-22">22</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-23">23</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-24">24</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-25">25</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-26">26</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-27">27</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-28">28</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-29">29</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-30">30</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-31">31</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-32">32</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-33">33</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-34">34</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-35">35</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-36">36</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-37">37</div><div class="crayon-num" data-line="crayon-5e40242e3e848582851403-38">38</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e848582851403-1"><span class="crayon-c">/// 全局的Dictionary，key 是 pthread_t， value 是 CFRunLoopRef</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-2"><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">CFMutableDictionaryRef </span><span class="crayon-v">loopsDic</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-3"><span class="crayon-c">/// 访问 loopsDic 时的锁</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-4"><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">CFSpinLock_t </span><span class="crayon-v">loopsLock</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-5">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e848582851403-6"><span class="crayon-c">/// 获取一个 pthread 对应的 RunLoop。</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-7"><span class="crayon-e">CFRunLoopRef </span><span class="crayon-e">_CFRunLoopGet</span><span class="crayon-sy">(</span><span class="crayon-e">pthread_t </span><span class="crayon-v">thread</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">OSSpinLockLock</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-v">loopsLock</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">loopsDic</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// 第一次进入时，初始化全局Dic，并先为主线程创建一个 RunLoop。</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">loopsDic</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">CFDictionaryCreateMutable</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopRef </span><span class="crayon-v">mainLoop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">_CFRunLoopCreate</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFDictionarySetValue</span><span class="crayon-sy">(</span><span class="crayon-v">loopsDic</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">pthread_main_thread_np</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mainLoop</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 直接从 Dictionary 里获取。</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopRef </span><span class="crayon-v">loop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">CFDictionaryGetValue</span><span class="crayon-sy">(</span><span class="crayon-v">loopsDic</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thread</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">loop</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 取不到时，创建一个</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">loop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">_CFRunLoopCreate</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFDictionarySetValue</span><span class="crayon-sy">(</span><span class="crayon-v">loopsDic</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thread</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loop</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 注册一个回调，当线程销毁时，顺便也销毁其对应的 RunLoop。</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">_CFSetTSD</span><span class="crayon-sy">(</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thread</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">__CFFinalizeRunLoop</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">OSSpinLockUnLock</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-v">loopsLock</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">loop</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-30"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-31">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e848582851403-32"><span class="crayon-e">CFRunLoopRef </span><span class="crayon-e">CFRunLoopGetMain</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">_CFRunLoopGet</span><span class="crayon-sy">(</span><span class="crayon-e">pthread_main_thread_np</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-34"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-35">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e848582851403-36"><span class="crayon-e">CFRunLoopRef </span><span class="crayon-e">CFRunLoopGetCurrent</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">_CFRunLoopGet</span><span class="crayon-sy">(</span><span class="crayon-e">pthread_self</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e848582851403-38"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>从上面的代码可以看出，线程和 RunLoop 之间是一一对应的，其关系是保存在一个全局的 Dictionary 里。线程刚创建时并没有 RunLoop，如果你不主动获取，那它一直都不会有。RunLoop 的创建是发生在第一次获取时，RunLoop 的销毁是发生在线程结束时。你只能在一个线程的内部获取其 RunLoop（主线程除外）。</p>
<p><a name="api"></a></p>
<h2>RunLoop 对外的接口</h2>
<p>在 CoreFoundation 里面关于 RunLoop 有5个类:</p>
<p>CFRunLoopRef<br />
CFRunLoopModeRef<br />
CFRunLoopSourceRef<br />
CFRunLoopTimerRef<br />
CFRunLoopObserverRef</p>
<p>其中 CFRunLoopModeRef 类并没有对外暴露，只是通过 CFRunLoopRef 的接口进行了封装。他们的关系如下:<br />
<a href="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_0.png"><img class="alignnone wp-image-41721" src="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_0.png" alt="RunLoop_0" width="345" height="271" /></a></p>
<p>一个 RunLoop 包含若干个 Mode，每个 Mode 又包含若干个 Source/Timer/Observer。每次调用 RunLoop 的主函数时，只能指定其中一个 Mode，这个Mode被称作 CurrentMode。如果需要切换 Mode，只能退出 Loop，再重新指定一个 Mode 进入。这样做主要是为了分隔开不同组的 Source/Timer/Observer，让其互不影响。</p>
<p><strong>CFRunLoopSourceRef</strong> 是事件产生的地方。Source有两个版本：Source0 和 Source1。<br />
• Source0 只包含了一个回调（函数指针），它并不能主动触发事件。使用时，你需要先调用 CFRunLoopSourceSignal(source)，将这个 Source 标记为待处理，然后手动调用 CFRunLoopWakeUp(runloop) 来唤醒 RunLoop，让其处理这个事件。<br />
• Source1 包含了一个 mach_port 和一个回调（函数指针），被用于通过内核和其他线程相互发送消息。这种 Source 能主动唤醒 RunLoop 的线程，其原理在下面会讲到。</p>
<p><strong>CFRunLoopTimerRef</strong> 是基于时间的触发器，它和 NSTimer 是toll-free bridged 的，可以混用。其包含一个时间长度和一个回调（函数指针）。当其加入到 RunLoop 时，RunLoop会注册对应的时间点，当时间点到时，RunLoop会被唤醒以执行那个回调。</p>
<p><strong>CFRunLoopObserverRef</strong> 是观察者，每个 Observer 都包含了一个回调（函数指针），当 RunLoop 的状态发生变化时，观察者就能通过回调接受到这个变化。可以观测的时间点有以下几个：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e84b400554697" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) {
    kCFRunLoopEntry         = (1UL &lt;&lt; 0), // 即将进入Loop
    kCFRunLoopBeforeTimers  = (1UL &lt;&lt; 1), // 即将处理 Timer
    kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), // 即将处理 Source
    kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), // 即将进入休眠
    kCFRunLoopAfterWaiting  = (1UL &lt;&lt; 6), // 刚从休眠中唤醒
    kCFRunLoopExit          = (1UL &lt;&lt; 7), // 即将退出Loop
};</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e84b400554697-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e84b400554697-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e84b400554697-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e84b400554697-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e84b400554697-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e84b400554697-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e84b400554697-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e84b400554697-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e84b400554697-1"><span class="crayon-r">typedef</span><span class="crayon-h"> </span><span class="crayon-e">CF_OPTIONS</span><span class="crayon-sy">(</span><span class="crayon-v">CFOptionFlags</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">CFRunLoopActivity</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e84b400554697-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">kCFRunLoopEntry</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1UL</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-c">// 即将进入Loop</span></div><div class="crayon-line" id="crayon-5e40242e3e84b400554697-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">kCFRunLoopBeforeTimers</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1UL</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-c">// 即将处理 Timer</span></div><div class="crayon-line" id="crayon-5e40242e3e84b400554697-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">kCFRunLoopBeforeSources</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1UL</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-c">// 即将处理 Source</span></div><div class="crayon-line" id="crayon-5e40242e3e84b400554697-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">kCFRunLoopBeforeWaiting</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1UL</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-c">// 即将进入休眠</span></div><div class="crayon-line" id="crayon-5e40242e3e84b400554697-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">kCFRunLoopAfterWaiting</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1UL</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">6</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-c">// 刚从休眠中唤醒</span></div><div class="crayon-line" id="crayon-5e40242e3e84b400554697-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">kCFRunLoopExit</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1UL</span><span class="crayon-h"> </span><span class="crayon-o">&lt;&lt;</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-c">// 即将退出Loop</span></div><div class="crayon-line" id="crayon-5e40242e3e84b400554697-8"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>上面的 Source/Timer/Observer 被统称为 <strong>mode item</strong>，一个 item 可以被同时加入多个 mode。但一个 item 被重复加入同一个 mode 时是不会有效果的。如果一个 mode 中一个 item 都没有，则 RunLoop 会直接退出，不进入循环。</p>
<p><a name="mode"></a></p>
<h2>RunLoop 的 Mode</h2>
<p>CFRunLoopMode 和 CFRunLoop 的结构大致如下：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e84d693962180" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
struct __CFRunLoopMode {
    CFStringRef _name;            // Mode Name, 例如 @"kCFRunLoopDefaultMode"
    CFMutableSetRef _sources0;    // Set
    CFMutableSetRef _sources1;    // Set
    CFMutableArrayRef _observers; // Array
    CFMutableArrayRef _timers;    // Array
    ...
};

struct __CFRunLoop {
    CFMutableSetRef _commonModes;     // Set
    CFMutableSetRef _commonModeItems; // Set&lt;Source/Observer/Timer&gt;
    CFRunLoopModeRef _currentMode;    // Current Runloop Mode
    CFMutableSetRef _modes;           // Set
    ...
};</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-8">8</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-9">9</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-10">10</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-11">11</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-12">12</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-13">13</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-14">14</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-15">15</div><div class="crayon-num" data-line="crayon-5e40242e3e84d693962180-16">16</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e84d693962180-1"><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e">__CFRunLoopMode</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFStringRef </span><span class="crayon-v">_name</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Mode Name, 例如 @"kCFRunLoopDefaultMode"</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFMutableSetRef </span><span class="crayon-v">_sources0</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Set</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFMutableSetRef </span><span class="crayon-v">_sources1</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Set</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFMutableArrayRef </span><span class="crayon-v">_observers</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Array</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFMutableArrayRef </span><span class="crayon-v">_timers</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Array</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-8"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-9">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-10"><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e">__CFRunLoop</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFMutableSetRef </span><span class="crayon-v">_commonModes</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-c">// Set</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFMutableSetRef </span><span class="crayon-v">_commonModeItems</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// Set&lt;Source/Observer/Timer&gt;</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopModeRef </span><span class="crayon-v">_currentMode</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Current Runloop Mode</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFMutableSetRef </span><span class="crayon-v">_modes</span><span class="crayon-sy">;</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-c">// Set</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5e40242e3e84d693962180-16"><span class="crayon-sy">}</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>这里有个概念叫 &#8220;CommonModes&#8221;：一个 Mode 可以将自己标记为&#8221;Common&#8221;属性（通过将其 ModeName 添加到 RunLoop 的 &#8220;commonModes&#8221; 中）。每当 RunLoop 的内容发生变化时，RunLoop 都会自动将 _commonModeItems 里的 Source/Observer/Timer 同步到具有 &#8220;Common&#8221; 标记的所有Mode里。</p>
<p>应用场景举例：主线程的 RunLoop 里有两个预置的 Mode：kCFRunLoopDefaultMode 和 UITrackingRunLoopMode。这两个 Mode 都已经被标记为&#8221;Common&#8221;属性。DefaultMode 是 App 平时所处的状态，TrackingRunLoopMode 是追踪 ScrollView 滑动时的状态。当你创建一个 Timer 并加到 DefaultMode 时，Timer 会得到重复回调，但此时滑动一个TableView时，RunLoop 会将 mode 切换为 TrackingRunLoopMode，这时 Timer 就不会被回调，并且也不会影响到滑动操作。</p>
<p>有时你需要一个 Timer，在两个 Mode 中都能得到回调，一种办法就是将这个 Timer 分别加入这两个 Mode。还有一种方式，就是将 Timer 加入到顶层的 RunLoop 的 &#8220;commonModeItems&#8221; 中。&#8221;commonModeItems&#8221; 被 RunLoop 自动更新到所有具有&#8221;Common&#8221;属性的 Mode 里去。</p>
<p>CFRunLoop对外暴露的管理 Mode 接口只有下面2个:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e84e416642104" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
CFRunLoopAddCommonMode(CFRunLoopRef runloop, CFStringRef modeName);
CFRunLoopRunInMode(CFStringRef modeName, ...);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e84e416642104-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e84e416642104-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e84e416642104-1"><span class="crayon-e">CFRunLoopAddCommonMode</span><span class="crayon-sy">(</span><span class="crayon-e">CFRunLoopRef </span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFStringRef </span><span class="crayon-v">modeName</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e84e416642104-2"><span class="crayon-e">CFRunLoopRunInMode</span><span class="crayon-sy">(</span><span class="crayon-e">CFStringRef </span><span class="crayon-v">modeName</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Mode 暴露的管理 mode item 的接口有下面几个：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e850070845891" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
CFRunLoopAddSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFStringRef modeName);
CFRunLoopAddObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFStringRef modeName);
CFRunLoopAddTimer(CFRunLoopRef rl, CFRunLoopTimerRef timer, CFStringRef mode);
CFRunLoopRemoveSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFStringRef modeName);
CFRunLoopRemoveObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFStringRef modeName);
CFRunLoopRemoveTimer(CFRunLoopRef rl, CFRunLoopTimerRef timer, CFStringRef mode);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e850070845891-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e850070845891-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e850070845891-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e850070845891-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e850070845891-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e850070845891-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e850070845891-1"><span class="crayon-e">CFRunLoopAddSource</span><span class="crayon-sy">(</span><span class="crayon-e">CFRunLoopRef </span><span class="crayon-v">rl</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFRunLoopSourceRef </span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFStringRef </span><span class="crayon-v">modeName</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e850070845891-2"><span class="crayon-e">CFRunLoopAddObserver</span><span class="crayon-sy">(</span><span class="crayon-e">CFRunLoopRef </span><span class="crayon-v">rl</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFRunLoopObserverRef </span><span class="crayon-v">observer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFStringRef </span><span class="crayon-v">modeName</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e850070845891-3"><span class="crayon-e">CFRunLoopAddTimer</span><span class="crayon-sy">(</span><span class="crayon-e">CFRunLoopRef </span><span class="crayon-v">rl</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFRunLoopTimerRef </span><span class="crayon-v">timer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFStringRef </span><span class="crayon-v">mode</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e850070845891-4"><span class="crayon-e">CFRunLoopRemoveSource</span><span class="crayon-sy">(</span><span class="crayon-e">CFRunLoopRef </span><span class="crayon-v">rl</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFRunLoopSourceRef </span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFStringRef </span><span class="crayon-v">modeName</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e850070845891-5"><span class="crayon-e">CFRunLoopRemoveObserver</span><span class="crayon-sy">(</span><span class="crayon-e">CFRunLoopRef </span><span class="crayon-v">rl</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFRunLoopObserverRef </span><span class="crayon-v">observer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFStringRef </span><span class="crayon-v">modeName</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e850070845891-6"><span class="crayon-e">CFRunLoopRemoveTimer</span><span class="crayon-sy">(</span><span class="crayon-e">CFRunLoopRef </span><span class="crayon-v">rl</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFRunLoopTimerRef </span><span class="crayon-v">timer</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFStringRef </span><span class="crayon-v">mode</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>你只能通过 mode name 来操作内部的 mode，当你传入一个新的 mode name 但 RunLoop 内部没有对应 mode 时，RunLoop会自动帮你创建对应的 CFRunLoopModeRef。对于一个 RunLoop 来说，其内部的 mode 只能增加不能删除。</p>
<p>苹果公开提供的 Mode 有两个：kCFRunLoopDefaultMode (NSDefaultRunLoopMode) 和 UITrackingRunLoopMode，你可以用这两个 Mode Name 来操作其对应的 Mode。</p>
<p>同时苹果还提供了一个操作 Common 标记的字符串：kCFRunLoopCommonModes (NSRunLoopCommonModes)，你可以用这个字符串来操作 Common Items，或标记一个 Mode 为 &#8220;Common&#8221;。使用时注意区分这个字符串和其他 mode name。</p>
<p><a name="inner"></a></p>
<h2>RunLoop 的内部逻辑</h2>
<p>根据苹果在<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW23" target="_blank">文档</a>里的说明，RunLoop 内部的逻辑大致如下:</p>
<p><a href="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_1.png"><img class="alignnone wp-image-41722" src="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_1.png" alt="RunLoop_1" width="572" height="440" /></a></p>
<p>其内部代码整理如下 （太长了不想看可以直接跳过去，后面会有说明）：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e852797263062" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
/// 用DefaultMode启动
void CFRunLoopRun(void) {
    CFRunLoopRunSpecific(CFRunLoopGetCurrent(), kCFRunLoopDefaultMode, 1.0e10, false);
}

/// 用指定的Mode启动，允许设置RunLoop超时时间
int CFRunLoopRunInMode(CFStringRef modeName, CFTimeInterval seconds, Boolean stopAfterHandle) {
    return CFRunLoopRunSpecific(CFRunLoopGetCurrent(), modeName, seconds, returnAfterSourceHandled);
}

/// RunLoop的实现
int CFRunLoopRunSpecific(runloop, modeName, seconds, stopAfterHandle) {
    
    /// 首先根据modeName找到对应mode
    CFRunLoopModeRef currentMode = __CFRunLoopFindMode(runloop, modeName, false);
    /// 如果mode里没有source/timer/observer, 直接返回。
    if (__CFRunLoopModeIsEmpty(currentMode)) return;
    
    /// 1. 通知 Observers: RunLoop 即将进入 loop。
    __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopEntry);
    
    /// 内部函数，进入loop
    __CFRunLoopRun(runloop, currentMode, seconds, returnAfterSourceHandled) {
        
        Boolean sourceHandledThisLoop = NO;
        int retVal = 0;
        do {

            /// 2. 通知 Observers: RunLoop 即将触发 Timer 回调。
            __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeTimers);
            /// 3. 通知 Observers: RunLoop 即将触发 Source0 (非port) 回调。
            __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeSources);
            /// 执行被加入的block
            __CFRunLoopDoBlocks(runloop, currentMode);
            
            /// 4. RunLoop 触发 Source0 (非port) 回调。
            sourceHandledThisLoop = __CFRunLoopDoSources0(runloop, currentMode, stopAfterHandle);
            /// 执行被加入的block
            __CFRunLoopDoBlocks(runloop, currentMode);

            /// 5. 如果有 Source1 (基于port) 处于 ready 状态，直接处理这个 Source1 然后跳转去处理消息。
            if (__Source0DidDispatchPortLastTime) {
                Boolean hasMsg = __CFRunLoopServiceMachPort(dispatchPort, &amp;msg)
                if (hasMsg) goto handle_msg;
            }
            
            /// 通知 Observers: RunLoop 的线程即将进入休眠(sleep)。
            if (!sourceHandledThisLoop) {
                __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeWaiting);
            }
            
            /// 7. 调用 mach_msg 等待接受 mach_port 的消息。线程将进入休眠, 直到被下面某一个事件唤醒。
            /// • 一个基于 port 的Source 的事件。
            /// • 一个 Timer 到时间了
            /// • RunLoop 自身的超时时间到了
            /// • 被其他什么调用者手动唤醒
            __CFRunLoopServiceMachPort(waitSet, &amp;msg, sizeof(msg_buffer), &amp;livePort) {
                mach_msg(msg, MACH_RCV_MSG, port); // thread wait for receive msg
            }

            /// 8. 通知 Observers: RunLoop 的线程刚刚被唤醒了。
            __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopAfterWaiting);
            
            /// 收到消息，处理消息。
            handle_msg:

            /// 9.1 如果一个 Timer 到时间了，触发这个Timer的回调。
            if (msg_is_timer) {
                __CFRunLoopDoTimers(runloop, currentMode, mach_absolute_time())
            } 

            /// 9.2 如果有dispatch到main_queue的block，执行block。
            else if (msg_is_dispatch) {
                __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(msg);
            } 

            /// 9.3 如果一个 Source1 (基于port) 发出事件了，处理这个事件
            else {
                CFRunLoopSourceRef source1 = __CFRunLoopModeFindSourceForMachPort(runloop, currentMode, livePort);
                sourceHandledThisLoop = __CFRunLoopDoSource1(runloop, currentMode, source1, msg);
                if (sourceHandledThisLoop) {
                    mach_msg(reply, MACH_SEND_MSG, reply);
                }
            }
            
            /// 执行加入到Loop的block
            __CFRunLoopDoBlocks(runloop, currentMode);
            

            if (sourceHandledThisLoop &amp;&amp; stopAfterHandle) {
                /// 进入loop时参数说处理完事件就返回。
                retVal = kCFRunLoopRunHandledSource;
            } else if (timeout) {
                /// 超出传入参数标记的超时时间了
                retVal = kCFRunLoopRunTimedOut;
            } else if (__CFRunLoopIsStopped(runloop)) {
                /// 被外部调用者强制停止了
                retVal = kCFRunLoopRunStopped;
            } else if (__CFRunLoopModeIsEmpty(runloop, currentMode)) {
                /// source/timer/observer一个都没有了
                retVal = kCFRunLoopRunFinished;
            }
            
            /// 如果没超时，mode里没空，loop也没被停止，那继续loop。
        } while (retVal == 0);
    }
    
    /// 10. 通知 Observers: RunLoop 即将退出。
    __CFRunLoopDoObservers(rl, currentMode, kCFRunLoopExit);
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-8">8</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-9">9</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-10">10</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-11">11</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-12">12</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-13">13</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-14">14</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-15">15</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-16">16</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-17">17</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-18">18</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-19">19</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-20">20</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-21">21</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-22">22</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-23">23</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-24">24</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-25">25</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-26">26</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-27">27</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-28">28</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-29">29</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-30">30</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-31">31</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-32">32</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-33">33</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-34">34</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-35">35</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-36">36</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-37">37</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-38">38</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-39">39</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-40">40</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-41">41</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-42">42</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-43">43</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-44">44</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-45">45</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-46">46</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-47">47</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-48">48</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-49">49</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-50">50</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-51">51</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-52">52</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-53">53</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-54">54</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-55">55</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-56">56</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-57">57</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-58">58</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-59">59</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-60">60</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-61">61</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-62">62</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-63">63</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-64">64</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-65">65</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-66">66</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-67">67</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-68">68</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-69">69</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-70">70</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-71">71</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-72">72</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-73">73</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-74">74</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-75">75</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-76">76</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-77">77</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-78">78</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-79">79</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-80">80</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-81">81</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-82">82</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-83">83</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-84">84</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-85">85</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-86">86</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-87">87</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-88">88</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-89">89</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-90">90</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-91">91</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-92">92</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-93">93</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-94">94</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-95">95</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-96">96</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-97">97</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-98">98</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-99">99</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-100">100</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-101">101</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-102">102</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-103">103</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-104">104</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-105">105</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-106">106</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-107">107</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-108">108</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-109">109</div><div class="crayon-num" data-line="crayon-5e40242e3e852797263062-110">110</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e852797263062-1"><span class="crayon-c">/// 用DefaultMode启动</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-2"><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">CFRunLoopRun</span><span class="crayon-sy">(</span><span class="crayon-t">void</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopRunSpecific</span><span class="crayon-sy">(</span><span class="crayon-e">CFRunLoopGetCurrent</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopDefaultMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1.0e10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-4"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-5">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e852797263062-6"><span class="crayon-c">/// 用指定的Mode启动，允许设置RunLoop超时时间</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-7"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">CFRunLoopRunInMode</span><span class="crayon-sy">(</span><span class="crayon-e">CFStringRef </span><span class="crayon-v">modeName</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">CFTimeInterval </span><span class="crayon-v">seconds</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">Boolean</span><span class="crayon-h"> </span><span class="crayon-v">stopAfterHandle</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">CFRunLoopRunSpecific</span><span class="crayon-sy">(</span><span class="crayon-e">CFRunLoopGetCurrent</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">modeName</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seconds</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">returnAfterSourceHandled</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-9"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-10">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e852797263062-11"><span class="crayon-c">/// RunLoop的实现</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-12"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">CFRunLoopRunSpecific</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">modeName</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seconds</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stopAfterHandle</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 首先根据modeName找到对应mode</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopModeRef </span><span class="crayon-v">currentMode</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">__CFRunLoopFindMode</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">modeName</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 如果mode里没有source/timer/observer, 直接返回。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">__CFRunLoopModeIsEmpty</span><span class="crayon-sy">(</span><span class="crayon-v">currentMode</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 1. 通知 Observers: RunLoop 即将进入 loop。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopDoObservers</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopEntry</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 内部函数，进入loop</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopRun</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">seconds</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">returnAfterSourceHandled</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">Boolean</span><span class="crayon-h"> </span><span class="crayon-v">sourceHandledThisLoop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">NO</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">retVal</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">do</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-28">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e852797263062-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 2. 通知 Observers: RunLoop 即将触发 Timer 回调。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopDoObservers</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopBeforeTimers</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 3. 通知 Observers: RunLoop 即将触发 Source0 (非port) 回调。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopDoObservers</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopBeforeSources</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 执行被加入的block</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopDoBlocks</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 4. RunLoop 触发 Source0 (非port) 回调。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sourceHandledThisLoop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">__CFRunLoopDoSources0</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">stopAfterHandle</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 执行被加入的block</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopDoBlocks</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-40">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e852797263062-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 5. 如果有 Source1 (基于port) 处于 ready 状态，直接处理这个 Source1 然后跳转去处理消息。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">__Source0DidDispatchPortLastTime</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">Boolean</span><span class="crayon-h"> </span><span class="crayon-v">hasMsg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">__CFRunLoopServiceMachPort</span><span class="crayon-sy">(</span><span class="crayon-v">dispatchPort</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">msg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">hasMsg</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">goto</span><span class="crayon-h"> </span><span class="crayon-v">handle_msg</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 通知 Observers: RunLoop 的线程即将进入休眠(sleep)。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">sourceHandledThisLoop</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopDoObservers</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopBeforeWaiting</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 7. 调用 mach_msg 等待接受 mach_port 的消息。线程将进入休眠, 直到被下面某一个事件唤醒。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// • 一个基于 port 的Source 的事件。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// • 一个 Timer 到时间了</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// • RunLoop 自身的超时时间到了</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// • 被其他什么调用者手动唤醒</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopServiceMachPort</span><span class="crayon-sy">(</span><span class="crayon-v">waitSet</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">msg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">sizeof</span><span class="crayon-sy">(</span><span class="crayon-v">msg_buffer</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">livePort</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">mach_msg</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">MACH_RCV_MSG</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">port</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">// thread wait for receive msg</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-60">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e852797263062-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 8. 通知 Observers: RunLoop 的线程刚刚被唤醒了。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopDoObservers</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopAfterWaiting</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 收到消息，处理消息。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">handle_msg</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-66">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e852797263062-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 9.1 如果一个 Timer 到时间了，触发这个Timer的回调。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">msg_is_timer</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopDoTimers</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">mach_absolute_time</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-71">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e852797263062-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 9.2 如果有dispatch到main_queue的block，执行block。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">msg_is_dispatch</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-76">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e852797263062-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 9.3 如果一个 Source1 (基于port) 发出事件了，处理这个事件</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSourceRef </span><span class="crayon-v">source1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">__CFRunLoopModeFindSourceForMachPort</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">livePort</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sourceHandledThisLoop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">__CFRunLoopDoSource1</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">source1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">msg</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">sourceHandledThisLoop</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">mach_msg</span><span class="crayon-sy">(</span><span class="crayon-v">reply</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">MACH_SEND_MSG</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">reply</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 执行加入到Loop的block</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopDoBlocks</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-89">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e852797263062-90"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">sourceHandledThisLoop</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">stopAfterHandle</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 进入loop时参数说处理完事件就返回。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">retVal</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopRunHandledSource</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">timeout</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 超出传入参数标记的超时时间了</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">retVal</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopRunTimedOut</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-96"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">__CFRunLoopIsStopped</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-97"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 被外部调用者强制停止了</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-98"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">retVal</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopRunStopped</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-99"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">__CFRunLoopModeIsEmpty</span><span class="crayon-sy">(</span><span class="crayon-v">runloop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-100"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// source/timer/observer一个都没有了</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-101"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">retVal</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopRunFinished</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-102"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-103"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-104"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 如果没超时，mode里没空，loop也没被停止，那继续loop。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-105"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">retVal</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-106"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-107"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-108"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 10. 通知 Observers: RunLoop 即将退出。</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-109"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRunLoopDoObservers</span><span class="crayon-sy">(</span><span class="crayon-v">rl</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">currentMode</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kCFRunLoopExit</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e852797263062-110"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
<p>可以看到，实际上 RunLoop 就是这样一个函数，其内部是一个 do-while 循环。当你调用 CFRunLoopRun() 时，线程就会一直停留在这个循环里；直到超时或被手动停止，该函数才会返回。</p>
<p><a name="core"></a></p>
<h2>RunLoop 的底层实现</h2>
<p>从上面代码可以看到，RunLoop 的核心是基于 mach port 的，其进入休眠时调用的函数是 mach_msg()。为了解释这个逻辑，下面稍微介绍一下 OSX/iOS 的系统架构。<br />
<a href="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_3.png"><img class="alignnone wp-image-41723" src="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_3.png" alt="RunLoop_3" width="307" height="193" /></a></p>
<p>苹果官方将整个系统大致划分为上述4个层次：<br />
应用层包括用户能接触到的图形应用，例如 Spotlight、Aqua、SpringBoard 等。<br />
应用框架层即开发人员接触到的 Cocoa 等框架。<br />
核心框架层包括各种核心框架、OpenGL 等内容。<br />
Darwin 即操作系统的核心，包括系统内核、驱动、Shell 等内容，这一层是开源的，其所有源码都可以在 <a href="http://opensource.apple.com" target="_blank">opensource.apple.com</a> 里找到。</p>
<p>我们在深入看一下 Darwin 这个核心的架构：<br />
<a href="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_4.png"><img class="alignnone wp-image-41724" src="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_4.png" alt="RunLoop_4" width="358" height="317" /></a></p>
<p>其中，在硬件层上面的三个组成部分：Mach、BSD、IOKit (还包括一些上面没标注的内容)，共同组成了 XNU 内核。<br />
XNU 内核的内环被称作 Mach，其作为一个微内核，仅提供了诸如处理器调度、IPC (进程间通信)等非常少量的基础服务。<br />
BSD 层可以看作围绕 Mach 层的一个外环，其提供了诸如进程管理、文件系统和网络等功能。<br />
IOKit 层是为设备驱动提供了一个面向对象(C++)的一个框架。</p>
<p>Mach 本身提供的 API 非常有限，而且苹果也不鼓励使用 Mach 的 API，但是这些API非常基础，如果没有这些API的话，其他任何工作都无法实施。在 Mach 中，所有的东西都是通过自己的对象实现的，进程、线程和虚拟内存都被称为&#8221;对象&#8221;。和其他架构不同， Mach 的对象间不能直接调用，只能通过消息传递的方式实现对象间的通信。&#8221;消息&#8221;是 Mach 中最基础的概念，消息在两个端口 (port) 之间传递，这就是 Mach 的 IPC (进程间通信) 的核心。</p>
<p>Mach 的消息定义是在 &lt;mach/message.h&gt; 头文件的，很简单：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e855423690325" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
typedef struct {
  mach_msg_header_t header;
  mach_msg_body_t body;
} mach_msg_base_t;

typedef struct {
  mach_msg_bits_t msgh_bits;
  mach_msg_size_t msgh_size;
  mach_port_t msgh_remote_port;
  mach_port_t msgh_local_port;
  mach_port_name_t msgh_voucher_port;
  mach_msg_id_t msgh_id;
} mach_msg_header_t;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-8">8</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-9">9</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-10">10</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-11">11</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-12">12</div><div class="crayon-num" data-line="crayon-5e40242e3e855423690325-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e855423690325-1"><span class="crayon-r">typedef</span><span class="crayon-h"> </span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">mach_msg_header_t </span><span class="crayon-v">header</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">mach_msg_body_t </span><span class="crayon-v">body</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-4"><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-v">mach_msg_base_t</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-5">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e855423690325-6"><span class="crayon-r">typedef</span><span class="crayon-h"> </span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">mach_msg_bits_t </span><span class="crayon-v">msgh_bits</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">mach_msg_size_t </span><span class="crayon-v">msgh_size</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">mach_port_t </span><span class="crayon-v">msgh_remote_port</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">mach_port_t </span><span class="crayon-v">msgh_local_port</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">mach_port_name_t </span><span class="crayon-v">msgh_voucher_port</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">mach_msg_id_t </span><span class="crayon-v">msgh_id</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e855423690325-13"><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-v">mach_msg_header_t</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>一条 Mach 消息实际上就是一个二进制数据包 (BLOB)，其头部定义了当前端口 local_port 和目标端口 remote_port，<br />
发送和接受消息是通过同一个 API 进行的，其 option 标记了消息传递的方向：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e858707121471" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
mach_msg_return_t mach_msg(
			mach_msg_header_t *msg,
			mach_msg_option_t option,
			mach_msg_size_t send_size,
			mach_msg_size_t rcv_size,
			mach_port_name_t rcv_name,
			mach_msg_timeout_t timeout,
			mach_port_name_t notify);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e858707121471-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e858707121471-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e858707121471-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e858707121471-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e858707121471-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e858707121471-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e858707121471-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e858707121471-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e858707121471-1"><span class="crayon-e">mach_msg_return_t </span><span class="crayon-e">mach_msg</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5e40242e3e858707121471-2"><span class="crayon-h">			</span><span class="crayon-e ">mach_msg_header_t *</span><span class="crayon-v">msg</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e858707121471-3"><span class="crayon-h">			</span><span class="crayon-e">mach_msg_option_t </span><span class="crayon-v">option</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e858707121471-4"><span class="crayon-h">			</span><span class="crayon-e">mach_msg_size_t </span><span class="crayon-v">send_size</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e858707121471-5"><span class="crayon-h">			</span><span class="crayon-e">mach_msg_size_t </span><span class="crayon-v">rcv_size</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e858707121471-6"><span class="crayon-h">			</span><span class="crayon-e">mach_port_name_t </span><span class="crayon-v">rcv_name</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e858707121471-7"><span class="crayon-h">			</span><span class="crayon-e">mach_msg_timeout_t </span><span class="crayon-v">timeout</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e858707121471-8"><span class="crayon-h">			</span><span class="crayon-e">mach_port_name_t </span><span class="crayon-v">notify</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>为了实现消息的发送和接收，mach_msg() 函数实际上是调用了一个 Mach 陷阱 (trap)，即函数mach_msg_trap()，陷阱这个概念在 Mach 中等同于系统调用。当你在用户态调用 mach_msg_trap() 时会触发陷阱机制，切换到内核态；内核态中内核实现的 mach_msg() 函数会完成实际的工作，如下图：<br />
<a href="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_5.png"><img class="alignnone wp-image-41725" src="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_5.png" alt="RunLoop_5" width="393" height="271" /></a></p>
<p>这些概念可以参考维基百科: <a href="http://en.wikipedia.org/wiki/System_call" target="_blank">System_call</a>、<a href="http://en.wikipedia.org/wiki/Trap_(computing)" target="_blank">Trap_(computing)</a>。</p>
<p>RunLoop 的核心就是一个 mach_msg() (见上面代码的第7步)，RunLoop 调用这个函数去接收消息，如果没有别人发送 port 消息过来，内核会将线程置于等待状态。例如你在模拟器里跑起一个 iOS 的 App，然后在 App 静止时点击暂停，你会看到主线程调用栈是停留在 mach_msg_trap() 这个地方。</p>
<p>关于具体的如何利用 mach port 发送信息，可以看看<a href="http://nshipster.com/inter-process-communication/" target="_blank"> NSHipster 这一篇文章</a>，或者<a href="http://segmentfault.com/a/1190000002400329" target="_blank">这里</a>的中文翻译 。</p>
<p>关于Mach的历史可以看看这篇很有趣的文章：<a href="http://www.programmer.com.cn/8121/" target="_blank">Mac OS X 背后的故事（三）Mach 之父 Avie Tevanian</a>。</p>
<p><a name="apple"></a></p>
<h2>苹果用 RunLoop 实现的功能</h2>
<p>首先我们可以看一下 App 启动后 RunLoop 的状态：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e859414838684" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
CFRunLoop {
    current mode = kCFRunLoopDefaultMode
    common modes = {
        UITrackingRunLoopMode
        kCFRunLoopDefaultMode
    }

    common mode items = {

        // source0 (manual)
        CFRunLoopSource {order =-1, {
            callout = _UIApplicationHandleEventQueue}}
        CFRunLoopSource {order =-1, {
            callout = PurpleEventSignalCallback }}
        CFRunLoopSource {order = 0, {
            callout = FBSSerialQueueRunLoopSourceHandler}}

        // source1 (mach port)
        CFRunLoopSource {order = 0,  {port = 17923}}
        CFRunLoopSource {order = 0,  {port = 12039}}
        CFRunLoopSource {order = 0,  {port = 16647}}
        CFRunLoopSource {order =-1, {
            callout = PurpleEventCallback}}
        CFRunLoopSource {order = 0, {port = 2407,
            callout = _ZL20notify_port_callbackP12__CFMachPortPvlS1_}}
        CFRunLoopSource {order = 0, {port = 1c03,
            callout = __IOHIDEventSystemClientAvailabilityCallback}}
        CFRunLoopSource {order = 0, {port = 1b03,
            callout = __IOHIDEventSystemClientQueueCallback}}
        CFRunLoopSource {order = 1, {port = 1903,
            callout = __IOMIGMachPortPortCallback}}

        // Ovserver
        CFRunLoopObserver {order = -2147483647, activities = 0x1, // Entry
            callout = _wrapRunLoopWithAutoreleasePoolHandler}
        CFRunLoopObserver {order = 0, activities = 0x20,          // BeforeWaiting
            callout = _UIGestureRecognizerUpdateObserver}
        CFRunLoopObserver {order = 1999000, activities = 0xa0,    // BeforeWaiting | Exit
            callout = _afterCACommitHandler}
        CFRunLoopObserver {order = 2000000, activities = 0xa0,    // BeforeWaiting | Exit
            callout = _ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv}
        CFRunLoopObserver {order = 2147483647, activities = 0xa0, // BeforeWaiting | Exit
            callout = _wrapRunLoopWithAutoreleasePoolHandler}

        // Timer
        CFRunLoopTimer {firing = No, interval = 3.1536e+09, tolerance = 0,
            next fire date = 453098071 (-4421.76019 @ 96223387169499),
            callout = _ZN2CAL14timer_callbackEP16__CFRunLoopTimerPv (QuartzCore.framework)}
    },

    modes ＝ {
        CFRunLoopMode  {
            sources0 =  { /* same as 'common mode items' */ },
            sources1 =  { /* same as 'common mode items' */ },
            observers = { /* same as 'common mode items' */ },
            timers =    { /* same as 'common mode items' */ },
        },

        CFRunLoopMode  {
            sources0 =  { /* same as 'common mode items' */ },
            sources1 =  { /* same as 'common mode items' */ },
            observers = { /* same as 'common mode items' */ },
            timers =    { /* same as 'common mode items' */ },
        },

        CFRunLoopMode  {
            sources0 = {
                CFRunLoopSource {order = 0, {
                    callout = FBSSerialQueueRunLoopSourceHandler}}
            },
            sources1 = (null),
            observers = {
                CFRunLoopObserver &gt;{activities = 0xa0, order = 2000000,
                    callout = _ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv}
            )},
            timers = (null),
        },

        CFRunLoopMode  {
            sources0 = {
                CFRunLoopSource {order = -1, {
                    callout = PurpleEventSignalCallback}}
            },
            sources1 = {
                CFRunLoopSource {order = -1, {
                    callout = PurpleEventCallback}}
            },
            observers = (null),
            timers = (null),
        },
        
        CFRunLoopMode  {
            sources0 = (null),
            sources1 = (null),
            observers = (null),
            timers = (null),
        }
    }
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-8">8</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-9">9</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-10">10</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-11">11</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-12">12</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-13">13</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-14">14</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-15">15</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-16">16</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-17">17</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-18">18</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-19">19</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-20">20</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-21">21</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-22">22</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-23">23</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-24">24</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-25">25</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-26">26</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-27">27</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-28">28</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-29">29</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-30">30</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-31">31</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-32">32</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-33">33</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-34">34</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-35">35</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-36">36</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-37">37</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-38">38</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-39">39</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-40">40</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-41">41</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-42">42</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-43">43</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-44">44</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-45">45</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-46">46</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-47">47</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-48">48</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-49">49</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-50">50</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-51">51</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-52">52</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-53">53</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-54">54</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-55">55</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-56">56</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-57">57</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-58">58</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-59">59</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-60">60</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-61">61</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-62">62</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-63">63</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-64">64</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-65">65</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-66">66</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-67">67</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-68">68</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-69">69</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-70">70</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-71">71</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-72">72</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-73">73</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-74">74</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-75">75</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-76">76</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-77">77</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-78">78</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-79">79</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-80">80</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-81">81</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-82">82</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-83">83</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-84">84</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-85">85</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-86">86</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-87">87</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-88">88</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-89">89</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-90">90</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-91">91</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-92">92</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-93">93</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-94">94</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-95">95</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-96">96</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-97">97</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-98">98</div><div class="crayon-num" data-line="crayon-5e40242e3e859414838684-99">99</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e859414838684-1"><span class="crayon-e">CFRunLoop</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">current </span><span class="crayon-v">mode</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">kCFRunLoopDefaultMode</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-3"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">common </span><span class="crayon-v">modes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">UITrackingRunLoopMode</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-5"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">kCFRunLoopDefaultMode</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-7">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e859414838684-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">common </span><span class="crayon-e">mode </span><span class="crayon-v">items</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-9">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e859414838684-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// source0 (manual)</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_UIApplicationHandleEventQueue</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">PurpleEventSignalCallback</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">FBSSerialQueueRunLoopSourceHandler</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-17">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e859414838684-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// source1 (mach port)</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">17923</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">12039</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">16647</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">PurpleEventCallback</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2407</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_ZL20notify_port_callbackP12__CFMachPortPvlS1_</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1c03</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">__IOHIDEventSystemClientAvailabilityCallback</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1b03</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">__IOHIDEventSystemClientQueueCallback</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">port</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1903</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">__IOMIGMachPortPortCallback</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-32">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e859414838684-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Ovserver</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopObserver</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">2147483647</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activities</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-c">// Entry</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_wrapRunLoopWithAutoreleasePoolHandler</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopObserver</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activities</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0x20</span><span class="crayon-sy">,</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// BeforeWaiting</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_UIGestureRecognizerUpdateObserver</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopObserver</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1999000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activities</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0xa0</span><span class="crayon-sy">,</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// BeforeWaiting | Exit</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_afterCACommitHandler</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopObserver</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2000000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activities</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0xa0</span><span class="crayon-sy">,</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// BeforeWaiting | Exit</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopObserver</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2147483647</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activities</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0xa0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-c">// BeforeWaiting | Exit</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_wrapRunLoopWithAutoreleasePoolHandler</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-44">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e859414838684-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">// Timer</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopTimer</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">firing</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">No</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3.1536e</span><span class="crayon-o">+</span><span class="crayon-cn">09</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tolerance</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">next </span><span class="crayon-e">fire </span><span class="crayon-v">date</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">453098071</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">4421.76019</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-h"> </span><span class="crayon-cn">96223387169499</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">_ZN2CAL14timer_callbackEP16__CFRunLoopTimerPv</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">QuartzCore</span><span class="crayon-sy">.</span><span class="crayon-v">framework</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-50">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e859414838684-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">modes</span><span class="crayon-h"> </span>＝<span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopMode</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sources0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* same as 'common mode items' */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sources1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* same as 'common mode items' */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">observers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* same as 'common mode items' */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">timers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* same as 'common mode items' */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-58">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e859414838684-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopMode</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sources0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* same as 'common mode items' */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sources1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* same as 'common mode items' */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">observers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* same as 'common mode items' */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">timers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-c">/* same as 'common mode items' */</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-65">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e859414838684-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopMode</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sources0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">FBSSerialQueueRunLoopSourceHandler</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sources1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">observers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopObserver</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-sy">{</span><span class="crayon-v">activities</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0xa0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2000000</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">_ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">timers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-78">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e859414838684-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopMode</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sources0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">PurpleEventSignalCallback</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sources1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopSource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">order</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callout</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">PurpleEventCallback</span><span class="crayon-sy">}</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">observers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">timers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-90"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">CFRunLoopMode</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sources0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sources1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">observers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-96"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">timers</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-97"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-98"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e859414838684-99"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0031 seconds] -->
<p>可以看到，系统默认注册了5个Mode:<br />
1. kCFRunLoopDefaultMode: App的默认 Mode，通常主线程是在这个 Mode 下运行的。<br />
2. UITrackingRunLoopMode: 界面跟踪 Mode，用于 ScrollView 追踪触摸滑动，保证界面滑动时不受其他 Mode 影响。<br />
3. UIInitializationRunLoopMode: 在刚启动 App 时第进入的第一个 Mode，启动完成后就不再使用。<br />
4: GSEventReceiveRunLoopMode: 接受系统事件的内部 Mode，通常用不到。<br />
5: kCFRunLoopCommonModes: 这是一个占位的 Mode，没有实际作用。</p>
<p>你可以在<a href="http://iphonedevwiki.net/index.php/CFRunLoop" target="_blank">这里</a>看到更多的苹果内部的 Mode，但那些 Mode 在开发中就很难遇到了。</p>
<p>当 RunLoop 进行回调时，一般都是通过一个很长的函数调用出去 (call out), 当你在你的代码中下断点调试时，通常能在调用栈上看到这些函数。下面是这几个函数的整理版本，如果你在调用栈中看到这些长函数名，在这里查找一下就能定位到具体的调用地点了：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e85b555300994" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
{
    /// 1. 通知Observers，即将进入RunLoop
    /// 此处有Observer会创建AutoreleasePool: _objc_autoreleasePoolPush();
    __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopEntry);
    do {

        /// 2. 通知 Observers: 即将触发 Timer 回调。
        __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopBeforeTimers);
        /// 3. 通知 Observers: 即将触发 Source (非基于port的,Source0) 回调。
        __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopBeforeSources);
        __CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__(block);

        /// 4. 触发 Source0 (非基于port的) 回调。
        __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__(source0);
        __CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__(block);

        /// 6. 通知Observers，即将进入休眠
        /// 此处有Observer释放并新建AutoreleasePool: _objc_autoreleasePoolPop(); _objc_autoreleasePoolPush();
        __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopBeforeWaiting);

        /// 7. sleep to wait msg.
        mach_msg() -&gt; mach_msg_trap();
        

        /// 8. 通知Observers，线程被唤醒
        __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopAfterWaiting);

        /// 9. 如果是被Timer唤醒的，回调Timer
        __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__(timer);

        /// 9. 如果是被dispatch唤醒的，执行所有调用 dispatch_async 等方法放入main queue 的 block
        __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(dispatched_block);

        /// 9. 如果如果Runloop是被 Source1 (基于port的) 的事件唤醒了，处理这个事件
        __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__(source1);


    } while (...);

    /// 10. 通知Observers，即将退出RunLoop
    /// 此处有Observer释放AutoreleasePool: _objc_autoreleasePoolPop();
    __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopExit);
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-8">8</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-9">9</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-10">10</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-11">11</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-12">12</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-13">13</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-14">14</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-15">15</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-16">16</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-17">17</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-18">18</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-19">19</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-20">20</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-21">21</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-22">22</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-23">23</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-24">24</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-25">25</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-26">26</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-27">27</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-28">28</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-29">29</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-30">30</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-31">31</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-32">32</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-33">33</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-34">34</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-35">35</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-36">36</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-37">37</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-38">38</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-39">39</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-40">40</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-41">41</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-42">42</div><div class="crayon-num" data-line="crayon-5e40242e3e85b555300994-43">43</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e85b555300994-1"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 1. 通知Observers，即将进入RunLoop</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 此处有Observer会创建AutoreleasePool: _objc_autoreleasePoolPush();</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__</span><span class="crayon-sy">(</span><span class="crayon-v">kCFRunLoopEntry</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">do</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-6">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 2. 通知 Observers: 即将触发 Timer 回调。</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__</span><span class="crayon-sy">(</span><span class="crayon-v">kCFRunLoopBeforeTimers</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 3. 通知 Observers: 即将触发 Source (非基于port的,Source0) 回调。</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__</span><span class="crayon-sy">(</span><span class="crayon-v">kCFRunLoopBeforeSources</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__</span><span class="crayon-sy">(</span><span class="crayon-v">block</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-12">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 4. 触发 Source0 (非基于port的) 回调。</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__</span><span class="crayon-sy">(</span><span class="crayon-v">source0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__</span><span class="crayon-sy">(</span><span class="crayon-v">block</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-16">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 6. 通知Observers，即将进入休眠</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 此处有Observer释放并新建AutoreleasePool: _objc_autoreleasePoolPop(); _objc_autoreleasePoolPush();</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__</span><span class="crayon-sy">(</span><span class="crayon-v">kCFRunLoopBeforeWaiting</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-20">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 7. sleep to wait msg.</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">mach_msg</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-e">mach_msg_trap</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-24">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 8. 通知Observers，线程被唤醒</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__</span><span class="crayon-sy">(</span><span class="crayon-v">kCFRunLoopAfterWaiting</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-27">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 9. 如果是被Timer唤醒的，回调Timer</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__</span><span class="crayon-sy">(</span><span class="crayon-v">timer</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-30">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 9. 如果是被dispatch唤醒的，执行所有调用 dispatch_async 等方法放入main queue 的 block</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__</span><span class="crayon-sy">(</span><span class="crayon-v">dispatched_block</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-33">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 9. 如果如果Runloop是被 Source1 (基于port的) 的事件唤醒了，处理这个事件</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__</span><span class="crayon-sy">(</span><span class="crayon-v">source1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-36">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-37">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-39">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 10. 通知Observers，即将退出RunLoop</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/// 此处有Observer释放AutoreleasePool: _objc_autoreleasePoolPop();</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__</span><span class="crayon-sy">(</span><span class="crayon-v">kCFRunLoopExit</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85b555300994-43"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p><a name="autorelease"></a></p>
<h3>AutoreleasePool</h3>
<p>App启动后，苹果在主线程 RunLoop 里注册了两个 Observer，其回调都是 _wrapRunLoopWithAutoreleasePoolHandler()。</p>
<p>第一个 Observer 监视的事件是 Entry(即将进入Loop)，其回调内会调用 _objc_autoreleasePoolPush() 创建自动释放池。其 order 是-2147483647，优先级最高，保证创建释放池发生在其他所有回调之前。</p>
<p>第二个 Observer 监视了两个事件： BeforeWaiting(准备进入休眠) 时调用_objc_autoreleasePoolPop() 和 _objc_autoreleasePoolPush() 释放旧的池并创建新池；Exit(即将退出Loop) 时调用 _objc_autoreleasePoolPop() 来释放自动释放池。这个 Observer 的 order 是 2147483647，优先级最低，保证其释放池子发生在其他所有回调之后。</p>
<p>在主线程执行的代码，通常是写在诸如事件回调、Timer回调内的。这些回调会被 RunLoop 创建好的 AutoreleasePool 环绕着，所以不会出现内存泄漏，开发者也不必显示创建 Pool 了。</p>
<p><a name="event"></a></p>
<h3>事件响应</h3>
<p>苹果注册了一个 Source1 (基于 mach port 的) 用来接收系统事件，其回调函数为 __IOHIDEventSystemClientQueueCallback()。</p>
<p>当一个硬件事件(触摸/锁屏/摇晃等)发生后，首先由 IOKit.framework 生成一个 IOHIDEvent 事件并由 SpringBoard 接收。这个过程的详细情况可以参考<a href="http://iphonedevwiki.net/index.php/IOHIDFamily" target="_blank">这里</a>。SpringBoard 只接收按键(锁屏/静音等)，触摸，加速，接近传感器等几种 Event，随后用 mach port 转发给需要的App进程。随后苹果注册的那个 Source1 就会触发回调，并调用 _UIApplicationHandleEventQueue() 进行应用内部的分发。</p>
<p>_UIApplicationHandleEventQueue() 会把 IOHIDEvent 处理并包装成 UIEvent 进行处理或分发，其中包括识别 UIGesture/处理屏幕旋转/发送给 UIWindow 等。通常事件比如 UIButton 点击、touchesBegin/Move/End/Cancel 事件都是在这个回调中完成的。</p>
<p><a name="gesture"></a></p>
<h3>手势识别</h3>
<p>当上面的 _UIApplicationHandleEventQueue() 识别了一个手势时，其首先会调用 Cancel 将当前的 touchesBegin/Move/End 系列回调打断。随后系统将对应的 UIGestureRecognizer 标记为待处理。</p>
<p>苹果注册了一个 Observer 监测 BeforeWaiting (Loop即将进入休眠) 事件，这个Observer的回调函数是 _UIGestureRecognizerUpdateObserver()，其内部会获取所有刚被标记为待处理的 GestureRecognizer，并执行GestureRecognizer的回调。</p>
<p>当有 UIGestureRecognizer 的变化(创建/销毁/状态改变)时，这个回调都会进行相应处理。</p>
<p><a name="ui"></a></p>
<h3>界面更新</h3>
<p>当在操作 UI 时，比如改变了 Frame、更新了 UIView/CALayer 的层次时，或者手动调用了 UIView/CALayer 的 setNeedsLayout/setNeedsDisplay方法后，这个 UIView/CALayer 就被标记为待处理，并被提交到一个全局的容器去。</p>
<p>苹果注册了一个 Observer 监听 BeforeWaiting(即将进入休眠) 和 Exit (即将退出Loop) 事件，回调去执行一个很长的函数：<br />
_ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv()。这个函数里会遍历所有待处理的 UIView/CAlayer 以执行实际的绘制和调整，并更新 UI 界面。</p>
<p>这个函数内部的调用栈大概是这样的：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e85d095358447" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
_ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv()
    QuartzCore:CA::Transaction::observer_callback:
        CA::Transaction::commit();
            CA::Context::commit_transaction();
                CA::Layer::layout_and_display_if_needed();
                    CA::Layer::layout_if_needed();
                        [CALayer layoutSublayers];
                            [UIView layoutSubviews];
                    CA::Layer::display_if_needed();
                        [CALayer display];
                            [UIView drawRect];</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-8">8</div><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-9">9</div><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-10">10</div><div class="crayon-num" data-line="crayon-5e40242e3e85d095358447-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e85d095358447-1"><span class="crayon-e">_ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5e40242e3e85d095358447-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">QuartzCore</span><span class="crayon-o">:</span><span class="crayon-v">CA</span><span class="crayon-o">::</span><span class="crayon-v">Transaction</span><span class="crayon-o">::</span><span class="crayon-v">observer_callback</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5e40242e3e85d095358447-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">CA</span><span class="crayon-o">::</span><span class="crayon-v">Transaction</span><span class="crayon-o">::</span><span class="crayon-e">commit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85d095358447-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">CA</span><span class="crayon-o">::</span><span class="crayon-v">Context</span><span class="crayon-o">::</span><span class="crayon-e">commit_transaction</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85d095358447-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">CA</span><span class="crayon-o">::</span><span class="crayon-v">Layer</span><span class="crayon-o">::</span><span class="crayon-e">layout_and_display_if_needed</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85d095358447-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">CA</span><span class="crayon-o">::</span><span class="crayon-v">Layer</span><span class="crayon-o">::</span><span class="crayon-e">layout_if_needed</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85d095358447-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-e">CALayer </span><span class="crayon-v">layoutSublayers</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85d095358447-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-e">UIView </span><span class="crayon-v">layoutSubviews</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85d095358447-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">CA</span><span class="crayon-o">::</span><span class="crayon-v">Layer</span><span class="crayon-o">::</span><span class="crayon-e">display_if_needed</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85d095358447-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-e">CALayer </span><span class="crayon-v">display</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e85d095358447-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-e">UIView </span><span class="crayon-v">drawRect</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p><a name="timer"></a></p>
<h3>定时器</h3>
<p>NSTimer 其实就是 CFRunLoopTimerRef，他们之间是 toll-free bridged 的。一个 NSTimer 注册到 RunLoop 后，RunLoop 会为其重复的时间点注册好事件。例如 10:00, 10:10, 10:20 这几个时间点。RunLoop为了节省资源，并不会在非常准确的时间点回调这个Timer。Timer 有个属性叫做 Tolerance (宽容度)，标示了当时间点到后，容许有多少最大误差。</p>
<p>如果某个时间点被错过了，例如执行了一个很长的任务，则那个时间点的回调也会跳过去，不会延后执行。就比如等公交，如果 10:10 时我忙着玩手机错过了那个点的公交，那我只能等 10:20 这一趟了。</p>
<p>CADisplayLink 是一个和屏幕刷新率一致的定时器（但实际实现原理更复杂，和 NSTimer 并不一样，其内部实际是操作了一个 Source）。如果在两次屏幕刷新之间执行了一个长任务，那其中就会有一帧被跳过去（和 NSTimer 相似），造成界面卡顿的感觉。在快速滑动TableView时，即使一帧的卡顿也会让用户有所察觉。Facebook 开源的 AsyncDisplayLink 就是为了解决界面卡顿的问题，其内部也用到了 RunLoop，这个稍后我会再单独写一页博客来分析。</p>
<p><a name="perform"></a></p>
<h3>PerformSelecter</h3>
<p>当调用 NSObject 的 performSelecter:afterDelay: 后，实际上其内部会创建一个 Timer 并添加到当前线程的 RunLoop 中。所以如果当前线程没有 RunLoop，则这个方法会失效。</p>
<p>当调用 performSelector:onThread: 时，实际上其会创建一个 Timer 加到对应的线程去，同样的，如果对应线程没有 RunLoop 该方法也会失效。</p>
<p><a name="gce"></a></p>
<h3>关于GCD</h3>
<p>实际上 RunLoop 底层也会用到 GCD 的东西，<del>比如 RunLoop 是用 dispatch_source_t 实现的 Timer</del>（评论中有人提醒，NSTimer 是用了 XNU 内核的 mk_timer，我也仔细调试了一下，发现 NSTimer 确实是由 mk_timer 驱动，而非 GCD 驱动的）。但同时 GCD 提供的某些接口也用到了 RunLoop， 例如 dispatch_async()。</p>
<p>当调用 dispatch_async(dispatch_get_main_queue(), block) 时，libDispatch 会向主线程的 RunLoop 发送消息，RunLoop会被唤醒，并从消息中取得这个 block，并在回调 __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__() 里执行这个 block。但这个逻辑仅限于 dispatch 到主线程，dispatch 到其他线程仍然是由 libDispatch 处理的。</p>
<p><a name="network"></a></p>
<h3>关于网络请求</h3>
<p>iOS 中，关于网络请求的接口自下至上有如下几层:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e86d436597763" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
CFSocket
CFNetwork       -&gt;ASIHttpRequest
NSURLConnection -&gt;AFNetworking
NSURLSession    -&gt;AFNetworking2, Alamofire</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e86d436597763-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e86d436597763-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e86d436597763-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e86d436597763-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e86d436597763-1"><span class="crayon-e">CFSocket</span></div><div class="crayon-line" id="crayon-5e40242e3e86d436597763-2"><span class="crayon-v">CFNetwork</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-o">-&gt;</span><span class="crayon-e">ASIHttpRequest</span></div><div class="crayon-line" id="crayon-5e40242e3e86d436597763-3"><span class="crayon-v">NSURLConnection</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-e">AFNetworking</span></div><div class="crayon-line" id="crayon-5e40242e3e86d436597763-4"><span class="crayon-v">NSURLSession</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">-&gt;</span><span class="crayon-v">AFNetworking2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Alamofire</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>• CFSocket 是最底层的接口，只负责 socket 通信。<br />
• CFNetwork 是基于 CFSocket 等接口的上层封装，ASIHttpRequest 工作于这一层。<br />
• NSURLConnection 是基于 CFNetwork 的更高层的封装，提供面向对象的接口，AFNetworking 工作于这一层。<br />
• NSURLSession 是 iOS7 中新增的接口，表面上是和 NSURLConnection 并列的，但底层仍然用到了 NSURLConnection 的部分功能 (比如 com.apple.NSURLConnectionLoader 线程)，AFNetworking2 和 Alamofire 工作于这一层。</p>
<p>下面主要介绍下 NSURLConnection 的工作过程。</p>
<p>通常使用 NSURLConnection 时，你会传入一个 Delegate，当调用了 [connection start] 后，这个 Delegate 就会不停收到事件回调。实际上，start 这个函数的内部会会获取 CurrentRunLoop，然后在其中的 DefaultMode 添加了4个 Source0 (即需要手动触发的Source)。CFMultiplexerSource 是负责各种 Delegate 回调的，CFHTTPCookieStorage 是处理各种 Cookie 的。</p>
<p>当开始网络传输时，我们可以看到 NSURLConnection 创建了两个新线程：com.apple.NSURLConnectionLoader 和 com.apple.CFSocket.private。其中 CFSocket 线程是处理底层 socket 连接的。NSURLConnectionLoader 这个线程内部会使用 RunLoop 来接收底层 socket 的事件，并通过之前添加的 Source0 通知到上层的 Delegate。</p>
<p><a href="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_network.png"><img class="alignnone size-full wp-image-41743" src="https://blog.ibireme.com/wp-content/uploads/2015/05/RunLoop_network.png" alt="RunLoop_network" width="677" height="471" /></a></p>
<p>NSURLConnectionLoader 中的 RunLoop 通过一些基于 mach port 的 Source 接收来自底层 CFSocket 的通知。当收到通知后，其会在合适的时机向 CFMultiplexerSource 等 Source0 发送通知，同时唤醒 Delegate 线程的 RunLoop 来让其处理这些通知。CFMultiplexerSource 会在 Delegate 线程的 RunLoop 对 Delegate 执行实际的回调。</p>
<p><a name="example"></a></p>
<h2>RunLoop 的实际应用举例</h2>
<p><a name="AFNetworking"></a></p>
<h3>AFNetworking</h3>
<p><a href="https://github.com/AFNetworking/AFNetworking/blob/master/AFNetworking%2FAFURLConnectionOperation.m" target="_blank">AFURLConnectionOperation</a> 这个类是基于 NSURLConnection 构建的，其希望能在后台线程接收 Delegate 回调。为此 AFNetworking 单独创建了一个线程，并在这个线程中启动了一个 RunLoop：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e86f288745248" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
+ (void)networkRequestThreadEntryPoint:(id)__unused object {
    @autoreleasepool {
        [[NSThread currentThread] setName:@"AFNetworking"];
        NSRunLoop *runLoop = [NSRunLoop currentRunLoop];
        [runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];
        [runLoop run];
    }
}

+ (NSThread *)networkRequestThread {
    static NSThread *_networkRequestThread = nil;
    static dispatch_once_t oncePredicate;
    dispatch_once(&amp;oncePredicate, ^{
        _networkRequestThread = [[NSThread alloc] initWithTarget:self selector:@selector(networkRequestThreadEntryPoint:) object:nil];
        [_networkRequestThread start];
    });
    return _networkRequestThread;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-8">8</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-9">9</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-10">10</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-11">11</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-12">12</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-13">13</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-14">14</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-15">15</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-16">16</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-17">17</div><div class="crayon-num" data-line="crayon-5e40242e3e86f288745248-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e86f288745248-1"><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">void</span><span class="crayon-sy">)</span><span class="crayon-v">networkRequestThreadEntryPoint</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-v">id</span><span class="crayon-sy">)</span><span class="crayon-e">__unused</span><span class="crayon-h"> </span><span class="crayon-t">object</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">@</span><span class="crayon-e">autoreleasepool</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-e">NSThread </span><span class="crayon-v">currentThread</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">setName</span><span class="crayon-o">:</span><span class="crayon-sy">@</span><span class="crayon-s">"AFNetworking"</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e ">NSRunLoop *</span><span class="crayon-v">runLoop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">NSRunLoop </span><span class="crayon-v">currentRunLoop</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-e">runLoop </span><span class="crayon-v">addPort</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-e">NSMachPort </span><span class="crayon-v">port</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">forMode</span><span class="crayon-o">:</span><span class="crayon-v">NSDefaultRunLoopMode</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-e">runLoop </span><span class="crayon-v">run</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-8"><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-9">&nbsp;</div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-10"><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e ">NSThread *</span><span class="crayon-sy">)</span><span class="crayon-e">networkRequestThread</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e ">NSThread *</span><span class="crayon-v">_networkRequestThread</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">nil</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">dispatch_once_t </span><span class="crayon-v">oncePredicate</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">dispatch_once</span><span class="crayon-sy">(</span><span class="crayon-o">&amp;</span><span class="crayon-v">oncePredicate</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">^</span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">_networkRequestThread</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-e">NSThread </span><span class="crayon-v">alloc</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">initWithTarget</span><span class="crayon-o">:</span><span class="crayon-e">self </span><span class="crayon-v">selector</span><span class="crayon-o">:</span><span class="crayon-sy">@</span><span class="crayon-e">selector</span><span class="crayon-sy">(</span><span class="crayon-v">networkRequestThreadEntryPoint</span><span class="crayon-o">:</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-t">object</span><span class="crayon-o">:</span><span class="crayon-v">nil</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-e">_networkRequestThread </span><span class="crayon-v">start</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">_networkRequestThread</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e86f288745248-18"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>RunLoop 启动前内部必须要有至少一个 Timer/Observer/Source，所以 AFNetworking 在 [runLoop run] 之前先创建了一个新的 NSMachPort 添加进去了。通常情况下，调用者需要持有这个 NSMachPort (mach_port) 并在外部线程通过这个 port 发送消息到 loop 内；但此处添加 port 只是为了让 RunLoop 不至于退出，并没有用于实际的发送消息。</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e40242e3e871931514424" class="crayon-syntax crayon-theme-familiar-mynew crayon-font-consolas crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 5px; margin-bottom: 5px; font-size: 13px !important; line-height: 15px !important;">
		
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;">
- (void)start {
    [self.lock lock];
    if ([self isCancelled]) {
        [self performSelector:@selector(cancelConnection) onThread:[[self class] networkRequestThread] withObject:nil waitUntilDone:NO modes:[self.runLoopModes allObjects]];
    } else if ([self isReady]) {
        self.state = AFOperationExecutingState;
        [self performSelector:@selector(operationDidStart) onThread:[[self class] networkRequestThread] withObject:nil waitUntilDone:NO modes:[self.runLoopModes allObjects]];
    }
    [self.lock unlock];
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 13px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5e40242e3e871931514424-1">1</div><div class="crayon-num" data-line="crayon-5e40242e3e871931514424-2">2</div><div class="crayon-num" data-line="crayon-5e40242e3e871931514424-3">3</div><div class="crayon-num" data-line="crayon-5e40242e3e871931514424-4">4</div><div class="crayon-num" data-line="crayon-5e40242e3e871931514424-5">5</div><div class="crayon-num" data-line="crayon-5e40242e3e871931514424-6">6</div><div class="crayon-num" data-line="crayon-5e40242e3e871931514424-7">7</div><div class="crayon-num" data-line="crayon-5e40242e3e871931514424-8">8</div><div class="crayon-num" data-line="crayon-5e40242e3e871931514424-9">9</div><div class="crayon-num" data-line="crayon-5e40242e3e871931514424-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5e40242e3e871931514424-1"><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">void</span><span class="crayon-sy">)</span><span class="crayon-e">start</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e871931514424-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">lock </span><span class="crayon-v">lock</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e871931514424-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-h"> </span><span class="crayon-v">isCancelled</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e871931514424-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-h"> </span><span class="crayon-v">performSelector</span><span class="crayon-o">:</span><span class="crayon-sy">@</span><span class="crayon-e">selector</span><span class="crayon-sy">(</span><span class="crayon-v">cancelConnection</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">onThread</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">networkRequestThread</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">withObject</span><span class="crayon-o">:</span><span class="crayon-e">nil </span><span class="crayon-v">waitUntilDone</span><span class="crayon-o">:</span><span class="crayon-e">NO </span><span class="crayon-v">modes</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">runLoopModes </span><span class="crayon-v">allObjects</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e871931514424-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-h"> </span><span class="crayon-v">isReady</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5e40242e3e871931514424-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">AFOperationExecutingState</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e871931514424-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-h"> </span><span class="crayon-v">performSelector</span><span class="crayon-o">:</span><span class="crayon-sy">@</span><span class="crayon-e">selector</span><span class="crayon-sy">(</span><span class="crayon-v">operationDidStart</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">onThread</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">networkRequestThread</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">withObject</span><span class="crayon-o">:</span><span class="crayon-e">nil </span><span class="crayon-v">waitUntilDone</span><span class="crayon-o">:</span><span class="crayon-e">NO </span><span class="crayon-v">modes</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">runLoopModes </span><span class="crayon-v">allObjects</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e871931514424-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5e40242e3e871931514424-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">lock </span><span class="crayon-v">unlock</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5e40242e3e871931514424-10"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>当需要这个后台线程执行任务时，AFNetworking 通过调用 [NSObject performSelector:onThread:..] 将这个任务扔到了后台线程的 RunLoop 中。</p>
<p><a name="AsyncDisplayKit"></a></p>
<h3>AsyncDisplayKit</h3>
<p><a href="https://github.com/facebook/AsyncDisplayKit" target="_blank">AsyncDisplayKit</a> 是 Facebook 推出的用于保持界面流畅性的框架，其原理大致如下：</p>
<p>UI 线程中一旦出现繁重的任务就会导致界面卡顿，这类任务通常分为3类：排版，绘制，UI对象操作。</p>
<p>排版通常包括计算视图大小、计算文本高度、重新计算子式图的排版等操作。<br />
绘制一般有文本绘制 (例如 CoreText)、图片绘制 (例如预先解压)、元素绘制 (Quartz)等操作。<br />
UI对象操作通常包括 UIView/CALayer 等 UI 对象的创建、设置属性和销毁。</p>
<p>其中前两类操作可以通过各种方法扔到后台线程执行，而最后一类操作只能在主线程完成，并且有时后面的操作需要依赖前面操作的结果 （例如TextView创建时可能需要提前计算出文本的大小）。ASDK 所做的，就是尽量将能放入后台的任务放入后台，不能的则尽量推迟 (例如视图的创建、属性的调整)。</p>
<p>为此，ASDK 创建了一个名为 ASDisplayNode 的对象，并在内部封装了 UIView/CALayer，它具有和 UIView/CALayer 相似的属性，例如 frame、backgroundColor等。所有这些属性都可以在后台线程更改，开发者可以只通过 Node 来操作其内部的 UIView/CALayer，这样就可以将排版和绘制放入了后台线程。但是无论怎么操作，这些属性总需要在某个时刻同步到主线程的 UIView/CALayer 去。</p>
<p>ASDK 仿照 QuartzCore/UIKit 框架的模式，实现了一套类似的界面更新的机制：即在主线程的 RunLoop 中添加一个 Observer，监听了 kCFRunLoopBeforeWaiting 和 kCFRunLoopExit 事件，在收到回调时，遍历所有之前放入队列的待处理的任务，然后一一执行。<br />
具体的代码可以看这里：<a href="https://github.com/facebook/AsyncDisplayKit/blob/master/AsyncDisplayKit%2FDetails%2FTransactions%2F_ASAsyncTransactionGroup.m" target="_blank">_ASAsyncTransactionGroup</a>。</p>
<h3>最后</h3>
<p>好长时间没写博客了喵～前几天给博客搬了个家，从越来越慢的 AWS 迁到了 Linode，然后很认真的换了一套新的博客主题，排版看着还说得过去吧～  :oops:</p>
					</div> <!-- .entry-content -->
					<div class="et_post_meta_wrapper">
					
					<!-- You can start editing here. -->

<section id="comment-wrap">
	<h1 id="comments" class="page_title">157 评论</h1>
			
					<ol class="commentlist clearfix">
					<li class="comment even thread-even depth-1" id="li-comment-47">
		<article id="comment-47" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/a7d17394c34b8f8cef06f523555aa9e4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/a7d17394c34b8f8cef06f523555aa9e4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://olinone.com' rel='external nofollow' class='url'>庞海礁</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.65' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 5 月 26 日 的 下午 8:14				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>请问你是在百度工作的吗？前段时间看了一个百度工作的介绍nsrunloop的视频，不知道是不是你？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=47#respond' data-commentid="47" data-postid="41710" data-belowelement="comment-47" data-respondelement="respond" aria-label='回复给庞海礁'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment byuser comment-author-ibireme bypostauthor odd alt depth-2" id="li-comment-48">
		<article id="comment-48" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ibireme <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 44.0.2403.9' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 5 月 27 日 的 上午 1:09				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>不是，我没在度厂待过。。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=48#respond' data-commentid="48" data-postid="41710" data-belowelement="comment-48" data-respondelement="respond" aria-label='回复给ibireme'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-3" id="li-comment-927">
		<article id="comment-927" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/80df5a35476a2dc1f41fb43fd51fe642?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/80df5a35476a2dc1f41fb43fd51fe642?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">li <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 50.0.2661.102' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 12 月 22 日 的 上午 10:35				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>当调用 performSelector:onThread: 时，实际上其会创建一个 Timer 加到对应的线程去  ;-)  ;-)  ;-)  这个说法 有点问题，我发现 实际上是创建了一个source1</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=927#respond' data-commentid="927" data-postid="41710" data-belowelement="comment-927" data-respondelement="respond" aria-label='回复给li'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-4" id="li-comment-1332">
		<article id="comment-1332" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ab167983a0f8ecf7def39328f75fc559?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ab167983a0f8ecf7def39328f75fc559?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://blog.harrisonxi.com' rel='external nofollow' class='url'>苹果梨</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 65.0.3325.181' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 3 月 26 日 的 上午 11:24				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p><a href="https://developer.apple.com/documentation/objectivec/nsobject/1416176-performselector" rel="nofollow">https://developer.apple.com/documentation/objectivec/nsobject/1416176-performselector</a></p>
<p>还是以官方文档为准比较好</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1332#respond' data-commentid="1332" data-postid="41710" data-belowelement="comment-1332" data-respondelement="respond" aria-label='回复给苹果梨'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-5" id="li-comment-1354">
		<article id="comment-1354" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/bd66671d0dede95e1902e7f5dfa3a502?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/bd66671d0dede95e1902e7f5dfa3a502?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://www.cuipengfei.cn/' rel='external nofollow' class='url'>我七岁就很帅</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 66.0.3359.170' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 5 月 15 日 的 上午 9:32				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>官方文档说的是performSelector:withObject:afterDelay:会在当前线程的Runloop中创建并添加一个Timer。但是performSelector:onThread: 实际上是创建了一个Source0，是Source0，不是Source1，更不是Timer。</p>
				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt depth-4" id="li-comment-1431">
		<article id="comment-1431" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ff3d02d1264a79f17e4159bae62b9379?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ff3d02d1264a79f17e4159bae62b9379?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">李重阳 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 72.0.3626.121' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2019 年 3 月 15 日 的 上午 10:16				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>是的 我打断点是 source1</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1431#respond' data-commentid="1431" data-postid="41710" data-belowelement="comment-1431" data-respondelement="respond" aria-label='回复给李重阳'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-5" id="li-comment-1432">
		<article id="comment-1432" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ff3d02d1264a79f17e4159bae62b9379?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ff3d02d1264a79f17e4159bae62b9379?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">李重阳 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 72.0.3626.121' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2019 年 3 月 15 日 的 上午 10:33				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>是source0</p>
				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt depth-2" id="li-comment-52">
		<article id="comment-52" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/d8ed89f2081f6bda63f9f5fef7d8822f?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/d8ed89f2081f6bda63f9f5fef7d8822f?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://www.ianisme.com' rel='external nofollow' class='url'>ian</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.81' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 5 月 31 日 的 下午 10:04				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>@庞海礁 那个貌似是 我叫sunnyxx怎么了 的视频</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=52#respond' data-commentid="52" data-postid="41710" data-belowelement="comment-52" data-respondelement="respond" aria-label='回复给ian'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-3" id="li-comment-714">
		<article id="comment-714" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/97c6d87c0fb0f31449aab3826fd87e20?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/97c6d87c0fb0f31449aab3826fd87e20?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">淡水湖 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.6.17' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 6 月 12 日 的 下午 6:11				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>:twisted: 评论现在俩人在滴滴一起相亲相爱了</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=714#respond' data-commentid="714" data-postid="41710" data-belowelement="comment-714" data-respondelement="respond" aria-label='回复给淡水湖'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt depth-2" id="li-comment-81">
		<article id="comment-81" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/27276e55ad4fead241bfd9123b320d75?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/27276e55ad4fead241bfd9123b320d75?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">王千 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/firefox.png' title='Mozilla Firefox 39.0' alt='Mozilla Firefox' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10.10' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 8 月 24 日 的 下午 7:28				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>评论 ;-) 求视频,据说是两期线下活动的视频,搜不到啊,感谢1093534383@qq.com</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=81#respond' data-commentid="81" data-postid="41710" data-belowelement="comment-81" data-respondelement="respond" aria-label='回复给王千'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-3" id="li-comment-98">
		<article id="comment-98" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/089b5431fe4879b37d294689f70c092d?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/089b5431fe4879b37d294689f70c092d?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">sclcoder <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/firefox.png' title='Mozilla Firefox 41.0' alt='Mozilla Firefox' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10.10' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 10 月 9 日 的 下午 4:52				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>他的微博里有</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=98#respond' data-commentid="98" data-postid="41710" data-belowelement="comment-98" data-respondelement="respond" aria-label='回复给sclcoder'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt depth-3" id="li-comment-381">
		<article id="comment-381" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/18a4a43084cb2e7d7925d8b78a960f6b?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/18a4a43084cb2e7d7925d8b78a960f6b?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">钱嘘嘘 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 42.0.2311.152' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/windows_win7.png' title='Windows 7' alt='Windows' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 15 日 的 上午 11:12				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p><a href="http://v.youku.com/v_show/id_XODgxODkzODI0.html" rel="nofollow">http://v.youku.com/v_show/id_XODgxODkzODI0.html</a></p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=381#respond' data-commentid="381" data-postid="41710" data-belowelement="comment-381" data-respondelement="respond" aria-label='回复给钱嘘嘘'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even depth-2" id="li-comment-527">
		<article id="comment-527" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ab5f675577f7772ca40882a3c77f25fd?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ab5f675577f7772ca40882a3c77f25fd?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">张明明  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 33.0.0.0' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/android.png' title=' HM NOTE 1LTE Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/33.0.0.0 Mobile Safari/537.36 Weibo (Xiaomi-HM NOTE 1LTE__weibo__5.7.1__android__android4.4.4) ' alt=' HM NOTE 1LTE Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/33.0.0.0 Mobile Safari/537.36 Weibo (Xiaomi-HM NOTE 1LTE__weibo__5.7.1__android__android4.4.4)' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 1 月 25 日 的 下午 10:29				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>博主，这方面在工作中应用的多不，小白求推荐书籍</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=527#respond' data-commentid="527" data-postid="41710" data-belowelement="comment-527" data-respondelement="respond" aria-label='回复给张明明'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt depth-2" id="li-comment-776">
		<article id="comment-776" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/b6116733a54c63d4ddf888e32adff4cf?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/b6116733a54c63d4ddf888e32adff4cf?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">赤壁 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 51.0.2704.103' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 8 月 8 日 的 下午 3:05				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>百度介绍RUNLOOP 的 孙源 视频在优酷上有  那个视频我看了好几遍 记录的笔记也没有这篇文章详细 老实说  不过 如果对RUNLOOP 完全没有概念 是推荐看那个视频的</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=776#respond' data-commentid="776" data-postid="41710" data-belowelement="comment-776" data-respondelement="respond" aria-label='回复给赤壁'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even depth-2" id="li-comment-1089">
		<article id="comment-1089" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/d6e4070c46bfeb0e1f46b3f09e3bd987?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/d6e4070c46bfeb0e1f46b3f09e3bd987?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">牧马 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/qqbrowser.png' title='QQ Browser 4.1.4132.400' alt='QQ Browser' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 6 月 18 日 的 下午 7:21				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>评论 :shock: 你说的是 sunny 孙源</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1089#respond' data-commentid="1089" data-postid="41710" data-belowelement="comment-1089" data-respondelement="respond" aria-label='回复给牧马'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-50">
		<article id="comment-50" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/bfb16fd44056a01e93153b54f89d97a4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/bfb16fd44056a01e93153b54f89d97a4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">John <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.81' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/windows_win7.png' title='Windows 7' alt='Windows' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 5 月 27 日 的 下午 8:23				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>好赞</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=50#respond' data-commentid="50" data-postid="41710" data-belowelement="comment-50" data-respondelement="respond" aria-label='回复给John'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-51">
		<article id="comment-51" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/de9733cac0f592016acf5243ecb3451d?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/de9733cac0f592016acf5243ecb3451d?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">daixunry <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 41.0.2272.101' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 5 月 28 日 的 下午 7:03				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>太棒了！收藏起来，可以经常回头看看</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=51#respond' data-commentid="51" data-postid="41710" data-belowelement="comment-51" data-respondelement="respond" aria-label='回复给daixunry'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-53">
		<article id="comment-53" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/b13ecbd7ef8958a8edad0e60aec058dd?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/b13ecbd7ef8958a8edad0e60aec058dd?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">离青 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.81' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 1 日 的 上午 10:19				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>awwwwwwwwwwwesome</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=53#respond' data-commentid="53" data-postid="41710" data-belowelement="comment-53" data-respondelement="respond" aria-label='回复给离青'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-56">
		<article id="comment-56" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7e81961dee8460ae4c7fd992b4adb912?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7e81961dee8460ae4c7fd992b4adb912?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">icyblazek <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 600.6.3' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 1 日 的 下午 5:22				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>整理得非常详细，深入，再一次深入了解RunLoop</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=56#respond' data-commentid="56" data-postid="41710" data-belowelement="comment-56" data-respondelement="respond" aria-label='回复给icyblazek'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-57">
		<article id="comment-57" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/598963b07d55a8c3cf0959e01011ab63?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/598963b07d55a8c3cf0959e01011ab63?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">wangbq <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.81' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_0' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 2 日 的 下午 2:27				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>写的超棒！ :oops:  :oops:     有个小疑问，文章中“线程刚创建时并没有 RunLoop，如果你不主动获取，那它一直都不会有”，如果我一直不获取runloop的话，这个线程就不能处理事件吗？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=57#respond' data-commentid="57" data-postid="41710" data-belowelement="comment-57" data-respondelement="respond" aria-label='回复给wangbq'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment byuser comment-author-ibireme bypostauthor even depth-2" id="li-comment-58">
		<article id="comment-58" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ibireme <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 45.0.2414.0' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 2 日 的 下午 9:17				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>线程创建时有入口函数，线程里能做的东西都是在那个函数里的。RunLoop也好你自己的逻辑也好，都是在那个函数里完成的。你要是不用RunLoop的话，也可以自己实现一个类似的机制来处理你定义的事件。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=58#respond' data-commentid="58" data-postid="41710" data-belowelement="comment-58" data-respondelement="respond" aria-label='回复给ibireme'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-3" id="li-comment-64">
		<article id="comment-64" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/598963b07d55a8c3cf0959e01011ab63?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/598963b07d55a8c3cf0959e01011ab63?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">wangbq <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.81' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_0' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 8 日 的 下午 3:50				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>理解了。还有一个问题哈，就是UIButton点击事件打印堆栈看的话是从source0调出的，文中说的是source1事件，不知道哪个是正确的呢？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=64#respond' data-commentid="64" data-postid="41710" data-belowelement="comment-64" data-respondelement="respond" aria-label='回复给wangbq'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment byuser comment-author-ibireme bypostauthor even depth-4" id="li-comment-65">
		<article id="comment-65" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ibireme <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 45.0.2414.0' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 8 日 的 下午 9:14				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>首先是由那个Source1 接收IOHIDEvent，之后在回调 __IOHIDEventSystemClientQueueCallback() 内触发的 Source0，Source0 再触发的 _UIApplicationHandleEventQueue()。所以UIButton事件看到是在 Source0 内的。你可以在 __IOHIDEventSystemClientQueueCallback 处下一个 Symbolic Breakpoint 看一下。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=65#respond' data-commentid="65" data-postid="41710" data-belowelement="comment-65" data-respondelement="respond" aria-label='回复给ibireme'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-5" id="li-comment-73">
		<article id="comment-73" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/65704725dc10198ed13c3b4f80adfa7c?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/65704725dc10198ed13c3b4f80adfa7c?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ffl <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 600.7.12' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 7 月 17 日 的 下午 9:40				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>看孙源@sunnyxx的那个视频，他说UIEvent是属于source0，理由和上面这位同学是一样的，也是从过看log得出的结论。这样说来他说的是错的？</p>
				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even depth-5" id="li-comment-1420">
		<article id="comment-1420" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/280e3001a70c8751d99c98b6af245994?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/280e3001a70c8751d99c98b6af245994?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">0xwangbo <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 605.1.15' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_14_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 12 月 13 日 的 下午 7:20				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>屏幕上就一个按钮，测试发现只要触摸屏幕，就会有 __CFRunLoopDoSource1 到 __IOHIDEventSystemClientQueueCallback 的流程，无论是否点击按钮，而点击按钮时，除了上述流程，会有一条新的调用从 GSEventRunModal 到 CFRunLoopRunSpecific 到 __CFRunLoopDoSources0，所以看起来按钮点击事件还是直接触发的 source0</p>
				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt depth-5" id="li-comment-1421">
		<article id="comment-1421" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/280e3001a70c8751d99c98b6af245994?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/280e3001a70c8751d99c98b6af245994?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">0xwangbo <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 605.1.15' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_14_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 12 月 13 日 的 下午 7:33				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>(lldb) bt<br />
* thread #6, name = &#8216;com.apple.uikit.eventfetch-thread&#8217;, stop reason = breakpoint 2.1<br />
  * frame #0: 0x000000019d7793fc IOKit<code>__IOHIDEventSystemClientQueueCallback<br />
    frame #1: 0x000000019d452708 CoreFoundation</code>__CFMachPortPerform + 192<br />
    frame #2: 0x000000019d47ad60 CoreFoundation<code>__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__ + 60<br />
    frame #3: 0x000000019d47a468 CoreFoundation</code>__CFRunLoopDoSource1 + 444<br />
    frame #4: 0x000000019d474ff8 CoreFoundation<code>__CFRunLoopRun + 2088<br />
    frame #5: 0x000000019d4744b8 CoreFoundation</code>CFRunLoopRunSpecific + 452<br />
    frame #6: 0x000000019de773e0 Foundation<code>-[NSRunLoop(NSRunLoop) runMode:beforeDate:] + 304<br />
    frame #7: 0x000000019de77284 Foundation</code>-[NSRunLoop(NSRunLoop) runUntilDate:] + 152<br />
    frame #8: 0x00000001cb29b288 UIKitCore<code>-[UIEventFetcher threadMain] + 140<br />
    frame #9: 0x000000019de75fc0 Foundation</code>-[NSThread main] + 72<br />
    frame #10: 0x000000019dfb2c44 Foundation<code>__NSThread__start__ + 1044<br />
    frame #11: 0x000000019d0ef974 libsystem_pthread.dylib</code>_pthread_body + 132<br />
    frame #12: 0x000000019d0ef8d0 libsystem_pthread.dylib<code>_pthread_start + 52<br />
    frame #13: 0x000000019d0f7ddc libsystem_pthread.dylib</code>thread_start + 4<br />
(lldb) bt<br />
* thread #6, name = &#8216;com.apple.uikit.eventfetch-thread&#8217;, stop reason = breakpoint 5.1<br />
  * frame #0: 0x000000019d47a6a8 CoreFoundation<code>__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__<br />
    frame #1: 0x000000019d47a640 CoreFoundation</code>__CFRunLoopDoSource0 + 92<br />
    frame #2: 0x000000019d479ef8 CoreFoundation<code>__CFRunLoopDoSources0 + 180<br />
    frame #3: 0x000000019d474bd8 CoreFoundation</code>__CFRunLoopRun + 1032<br />
    frame #4: 0x000000019d4744b8 CoreFoundation<code>CFRunLoopRunSpecific + 452<br />
    frame #5: 0x000000019de773e0 Foundation</code>-[NSRunLoop(NSRunLoop) runMode:beforeDate:] + 304<br />
    frame #6: 0x000000019de77284 Foundation<code>-[NSRunLoop(NSRunLoop) runUntilDate:] + 152<br />
    frame #7: 0x00000001cb29b288 UIKitCore</code>-[UIEventFetcher threadMain] + 140<br />
    frame #8: 0x000000019de75fc0 Foundation<code>-[NSThread main] + 72<br />
    frame #9: 0x000000019dfb2c44 Foundation</code>__NSThread__start__ + 1044<br />
    frame #10: 0x000000019d0ef974 libsystem_pthread.dylib<code>_pthread_body + 132<br />
    frame #11: 0x000000019d0ef8d0 libsystem_pthread.dylib</code>_pthread_start + 52<br />
    frame #12: 0x000000019d0f7ddc libsystem_pthread.dylib`thread_start + 4<br />
(lldb) bt</p>
<p>我理解偏了，应该说事件还是系统注册的那个 source1 接收，后续转给 source0处理，博主说的没问题。</p>
				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-59">
		<article id="comment-59" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/8778f1d28b6317ffb78b613f82b2fd15?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/8778f1d28b6317ffb78b613f82b2fd15?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://blog.leichunfeng.com/' rel='external nofollow' class='url'>雷纯锋</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.81' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 3 日 的 下午 4:39				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>文章写得非常好，赞一个。不过我有一点疑问想请教一下博主，就是 AutoreleasePool 小节中的内容不知道博主是在哪里看到的呢？我在 CF 和 runtime 的源码中都没有找到哦。另外，如果可以的话，加一下我的 QQ 307213080 交个朋友哈。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=59#respond' data-commentid="59" data-postid="41710" data-belowelement="comment-59" data-respondelement="respond" aria-label='回复给雷纯锋'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment byuser comment-author-ibireme bypostauthor odd alt depth-2" id="li-comment-61">
		<article id="comment-61" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ibireme <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 45.0.2414.0' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 3 日 的 下午 10:22				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>那个是打印主线程RunLoop的状态，配合对象dealloc处的断点看到的。Observer应该是UIKit.framework添加的。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=61#respond' data-commentid="61" data-postid="41710" data-belowelement="comment-61" data-respondelement="respond" aria-label='回复给ibireme'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-60">
		<article id="comment-60" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/d98dcc2c3c9bf6134a04cbb6739d0b34?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/d98dcc2c3c9bf6134a04cbb6739d0b34?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">XiangqiTu <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.81' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_9_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 3 日 的 下午 6:33				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>写得好。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=60#respond' data-commentid="60" data-postid="41710" data-belowelement="comment-60" data-respondelement="respond" aria-label='回复给XiangqiTu'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-62">
		<article id="comment-62" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/cf5212b7352aa80cc9d227919c9a4242?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/cf5212b7352aa80cc9d227919c9a4242?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">John <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.65' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 5 日 的 上午 9:34				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>你们现在开发中开始使用swift了没？ :roll:</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=62#respond' data-commentid="62" data-postid="41710" data-belowelement="comment-62" data-respondelement="respond" aria-label='回复给John'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-63">
		<article id="comment-63" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/511d7a1246921117cceed09dae28199c?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/511d7a1246921117cceed09dae28199c?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">只榆大叔 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.81' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 6 月 8 日 的 上午 9:36				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>nice<br />
果然是深入理解呀。<br />
不过对于初学者来说，有一个最重要的问题没有讲到：run loop为啥被设计成这样？<br />
相信这个问题解释清楚了的话，看起来会更容易理解。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=63#respond' data-commentid="63" data-postid="41710" data-belowelement="comment-63" data-respondelement="respond" aria-label='回复给只榆大叔'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-69">
		<article id="comment-69" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/f39dfcedb78172229a270f9638b44918?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/f39dfcedb78172229a270f9638b44918?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">孙大龙 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.124' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 7 月 1 日 的 下午 12:26				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>while (!self.runLoopThreadDidFinishFlag) {<br />
NSLog(@&#8221;Begin RunLoop&#8221;);<br />
[[NSRunLoop currentRunLoop] runMode:NSDefaultRunLoopMode beforeDate:[NSDate distantFuture]];<br />
NSLog(@&#8221;End RunLoop&#8221;);<br />
}<br />
“ [[NSRunLoop currentRunLoop] runMode:NSDefaultRunLoopMode beforeDate:[NSDate distantFuture]];” 这句到底做什么？<br />
是让主线程runloop进入休眠吗？不能理解为什么加了这句，代码就不会往下执行了？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=69#respond' data-commentid="69" data-postid="41710" data-belowelement="comment-69" data-respondelement="respond" aria-label='回复给孙大龙'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-2" id="li-comment-70">
		<article id="comment-70" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7755c5615b78b8bee783137e4014bdc4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7755c5615b78b8bee783137e4014bdc4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://veightz@gmail.com' rel='external nofollow' class='url'>Veight Zhou</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.132' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 7 月 15 日 的 下午 1:48				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>『一个 RunLoop 包含若干个 Mode，每个 Mode 又包含若干个 Source/Timer/Observer。每次调用 RunLoop 的主函数时，只能指定其中一个 Mode，这个Mode被称作 CurrentMode。如果需要切换 Mode，只能退出 Loop，再重新指定一个 Mode 进入。』</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=70#respond' data-commentid="70" data-postid="41710" data-belowelement="comment-70" data-respondelement="respond" aria-label='回复给Veight Zhou'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt depth-2" id="li-comment-1214">
		<article id="comment-1214" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/b0cb5bc8e515fa2b1bbca3f4da1ca4d9?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/b0cb5bc8e515fa2b1bbca3f4da1ca4d9?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://www.jianshu.com/u/2d899c5242bd' rel='external nofollow' class='url'>亮</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 604.1.38' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 10 月 13 日 的 下午 4:28				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>运行runLoop 一次，阻塞当前线程以等待处理一次输入源。在处理了第一次到达的输入源或设定的beforeDate到时间后，runLoop 会 exit。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1214#respond' data-commentid="1214" data-postid="41710" data-belowelement="comment-1214" data-respondelement="respond" aria-label='回复给亮'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-71">
		<article id="comment-71" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/d392c048c64fb0384e9c03b0db02d191?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/d392c048c64fb0384e9c03b0db02d191?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Oliver Hu <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.132' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 7 月 15 日 的 下午 3:15				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>Saved my life.  感谢分享，如此详实的介绍的runloop的blog几乎就此一家了:)</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=71#respond' data-commentid="71" data-postid="41710" data-belowelement="comment-71" data-respondelement="respond" aria-label='回复给Oliver Hu'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-72">
		<article id="comment-72" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/65704725dc10198ed13c3b4f80adfa7c?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/65704725dc10198ed13c3b4f80adfa7c?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ffl <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.134' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/windows_win7.png' title='Windows 7' alt='Windows' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 7 月 16 日 的 下午 4:10				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>查看source文件CFRunLoop.c，发现这儿有多处循环，一处是在方法void CFRunLoopRun(void)里面，然后一处是在static int32_t __CFRunLoopRun(CFRunLoopRef rl, CFRunLoopModeRef rlm, CFTimeInterval seconds, Boolean stopAfterHandle, CFRunLoopModeRef previousMode)里面，按照文章的解释，应该是在方法__CFRunLoopRun里循环的，那么外部这个循环是做什么用的？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=72#respond' data-commentid="72" data-postid="41710" data-belowelement="comment-72" data-respondelement="respond" aria-label='回复给ffl'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-76">
		<article id="comment-76" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/86e0af83b3bd950269375987c1001a4b?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/86e0af83b3bd950269375987c1001a4b?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ruikq <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 39.0.2171.95' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_0' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 7 月 28 日 的 下午 2:00				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>看懂一部分，有一个疑问，在SDWebImage源码中的DownloaderOperation中重写了NSOperation的start方法，当NSURLConnection start之后为什么要CFRunLoopRun()一下？这是让线程一直停留在runloop的那个循环里面么？如果是这个runloop的循环里面又包含哪些需要执行的东西</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=76#respond' data-commentid="76" data-postid="41710" data-belowelement="comment-76" data-respondelement="respond" aria-label='回复给ruikq'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-575">
		<article id="comment-575" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/683a84c0c93c58fe6a084f34d662dbd7?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/683a84c0c93c58fe6a084f34d662dbd7?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://androiosx.com' rel='external nofollow' class='url'>Kyle Sun</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 48.0.2564.97' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 3 月 3 日 的 下午 3:07				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>我也正在看SDWebImage的源码，刚开始看到这个地方有些看不懂，其实给你看一下CFRunLoopRun()的源码就知道啥意思了：<br />
void CFRunLoopRun(void) {    /* DOES CALLOUT */<br />
    int32_t result;<br />
    do {<br />
        result = CFRunLoopRunSpecific(CFRunLoopGetCurrent(), kCFRunLoopDefaultMode, 1.0e10, false);<br />
        CHECK_FOR_FORK();<br />
    } while (kCFRunLoopRunStopped != result &amp;&amp; kCFRunLoopRunFinished != result);<br />
}<br />
只要进入Run的循环之后只有Stop或者Finished的时候才会跳出循环，执行后面的代码，而是否Stop和Finish就是在NSURLConnection的delegate方法里面控制的。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=575#respond' data-commentid="575" data-postid="41710" data-belowelement="comment-575" data-respondelement="respond" aria-label='回复给Kyle Sun'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-77">
		<article id="comment-77" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/58a77099ac6b4e2656750b0539d77b69?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/58a77099ac6b4e2656750b0539d77b69?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">cli <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 44.0.2403.125' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/windows_win7.png' title='Windows 7' alt='Windows' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 8 月 4 日 的 上午 6:47				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>&#8220;CADisplayLink 是一个和屏幕刷新率一致的定时器（但实际实现原理更复杂，和 NSTimer 并不一样，其内部实际是操作了一个 Source）。&#8221;</p>
<p>在哪里可以确认CADisplayLink的实现和NSTimer不一样？有源代码可以看吗？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=77#respond' data-commentid="77" data-postid="41710" data-belowelement="comment-77" data-respondelement="respond" aria-label='回复给cli'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-78">
		<article id="comment-78" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/c9c4aea535cabfb72bfce26f68e4b1cc?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/c9c4aea535cabfb72bfce26f68e4b1cc?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">liucien <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 600.7.12' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 8 月 17 日 的 下午 2:27				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>nice</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=78#respond' data-commentid="78" data-postid="41710" data-belowelement="comment-78" data-respondelement="respond" aria-label='回复给liucien'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-79">
		<article id="comment-79" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/08234ab9c1b83ddb67ae8a9c897fad56?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/08234ab9c1b83ddb67ae8a9c897fad56?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">任贵权 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 44.0.2403.155' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 8 月 20 日 的 上午 10:17				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>写的很好   但是还有一点我不是很疑惑<br />
为什么我在主线程加上 NSRunLoop.mainRunLoop().run() 整个程序就卡死了</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=79#respond' data-commentid="79" data-postid="41710" data-belowelement="comment-79" data-respondelement="respond" aria-label='回复给任贵权'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-80">
		<article id="comment-80" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/bd72b047b3a7690b34708424f1cc7fa8?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/bd72b047b3a7690b34708424f1cc7fa8?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://www.ljson.com' rel='external nofollow' class='url'>Ljson</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 600.5.17' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 8 月 22 日 的 下午 10:15				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>过早的创建主运行循环并加到主线程当中，会卡主后面的操作，所以界面会卡主。我的猜想！</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=80#respond' data-commentid="80" data-postid="41710" data-belowelement="comment-80" data-respondelement="respond" aria-label='回复给Ljson'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even depth-2" id="li-comment-577">
		<article id="comment-577" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7cd5b0d26d542811f03eea0e91862337?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7cd5b0d26d542811f03eea0e91862337?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">John咯 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 48.0.2564.116' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 3 月 3 日 的 下午 4:19				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>应该是主线程的Runloop在程序刚启动时已经加锁启动进入循环了，而你之后再让主线程的Runloop进入循环就会因为互斥锁而进入睡眠</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=577#respond' data-commentid="577" data-postid="41710" data-belowelement="comment-577" data-respondelement="respond" aria-label='回复给John咯'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-3" id="li-comment-688">
		<article id="comment-688" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/0bd16175ccdf77764df72c6a519109d1?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/0bd16175ccdf77764df72c6a519109d1?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://china' rel='external nofollow' class='url'>iOS 小菜鸟</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.1.56' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 5 月 26 日 的 上午 11:45				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>主线程进入循环了，这时候是在do{}while（）循环里，在这个循环里在调用cfrunlooprun（），应该是又进到一个循环里了。并且会一直停留在那个循环里。所以造成的现象就是主线程卡死了。runLoop是可以嵌套的，因为他就是一个循环，循环肯定是可以嵌套的。我个人的理解，不知道对不对啊。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=688#respond' data-commentid="688" data-postid="41710" data-belowelement="comment-688" data-respondelement="respond" aria-label='回复给iOS 小菜鸟'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-4" id="li-comment-763">
		<article id="comment-763" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/98c6f94dd34985791d6fe01d6b1d3399?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/98c6f94dd34985791d6fe01d6b1d3399?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">罗德里格斯 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 51.0.2704.103' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 7 月 26 日 的 下午 6:18				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>一个线程不是只有一个对应的RunLoop吗？怎么会有两个循环？这两个循环怎么理解？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=763#respond' data-commentid="763" data-postid="41710" data-belowelement="comment-763" data-respondelement="respond" aria-label='回复给罗德里格斯'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-5" id="li-comment-1382">
		<article id="comment-1382" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ab6cf5efc43662e467ec10edd5100897?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ab6cf5efc43662e467ec10edd5100897?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">nEar_Geo <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 67.0.3396.99' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 8 月 1 日 的 下午 6:05				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>Run loops can be run recursively. You can call CFRunLoopRun or CFRunLoopRunInMode from within any run loop callout and create nested run loop activations on the current thread’s call stack.<br />
这是CFRunLoop官方文档的一句话，它指出了一种创建嵌套的runloop的可能。但是这段话的前一段，文档明确指出了我们不能创建线程的runloop。<br />
如果有人知道这一段所表达的意思，请回复我，我正在进行部分文档的翻译工作</p>
				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even depth-2" id="li-comment-1437">
		<article id="comment-1437" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/cf8091b086956d446f77f2aa1d94b6ae?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/cf8091b086956d446f77f2aa1d94b6ae?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">yannmm <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 73.0.3683.86' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_14_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2019 年 3 月 28 日 的 下午 5:47				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>如果暂停程序，堆栈会停留在 __CFRunLoopServiceMachPort，意味着 run loop 正在监听 mach port 消息，这也是它休眠的原理。 run 表示以 kCFRunLoopDefaultMode 运行 run loop，如果这个 mode 下的 source 和 timer 不做任何动作，那么 run loop 肯定会休眠。</p>
<p>尝试用 runMode:beforeDate: 替代 run，mode 填 UITrackingRunLoopMode，看看有什么不同?。</p>
<p>另外，run loop 支持嵌套调用，在 loop 中的某个任务执行环节重新调用 run 方法，会导致当前 run loop 运行环境被保存，和栈的原理很相似。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1437#respond' data-commentid="1437" data-postid="41710" data-belowelement="comment-1437" data-respondelement="respond" aria-label='回复给yannmm'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-84">
		<article id="comment-84" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7633e54f210ecff50c6e4a7b1ba8f563?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7633e54f210ecff50c6e4a7b1ba8f563?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Klein_Mioke <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 41.0.2272.101' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 9 月 7 日 的 上午 11:58				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>评论 :oops: 这篇超棒必须手动赞~~</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=84#respond' data-commentid="84" data-postid="41710" data-belowelement="comment-84" data-respondelement="respond" aria-label='回复给Klein_Mioke'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-87">
		<article id="comment-87" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/acdb683c353cbf871fc759e99e91f7f8?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/acdb683c353cbf871fc759e99e91f7f8?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">huangzhong <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 44.0.2403.157' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/windows_win7.png' title='Windows 7' alt='Windows' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 9 月 9 日 的 下午 4:21				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>runloop 不是有几个mode嘛，如果以一种mode跑runloop，当想切换到另外一种mode的时候怎么切换呢？ 主线程怎么在几种mode间切换的呢？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=87#respond' data-commentid="87" data-postid="41710" data-belowelement="comment-87" data-respondelement="respond" aria-label='回复给huangzhong'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-96">
		<article id="comment-96" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/fccac8f0de3d5f8c7794c2819bb0f082?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/fccac8f0de3d5f8c7794c2819bb0f082?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">G了个J <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/firefox.png' title='Mozilla Firefox 40.0' alt='Mozilla Firefox' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10.10' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 9 月 23 日 的 上午 1:34				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>必须要停止当前线程,再重新选择mode,再启动线程</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=96#respond' data-commentid="96" data-postid="41710" data-belowelement="comment-96" data-respondelement="respond" aria-label='回复给G了个J'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-3" id="li-comment-97">
		<article id="comment-97" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/acdb683c353cbf871fc759e99e91f7f8?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/acdb683c353cbf871fc759e99e91f7f8?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">huangzhong <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 44.0.2403.157' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/windows_win7.png' title='Windows 7' alt='Windows' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 10 月 8 日 的 下午 9:01				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>那主线程怎么办呢</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=97#respond' data-commentid="97" data-postid="41710" data-belowelement="comment-97" data-respondelement="respond" aria-label='回复给huangzhong'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-4" id="li-comment-664">
		<article id="comment-664" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/28032a6fcb582de349bc1e9df9a7dee5?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/28032a6fcb582de349bc1e9df9a7dee5?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">shayneyeorg <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 50.0.2661.86' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 5 月 5 日 的 下午 4:14				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>我觉得是不需要停止线程的，只是需要退出当前mode的Run Loop，再重新进入另一个mode的Run Loop。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=664#respond' data-commentid="664" data-postid="41710" data-belowelement="comment-664" data-respondelement="respond" aria-label='回复给shayneyeorg'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-91">
		<article id="comment-91" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/c2018a2516af49e30396f1b51d80efef?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/c2018a2516af49e30396f1b51d80efef?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Delpan <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 41.0.2272.104' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 9 月 14 日 的 上午 10:36				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>Runloop内部逻辑图，第7步的Source0(port)，Source1(port)端口输入源</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=91#respond' data-commentid="91" data-postid="41710" data-belowelement="comment-91" data-respondelement="respond" aria-label='回复给Delpan'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-100">
		<article id="comment-100" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/3f0fe99f66130bceae5622f5ea465ab3?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/3f0fe99f66130bceae5622f5ea465ab3?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">mario <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 600.5.17' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 10 月 14 日 的 下午 8:47				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>:roll: 评论简直是太棒了，楼主我想给你生孩子！！！！</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=100#respond' data-commentid="100" data-postid="41710" data-belowelement="comment-100" data-respondelement="respond" aria-label='回复给mario'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-101">
		<article id="comment-101" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ed90a39784360b766fc1c869f2166163?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ed90a39784360b766fc1c869f2166163?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">adobe <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 45.0.2454.101' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 10 月 14 日 的 下午 9:57				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>你好,博主,你用的是wordpress吧,主题很漂亮,可以发一下我吗,邮箱sg6548676@163.com,谢谢啦</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=101#respond' data-commentid="101" data-postid="41710" data-belowelement="comment-101" data-respondelement="respond" aria-label='回复给adobe'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-102">
		<article id="comment-102" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/9ae8353aa46406e53e988357b042351e?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/9ae8353aa46406e53e988357b042351e?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Nemo <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.1.56' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 10 月 20 日 的 下午 2:45				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>博主关于RunLoop应该是现在能搜到的中文资料里面最深入的，但是我在看关于RunLoop的时候，始终有几点没看明白，搜索了一些英文blog也没看到这几点的解释。<br />
1.APP中 设备的触摸、网络请求到达、旋转等这些是属于source0的源还是基于port的source1的源呢，在stackflow上有一个回答<br />
<a href="http://stackoverflow.com/questions/22116698/does-uiapplication-sendevent-execute-in-a-nsrunloop" rel="nofollow">http://stackoverflow.com/questions/22116698/does-uiapplication-sendevent-execute-in-a-nsrunloop</a><br />
里面提到，设备的触摸、旋转这些硬件的响应事件是属于source1 基于端口的源。如果是这样就和我第二个问题有发生矛盾的地方。<br />
2.在RunLoop的一次loop循环中，每次循环开始首先处理source0的源，有source1就到第九步开始处理。<br />
但是这里我有个疑问，一次loop是如何决定这次需要处理的timer和source源的，如果在处理source源或者timer的这次loop中不停地有新的timer和source源添加会怎么样？<br />
在源码里面，每次loop循环和添加timer或者source源都会将RunLoop加锁，执行完之后再解锁。如果是这样，那每开始一次loop要处理的所有souce源和timer都是固定的，新加入的souce源和timer会等到下一次loop执行。<br />
但是我新建了一个工程，在view的touchmoved方法中每次执行的时候都加入了一个非常大的log字符串的循环，导致loop中的timer触发方法一直不被执行，只有停止触摸后，timer才正常打印。<br />
所以这里就有两个矛盾的地方<br />
1、如果触摸是source1的源，那按照loop循环执行顺序，第9步先执行timer，所以不应该存在timer不执行，那这说明触摸是source0的源？<br />
2、如果一次loop要处理的source和timer是固定的，那不应该存在timer的方法不被执行的情况，所以timer这里不执行是否表明不停的新加source源的速度如果大于一次loop处理source源的速度，就会一直卡在处理source源的地方，导致timer方法不会被执行？<br />
源码我能力有限，也只能看懂一点，结合文档、网上的一些文章和博主写的分析，始终也没能够想明白这中间的逻辑。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=102#respond' data-commentid="102" data-postid="41710" data-belowelement="comment-102" data-respondelement="respond" aria-label='回复给Nemo'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-2" id="li-comment-108">
		<article id="comment-108" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/c2018a2516af49e30396f1b51d80efef?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/c2018a2516af49e30396f1b51d80efef?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Delpan <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 41.0.2272.104' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 10 月 27 日 的 上午 11:22				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>我在研究这块的时候也是遇到很多解释不了的，网上也很少资料，特别是RunLoop被唤醒后加锁这点，就有很多事件说不清。<br />
触摸那个，我自己测试看到的情况是先Source1去接收事件，再执行Source0的回调去分发。<br />
留个联系方式，我们交流一下吧</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=108#respond' data-commentid="108" data-postid="41710" data-belowelement="comment-108" data-respondelement="respond" aria-label='回复给Delpan'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt depth-2" id="li-comment-227">
		<article id="comment-227" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/d2ef0e7196d4a0fee5f6f8d28232ea78?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/d2ef0e7196d4a0fee5f6f8d28232ea78?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://gaonan.me' rel='external nofollow' class='url'>guinsoo</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 46.0.2490.80' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 11 月 15 日 的 下午 5:02				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>因为如果timer之前执行了很长时间的任务，到timer执行时还没执行完，则timer就会跳过。不会延迟执行。应该是你的touchmove持续触发。在同一个runloop循环中有太多的source1回调__IOHIDEventSystemClientQueueCallback()触发的source0回调。所以导致期间的timer都被跳过了。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=227#respond' data-commentid="227" data-postid="41710" data-belowelement="comment-227" data-respondelement="respond" aria-label='回复给guinsoo'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even depth-2" id="li-comment-373">
		<article id="comment-373" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/9a6763f5a91b9616ea3dbea274041751?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/9a6763f5a91b9616ea3dbea274041751?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Xi Lin <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 47.0.2526.80' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 13 日 的 上午 1:43				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>正如下面大家回复的，一次loop里肯定只会执行一类源，要么是source1要么是timer。而timer是设定好触发时机来执行的，文中定时器那段也讲了，如果执行时机正好被错过了那就是不会执行的。其实我不清楚你在touchmoved中做耗时的操作会使当前使用什么mode里，按说触摸事件没结束的话应该一直是在UITrackingRunLoopMode，那timer就更不会被触发了</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=373#respond' data-commentid="373" data-postid="41710" data-belowelement="comment-373" data-respondelement="respond" aria-label='回复给Xi Lin'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-216">
		<article id="comment-216" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/d6d4344ee2a0f689ab56bdfafbd69f74?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/d6d4344ee2a0f689ab56bdfafbd69f74?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://www.khongor.com' rel='external nofollow' class='url'>song</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 34.0.1772.0' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/windows_win7.png' title='Windows 7' alt='Windows' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 11 月 13 日 的 下午 4:55				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>写的很棒！</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=216#respond' data-commentid="216" data-postid="41710" data-belowelement="comment-216" data-respondelement="respond" aria-label='回复给song'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-235">
		<article id="comment-235" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/09ec082f878a3d962382acf5e8787d0a?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/09ec082f878a3d962382acf5e8787d0a?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">飞流 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 45.0.2454.93' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/windows_win7.png' title='Windows 7' alt='Windows' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 11 月 16 日 的 下午 8:39				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>文章写得超赞，读了好多遍了，有一点不理解，Runloop执行步骤中多次提到了执行加入到Runloop的block，这个block指的是什么呀，方便解释一下嘛，谢谢</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=235#respond' data-commentid="235" data-postid="41710" data-belowelement="comment-235" data-respondelement="respond" aria-label='回复给飞流'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-240">
		<article id="comment-240" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/68f963ae3d07582df29bfe0f0385870e?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/68f963ae3d07582df29bfe0f0385870e?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">dibadalu <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 46.0.2490.86' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 11 月 17 日 的 下午 5:48				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>作为一个iOS开发初学者，我竟然看完了全文。虽然很多都不懂，但是看了最少也知道了runloop是个什么“东西”，以后要是遇到runloop的问题也知道怎么去寻找方案。 :smile:</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=240#respond' data-commentid="240" data-postid="41710" data-belowelement="comment-240" data-respondelement="respond" aria-label='回复给dibadalu'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-245">
		<article id="comment-245" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/012e2e87fe55cbe9ffb4648f4a4cf127?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/012e2e87fe55cbe9ffb4648f4a4cf127?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ftxbird <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 46.0.2490.80' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 11 月 18 日 的 下午 12:15				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>评论 :smile:  看完一遍 受益匪浅!!!! 谢谢耀源兄</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=245#respond' data-commentid="245" data-postid="41710" data-belowelement="comment-245" data-respondelement="respond" aria-label='回复给ftxbird'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-259">
		<article id="comment-259" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/b1578745d4a89c5b1f0faa8f54175887?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/b1578745d4a89c5b1f0faa8f54175887?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">iOS小白菜 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 46.0.2490.80' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/windows.png' title='Windows NT' alt='Windows' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 11 月 19 日 的 下午 11:12				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>:cry: 看懂这些需要具备哪些知识呢，为啥我看着云里雾里的？ :???:  :arrow:</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=259#respond' data-commentid="259" data-postid="41710" data-belowelement="comment-259" data-respondelement="respond" aria-label='回复给iOS小白菜'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-302">
		<article id="comment-302" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/86a0ce70fa6465d3cbfeb91743cacfa2?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/86a0ce70fa6465d3cbfeb91743cacfa2?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">不会反思的小花猫 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.2.7' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 11 月 27 日 的 下午 6:18				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>博主，看了你的博文有以下个疑问，拜托给解答一下<br />
 1      ”__CFRunLoopDoBlocks(runloop, currentMode)“在runlooprun中一共执行了3次，其中前两次几乎并列写了两边,这是为什么?<br />
2      __CFRunLoopDoBlocks 处理 加入runloop的代码块，跟 回调（例如__CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__）有什么区别吗？不都是处理block中代码吗？ 跪求解答</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=302#respond' data-commentid="302" data-postid="41710" data-belowelement="comment-302" data-respondelement="respond" aria-label='回复给不会反思的小花猫'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-312">
		<article id="comment-312" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/66bd7a68ce9b208ba15d241f06c39c09?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/66bd7a68ce9b208ba15d241f06c39c09?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Menzoda <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 600.8.9' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 11 月 29 日 的 下午 10:02				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>写的非常好，干货，赞.</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=312#respond' data-commentid="312" data-postid="41710" data-belowelement="comment-312" data-respondelement="respond" aria-label='回复给Menzoda'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even depth-2" id="li-comment-733">
		<article id="comment-733" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/3e2030b32f6a5457fceb676e4532f633?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/3e2030b32f6a5457fceb676e4532f633?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">韦振宁 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.5.17' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 6 月 24 日 的 下午 5:51				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>同问</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=733#respond' data-commentid="733" data-postid="41710" data-belowelement="comment-733" data-respondelement="respond" aria-label='回复给韦振宁'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt depth-2" id="li-comment-1429">
		<article id="comment-1429" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/0ddb3c36e050dea95ce1e7f5ece50ac5?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/0ddb3c36e050dea95ce1e7f5ece50ac5?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">大凌 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 605.1.15' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_14_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2019 年 3 月 4 日 的 下午 4:56				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>我的理解：<br />
1.在RunLoop中处理完source0和source1后才执行自己添加到RunLoop的Block。<br />
2.dispatch_async(dispatch_get_main_queue(), block) &amp; __CFRunLoopPerformBlock 的区别是：1&gt;.调用GCD后是可以在common mode中主动唤醒主线程RunLoop并在__CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__回调block。而用__CFRunLoopPerformBlock添加到runloop的block中是不会主动唤醒主线程RunLoop，需要CFRunLoopWakeUp来唤醒，才会在__CFRunLoopDoBlock中依次执行。2&gt;.在主线程的RunLoop中dispatch_async(dispatch_get_main_queue(), block)是串行队列，会先执行完主线程的代码后才会执行block。而__CFRunLoopDoBlock则是在根据顺序执行。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1429#respond' data-commentid="1429" data-postid="41710" data-belowelement="comment-1429" data-respondelement="respond" aria-label='回复给大凌'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-343">
		<article id="comment-343" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/6000801b83530359ceba5e534b3c6909?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/6000801b83530359ceba5e534b3c6909?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Loe_Lin <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.2.7' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 5 日 的 下午 4:26				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>膜拜一下 ;-)</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=343#respond' data-commentid="343" data-postid="41710" data-belowelement="comment-343" data-respondelement="respond" aria-label='回复给Loe_Lin'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-351">
		<article id="comment-351" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/951fea86694bf1faefeb362bb36ffe0d?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/951fea86694bf1faefeb362bb36ffe0d?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">brownfeng <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/qqbrowser.png' title='QQ Browser 3.9.3943.400' alt='QQ Browser' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_0' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 7 日 的 下午 4:53				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>评论 :oops:  :oops:  :oops:  :oops: 太牛了！！！</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=351#respond' data-commentid="351" data-postid="41710" data-belowelement="comment-351" data-respondelement="respond" aria-label='回复给brownfeng'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-363">
		<article id="comment-363" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/107ce8be1c08392d453302506e5e5bfa?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/107ce8be1c08392d453302506e5e5bfa?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">John Wong  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 47.0.2526.73' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 10 日 的 上午 11:24				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>RunLoop 内部的逻辑图第7步，唤醒的条件port-based input source，应该是source1吧？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=363#respond' data-commentid="363" data-postid="41710" data-belowelement="comment-363" data-respondelement="respond" aria-label='回复给John Wong'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-585">
		<article id="comment-585" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/20f3291f71b62ee646a414d4b1f26ba4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/20f3291f71b62ee646a414d4b1f26ba4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://xuyafeicn' rel='external nofollow' class='url'>xuyafei</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.4.4' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 3 月 10 日 的 上午 8:35				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>7. Put the thread to sleep until one of the following events occurs:<br />
   ·An event arrives for a port-based input source.<br />
   ·A timer fires.<br />
   ·The timeout value set for the run loop expires.<br />
   ·The run loop is explicitly woken up.</p>
<p>“An event arrives for a port-based input source.”  我也觉得应该是source1吧？楼上@Delpan也有提。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=585#respond' data-commentid="585" data-postid="41710" data-belowelement="comment-585" data-respondelement="respond" aria-label='回复给xuyafei'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-372">
		<article id="comment-372" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/9a6763f5a91b9616ea3dbea274041751?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/9a6763f5a91b9616ea3dbea274041751?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Xi Lin <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 47.0.2526.80' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 13 日 的 上午 1:36				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>好文手动点赞！<br />
P.S.关于网络请求那的配图里CFSocket应该是调用Source0吧？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=372#respond' data-commentid="372" data-postid="41710" data-belowelement="comment-372" data-respondelement="respond" aria-label='回复给Xi Lin'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-376">
		<article id="comment-376" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/caa4dc97ca663f604e260ea120809c04?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/caa4dc97ca663f604e260ea120809c04?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">1  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 47.0.2526.80' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 14 日 的 下午 6:04				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>timer不是通过GCD实现的，是通过MK TIMER实现的</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=376#respond' data-commentid="376" data-postid="41710" data-belowelement="comment-376" data-respondelement="respond" aria-label='回复给1'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment byuser comment-author-ibireme bypostauthor even depth-2" id="li-comment-377">
		<article id="comment-377" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ibireme <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/sg.png" title="Singapore" alt="Singapore" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 48.0.2564.10' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 14 日 的 下午 9:58				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>感谢指正，我又看了下 timer 部分的源码，GCD 和 mk_timer 都用到了：<a href="https://github.com/apple/swift-corelibs-foundation/blob/master/CoreFoundation%2FRunLoop.subproj%2FCFRunLoop.c#L1948-L1980" target="_blank" rel="nofollow">https://github.com/apple/swift-corelibs-foundation/blob/master/CoreFoundation%2FRunLoop.subproj%2FCFRunLoop.c#L1948-L1980</a></p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=377#respond' data-commentid="377" data-postid="41710" data-belowelement="comment-377" data-respondelement="respond" aria-label='回复给ibireme'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-3" id="li-comment-380">
		<article id="comment-380" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/caa4dc97ca663f604e260ea120809c04?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/caa4dc97ca663f604e260ea120809c04?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">1  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 47.0.2526.80' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 15 日 的 上午 10:58				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>嗯，源代码里面是GCD和mk timer都有，实际上使用的还是mk timer，它是根据tolerate time参数去决定使用哪一种，我在实际例子中发现timer还是通过mac port调出的。应该是mk timer</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=380#respond' data-commentid="380" data-postid="41710" data-belowelement="comment-380" data-respondelement="respond" aria-label='回复给1'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment byuser comment-author-ibireme bypostauthor even depth-4" id="li-comment-385">
		<article id="comment-385" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ibireme <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 48.0.2564.10' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 15 日 的 下午 10:11				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>回到家又仔细调了一下这块儿代码，我把 RunLoop 相关 struct 挪到真机上跑起来调试，发现并没有用到 USE_DISPATCH_SOURCE_FOR_TIMERS。那 NSTimer 确实是由 mk_timer 驱动而不是 GCD 驱动的。感谢提示，我会更新一下文章。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=385#respond' data-commentid="385" data-postid="41710" data-belowelement="comment-385" data-respondelement="respond" aria-label='回复给ibireme'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-5" id="li-comment-391">
		<article id="comment-391" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/caa4dc97ca663f604e260ea120809c04?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/caa4dc97ca663f604e260ea120809c04?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">1  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 47.0.2526.80' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 16 日 的 上午 10:16				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>runloop源代码可调试?怎么做的</p>
				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment byuser comment-author-ibireme bypostauthor even depth-5" id="li-comment-394">
		<article id="comment-394" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ibireme <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/sg.png" title="Singapore" alt="Singapore" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 49.0.2587.3' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 16 日 的 下午 6:13				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>没有调试源码，只是把 struct 结构放到代码中，调试时就能直接看到对象的内部数据了。</p>
				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt depth-5" id="li-comment-1220">
		<article id="comment-1220" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/b0cb5bc8e515fa2b1bbca3f4da1ca4d9?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/b0cb5bc8e515fa2b1bbca3f4da1ca4d9?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://www.jianshu.com/u/2d899c5242bd' rel='external nofollow' class='url'>亮子123</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 604.1.38' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 10 月 16 日 的 下午 9:05				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>CFRunLoop.c 这段宏定义还不能说明问题吗？<br />
&#8212;&#8212;-</p>
<p>#if DEPLOYMENT_TARGET_MACOSX<br />
#define USE_DISPATCH_SOURCE_FOR_TIMERS 1<br />
#define USE_MK_TIMER_TOO 1<br />
#else<br />
#define USE_DISPATCH_SOURCE_FOR_TIMERS 0<br />
#define USE_MK_TIMER_TOO 1<br />
#endif</p>
				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-384">
		<article id="comment-384" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/c3beabf1a3d202d518ba6a80bbbc880a?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/c3beabf1a3d202d518ba6a80bbbc880a?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">9527  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.3.9' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 15 日 的 下午 9:40				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>你好，我最近也看了Runloop的源码，对__CFRunloopRun里关于timer的回调有点疑惑：<br />
1.想问一下CFRunloopTimer是不是由 GCD 的dispatch_source_set_timer 实现并进行回调通知CFRunloop该执行timer回调了(__CFRunLoopDoTimer)。<br />
2.<a href="https://github.com/apple/swift-corelibs-foundation/blob/master/CoreFoundation/RunLoop.subproj/CFRunLoop.c。对do" rel="nofollow">https://github.com/apple/swift-corelibs-foundation/blob/master/CoreFoundation/RunLoop.subproj/CFRunLoop.c。对do</a> while 里面的那个关于睡眠的片段不是很理解<br />
#if DEPLOYMENT_TARGET_MACOSX || DEPLOYMENT_TARGET_EMBEDDED || DEPLOYMENT_TARGET_EMBEDDED_MINI<br />
#if USE_DISPATCH_SOURCE_FOR_TIMERS<br />
        do {<br />
            if (kCFUseCollectableAllocator) {<br />
                // objc_clear_stack(0);<br />
                //<br />
                memset(msg_buffer, 0, sizeof(msg_buffer));<br />
            }<br />
            msg = (mach_msg_header_t *)msg_buffer;</p>
<p>            __CFRunLoopServiceMachPort(waitSet, &amp;msg, sizeof(msg_buffer), &amp;livePort, poll ? 0 : TIMEOUT_INFINITY, &amp;voucherState, &amp;voucherCopy);</p>
<p>            if (modeQueuePort != MACH_PORT_NULL &amp;&amp; livePort == modeQueuePort) {<br />
                // Drain the internal queue. If one of the callout blocks sets the timerFired flag, break out and service the timer.<br />
                while (_dispatch_runloop_root_queue_perform_4CF(rlm-&gt;_queue));<br />
                if (rlm-&gt;_timerFired) {<br />
                    // Leave livePort as the queue port, and service timers below<br />
                    rlm-&gt;_timerFired = false;<br />
                    break;<br />
                } else {<br />
                    if (msg &amp;&amp; msg != (mach_msg_header_t *)msg_buffer) free(msg);<br />
                }<br />
            } else {<br />
                // Go ahead and leave the inner loop.<br />
                break;<br />
            }<br />
        } while (1);<br />
#else 。。。<br />
想请教一下这一段是什么意思。所到底，就是还没有弄清楚 Runloop是如何实现timer的 :cry:  :cry:</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=384#respond' data-commentid="384" data-postid="41710" data-belowelement="comment-384" data-respondelement="respond" aria-label='回复给9527'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment byuser comment-author-ibireme bypostauthor odd alt depth-2" id="li-comment-386">
		<article id="comment-386" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/df187c54252fd096504b2ff8390324b4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">ibireme <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 48.0.2564.10' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2015 年 12 月 15 日 的 下午 10:12				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>详情见这上面一条回复的讨论。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=386#respond' data-commentid="386" data-postid="41710" data-belowelement="comment-386" data-respondelement="respond" aria-label='回复给ibireme'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-481">
		<article id="comment-481" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ed0d156d9e2d46e83cb2537fc7b9d211?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ed0d156d9e2d46e83cb2537fc7b9d211?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Va No <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.134' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 1 月 11 日 的 上午 9:41				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>这是我见过,关于RunLoop写得最清楚,最准确(基于源码)的一篇博文!   期待博主的更多分享. 上Donate二维码吧,我小支持下&#8230;..</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=481#respond' data-commentid="481" data-postid="41710" data-belowelement="comment-481" data-respondelement="respond" aria-label='回复给Va No'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-546">
		<article id="comment-546" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/a04e06ef73c4381f6ba39d3a2e2deebe?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/a04e06ef73c4381f6ba39d3a2e2deebe?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">weiyan <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 48.0.2564.103' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 2 月 11 日 的 上午 11:24				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>失效文档：<br />
<a href="http://www.fenestrated.net/mirrors/Apple%20Technotes%20(As%20of%202002)/tn/tn2028.html" rel="nofollow">http://www.fenestrated.net/mirrors/Apple%20Technotes%20(As%20of%202002)/tn/tn2028.html</a></p>
<p>POSIX threads (pthreads) are layered on top of Mach threads.</p>
<p>Cocoa threads (NSThreads) are layered directly on top of pthreads.</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=546#respond' data-commentid="546" data-postid="41710" data-belowelement="comment-546" data-respondelement="respond" aria-label='回复给weiyan'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-556">
		<article id="comment-556" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/e34f238b96bcc99d5a3740bd988cec73?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/e34f238b96bcc99d5a3740bd988cec73?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Tiger <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.134' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 2 月 22 日 的 下午 4:27				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>文中说道:<br />
事件响应<br />
苹果注册了一个 Source1 (基于 mach port 的) 用来接收系统事件，其回调函数为 __IOHIDEventSystemClientQueueCallback()。</p>
<p>但按钮的事件处理是停在__CFRunLoopDoSources0, 是Sources0<br />
而不是Source1<br />
请问,问题出在哪里?</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=556#respond' data-commentid="556" data-postid="41710" data-belowelement="comment-556" data-respondelement="respond" aria-label='回复给Tiger'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-557">
		<article id="comment-557" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/e34f238b96bcc99d5a3740bd988cec73?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/e34f238b96bcc99d5a3740bd988cec73?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Tiger <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 43.0.2357.134' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 2 月 22 日 的 下午 5:06				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>看到评论里有解答的,谢谢</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=557#respond' data-commentid="557" data-postid="41710" data-belowelement="comment-557" data-respondelement="respond" aria-label='回复给Tiger'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-558">
		<article id="comment-558" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/8eff64e1ecaf40b2f9f7227169c972ec?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/8eff64e1ecaf40b2f9f7227169c972ec?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">小新 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/firefox.png' title='Mozilla Firefox 44.0' alt='Mozilla Firefox' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10.10' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 2 月 23 日 的 上午 11:24				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>当我突然发现这篇文章竟然是YYKit的作者写的时候, 我非常的震惊, 这人是有多牛X. 我最近在看YYKit(虽然目前还看不懂), 也有在看runTime和runLoop. 这篇文章简直太好了, 只少要看10遍, 收获非常大, 十分感激</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=558#respond' data-commentid="558" data-postid="41710" data-belowelement="comment-558" data-respondelement="respond" aria-label='回复给小新'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-563">
		<article id="comment-563" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/1c9e32f0dcdc2729d20bb1270ae684f3?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/1c9e32f0dcdc2729d20bb1270ae684f3?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">孙大龙 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/hk.png" title="Hong Kong" alt="Hong Kong" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 48.0.2564.109' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 2 月 26 日 的 上午 10:58				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>问博主：<br />
While (!self.runLoopThreadDidFinishFlag) {<br />
NSLog(@&#8221;Begin RunLoop&#8221;);<br />
[[NSRunLoop currentRunLoop] runMode:NSDefaultRunLoopMode beforeDate:[NSDate distantFuture]];<br />
NSLog(@&#8221;End RunLoop&#8221;);<br />
}<br />
“ [[NSRunLoop currentRunLoop] runMode:NSDefaultRunLoopMode beforeDate:[NSDate distantFuture]];” 这句到底做什么？<br />
是让主线程runloop进入休眠吗？不能理解为什么加了这句，代码就不会往下执行了？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=563#respond' data-commentid="563" data-postid="41710" data-belowelement="comment-563" data-respondelement="respond" aria-label='回复给孙大龙'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-576">
		<article id="comment-576" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7cd5b0d26d542811f03eea0e91862337?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7cd5b0d26d542811f03eea0e91862337?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Chen咯 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 48.0.2564.116' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 3 月 3 日 的 下午 3:25				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>在CF115.16中的__CFRunloopRun函数中发现了以下代码：</p>
<p>#if USE_DISPATCH_SOURCE_FOR_TIMERS<br />
    mach_port_name_t modeQueuePort = MACH_PORT_NULL;<br />
    if (rlm-&gt;_queue) {<br />
        modeQueuePort = _dispatch_runloop_root_queue_get_port_4CF(rlm-&gt;_queue);<br />
        if (!modeQueuePort) {<br />
            CRASH(&#8220;Unable to get port for run loop mode queue (%d)&#8221;, -1);<br />
        }<br />
    }<br />
#endif</p>
<p>看名字好像是可以使用Dispatch Source来实现Timer</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=576#respond' data-commentid="576" data-postid="41710" data-belowelement="comment-576" data-respondelement="respond" aria-label='回复给Chen咯'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-600">
		<article id="comment-600" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/dd349c6b5df667d58b276d07fa36982a?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/dd349c6b5df667d58b276d07fa36982a?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">wyf <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 48.0.2564.116' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 3 月 16 日 的 下午 10:25				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>结合着源码讲解挺不错的。https://github.com/wuyunfeng/LightWeightRunLoop  这个是我用BSD pipe 和 内核队列实现的Runloop，同时实现了你分析的timer 、urlconnection 等，还有很多有意思得事情，感兴趣的话可以看看</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=600#respond' data-commentid="600" data-postid="41710" data-belowelement="comment-600" data-respondelement="respond" aria-label='回复给wyf'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-604">
		<article id="comment-604" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/17fa130fd8f63ad0426c7f7d6e2cdd71?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/17fa130fd8f63ad0426c7f7d6e2cdd71?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">jackman <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 49.0.2623.87' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 3 月 17 日 的 上午 11:27				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>写得着实详尽，看了两遍了，依然有不懂的地方，准备再看第三遍 :shock:</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=604#respond' data-commentid="604" data-postid="41710" data-belowelement="comment-604" data-respondelement="respond" aria-label='回复给jackman'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-609">
		<article id="comment-609" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/49081d04a525359eee66dec439920090?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/49081d04a525359eee66dec439920090?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Zsam <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.3.9' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 3 月 18 日 的 下午 1:16				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>找到的最好地讲Runloop的文章,我想问下博主,源码里有CHECK_FOR_FORK(),这是什么意思呢?是定义在哪个文件的呢?</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=609#respond' data-commentid="609" data-postid="41710" data-belowelement="comment-609" data-respondelement="respond" aria-label='回复给Zsam'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-611">
		<article id="comment-611" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7f63c77fcbc1d5eea083ad15f57039a6?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7f63c77fcbc1d5eea083ad15f57039a6?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">leo <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.3.9' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 3 月 20 日 的 下午 5:16				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>您好 在文章中您提到如果需要切换 Mode，只能退出 Loop，再重新指定一个 Mode 进入,请问调用什么样的API来退出Loop</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=611#respond' data-commentid="611" data-postid="41710" data-belowelement="comment-611" data-respondelement="respond" aria-label='回复给leo'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-613">
		<article id="comment-613" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/dd349c6b5df667d58b276d07fa36982a?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/dd349c6b5df667d58b276d07fa36982a?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">wyf <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 49.0.2623.87' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 3 月 21 日 的 下午 8:45				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>切换mode不需要退出RunLoop 哦，https://github.com/wuyunfeng/LightWeightRunLoop</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=613#respond' data-commentid="613" data-postid="41710" data-belowelement="comment-613" data-respondelement="respond" aria-label='回复给wyf'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-629">
		<article id="comment-629" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/51b11b9db2b4b297a8cd3cad1fdd77d2?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/51b11b9db2b4b297a8cd3cad1fdd77d2?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">林栖谷隐 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/netscape.png' title='Netscape Navigator 5.0' alt='Netscape Navigator' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/iphone.png' title='iPhone iPhone OS 9_3_1 like Mac OS X) AppleWebKit' alt='iPhone' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 4 月 6 日 的 上午 12:34				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>大神你好，多谢分享，看了收获很多，但一直有一个问题困扰我，也没有找到答案，希望帮忙解答一下，runloop的内部已经有一个死循环去处理loop，来不停获取消息并处理，为什么我们在实现自定义子线程runloop的时候还需要一个死循环去驱动runloop呢？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=629#respond' data-commentid="629" data-postid="41710" data-belowelement="comment-629" data-respondelement="respond" aria-label='回复给林栖谷隐'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-839">
		<article id="comment-839" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/68687f0c9ef71dbf54b005589cc0fa71?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/68687f0c9ef71dbf54b005589cc0fa71?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Andrew <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 53.0.2785.143' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_0' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 10 月 14 日 的 上午 11:17				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>看上面的简化代码能看得出来，run 和 runInMode 都是调用带有循环的那个函数。run 的时候timeout参数是一个很小的数。在我们自己写线程的时候，如果调用的是[[NSRunLoop currentRunLoop] run]，那就需要在外面加个大循环，因为run是跑完一个loop，runloop内部的循环就退出了。但如果是调用的 runUntilDate 那就不用大循环</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=839#respond' data-commentid="839" data-postid="41710" data-belowelement="comment-839" data-respondelement="respond" aria-label='回复给Andrew'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-633">
		<article id="comment-633" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/258bb77ec49d46f51aa3a68a544b1470?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/258bb77ec49d46f51aa3a68a544b1470?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">XVXVXXX <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 49.0.2623.110' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 4 月 7 日 的 下午 7:17				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>评论 :shock:  :shock: 写的真好，感谢分享，学习了</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=633#respond' data-commentid="633" data-postid="41710" data-belowelement="comment-633" data-respondelement="respond" aria-label='回复给XVXVXXX'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-867">
		<article id="comment-867" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/53de1b720795b4c7c13a9be926a76a8b?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/53de1b720795b4c7c13a9be926a76a8b?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://zdaxia.com' rel='external nofollow' class='url'>zzzzzzzz</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 54.0.2840.98' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 11 月 20 日 的 上午 11:20				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>竟然在这里看到教练了</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=867#respond' data-commentid="867" data-postid="41710" data-belowelement="comment-867" data-respondelement="respond" aria-label='回复给zzzzzzzz'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-639">
		<article id="comment-639" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/b9757989e3ec746fdb4bb4f98861ecf3?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/b9757989e3ec746fdb4bb4f98861ecf3?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">王杰 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 600.8.9' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 4 月 13 日 的 上午 10:34				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>博主，为什么我用dispatch_async来标记tableView刷新完成 有时候不成功<br />
[tableView reloadData];<br />
    dispatch_async(dispatch_get_main_queue(), ^{<br />
        NSLog(@&#8221;刷新完成&#8221;);<br />
    });</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=639#respond' data-commentid="639" data-postid="41710" data-belowelement="comment-639" data-respondelement="respond" aria-label='回复给王杰'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-708">
		<article id="comment-708" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/33dd1e39717dcc430a84961910c0fe30?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/33dd1e39717dcc430a84961910c0fe30?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://blog.devcheng.com' rel='external nofollow' class='url'>Charvel</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.6.17' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 6 月 5 日 的 下午 11:22				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>我的理解是 tabView reload data 仅仅只是标记要去刷新 tableview。<br />
然后 dispatch 那里，你又给主线程的 Runloop 发送了任务 nslog 。<br />
接下来，主线程将会做刷新 tableview 的操作，同时，你的 nslog 任务也在中间穿插执行了。</p>
<p>因此，nslog 的执行，与 tableView reload 的顺序并没有什么依赖，不一定谁先执行。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=708#respond' data-commentid="708" data-postid="41710" data-belowelement="comment-708" data-respondelement="respond" aria-label='回复给Charvel'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-647">
		<article id="comment-647" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/08ffd7e9e40be57b26701a8dbef61f2f?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/08ffd7e9e40be57b26701a8dbef61f2f?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">天天 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.3.9' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 4 月 20 日 的 下午 12:49				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>求助大神, 我一直有一些问题想不通:<br />
  1. 我用一个控制台程序, 在main函数中测试[[NSRunLoop currentRunLoop] run];NSLog(@&#8221;is running&#8221;);, 发现没有打印, 我的理解是runloop一直没有结束, 所以执行不到后面的语句. 可是就是因为这个结果我产生了新的疑问.<br />
 2. 结合1中的理解, 在我的思维中, 肯定是先有主队列和主线程, 然后才可以将运行runloop的任务加入到主队列中的, 进而由主队列进行分发执行, 可是问题来了: 例如在一个iOS程序中, 假设所有的任务都在主线程中执行. 某一个时刻runloop在休眠期,然后用户的点击触发了一个事件, 接着runloop被唤醒, 开始响应用户的点击. 因为假设只有一个主线程,事件的响应会被加入到主队列, 此时runloop也正在主线程中执行, 并且不会结束,  主线程中的任务是同步执行的 . 可是runloop没有结束的情况下, 主线程却还是可以处理接受主队列的任务去用户的点击事件, 让我很疑惑, 是不是自己哪里理解错了, 求大神指点.</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=647#respond' data-commentid="647" data-postid="41710" data-belowelement="comment-647" data-respondelement="respond" aria-label='回复给天天'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-696">
		<article id="comment-696" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ab6126c791f94827871c89ca2ab0030a?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ab6126c791f94827871c89ca2ab0030a?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Naituw <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/ch.png" title="Switzerland" alt="Switzerland" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 50.0.2661.102' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 5 月 30 日 的 下午 6:02				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>主线程在休眠状态，点击事件在其他线程唤醒主线程</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=696#respond' data-commentid="696" data-postid="41710" data-belowelement="comment-696" data-respondelement="respond" aria-label='回复给Naituw'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-656">
		<article id="comment-656" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ee909b1d2af3bec65e6f0aa206f2bc6b?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ee909b1d2af3bec65e6f0aa206f2bc6b?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">xX <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 41.0.2272.101' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 4 月 25 日 的 下午 2:15				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>看后 受益匪浅。。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=656#respond' data-commentid="656" data-postid="41710" data-belowelement="comment-656" data-respondelement="respond" aria-label='回复给xX'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-703">
		<article id="comment-703" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/2ba476a9f118471ecb95c49ef5f2ebe0?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/2ba476a9f118471ecb95c49ef5f2ebe0?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Doon <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 50.0.2661.102' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 6 月 2 日 的 上午 5:14				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>难得见到写的这么深入的中文文章，非常不错。iOS深入以后其实都是操作系统层级的东西。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=703#respond' data-commentid="703" data-postid="41710" data-belowelement="comment-703" data-respondelement="respond" aria-label='回复给Doon'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-709">
		<article id="comment-709" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/0cb6db3931324b4d5a8f29cbf6e5ded0?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/0cb6db3931324b4d5a8f29cbf6e5ded0?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://成都' rel='external nofollow' class='url'>FrogTan</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 50.0.2661.102' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 6 月 7 日 的 下午 3:53				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>写的漂亮</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=709#respond' data-commentid="709" data-postid="41710" data-belowelement="comment-709" data-respondelement="respond" aria-label='回复给FrogTan'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-716">
		<article id="comment-716" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/fcedd8393fc0a83fc7d54111a79377ca?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/fcedd8393fc0a83fc7d54111a79377ca?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">漫漫代码路 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.5.17' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_10_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 6 月 13 日 的 下午 2:45				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>:oops:  :oops:  :oops: 评论</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=716#respond' data-commentid="716" data-postid="41710" data-belowelement="comment-716" data-respondelement="respond" aria-label='回复给漫漫代码路'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-717">
		<article id="comment-717" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/db515fd740fcce74e60eaaafb2189d3a?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/db515fd740fcce74e60eaaafb2189d3a?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">taylor <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.6.17' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 6 月 14 日 的 下午 2:48				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>目前来说国内发表的runloop最深刻的文章，赞一个。 :oops:<br />
纠正一个小不严谨，<br />
/// 如果mode里没有source/timer/observer, 直接返回。<br />
这里看了官方文档与源代码，应该是如果没有input source 与 timer就会返回。<br />
就算有observer也是会返回的。<br />
源代码：<br />
__CFRunLoopModeIsEmpty<br />
{<br />
  if (NULL != rlm-&gt;_sources0 &amp;&amp; 0 _sources0)) return false;<br />
  if (NULL != rlm-&gt;_sources1 &amp;&amp; 0 _sources1)) return false;<br />
  if (NULL != rlm-&gt;_timers &amp;&amp; 0 _timers)) return false;<br />
}</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=717#respond' data-commentid="717" data-postid="41710" data-belowelement="comment-717" data-respondelement="respond" aria-label='回复给taylor'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-723">
		<article id="comment-723" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/74220908e35a09b438a5ad33698dfc37?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/74220908e35a09b438a5ad33698dfc37?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://www.dreampiggy.com' rel='external nofollow' class='url'>dreampiggy</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.2.7' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 6 月 16 日 的 下午 5:32				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>非常感谢，写得非常相近，而且对整个RunLoop简介，伪代码实现，Darwin介绍，以及很多开源库的应用都介绍的很详细，真是可以当作教科书般的内容。对我这种菜鸟简直是太受用了。 :smile:</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=723#respond' data-commentid="723" data-postid="41710" data-belowelement="comment-723" data-respondelement="respond" aria-label='回复给dreampiggy'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-732">
		<article id="comment-732" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/fa30898d359a66040216ad6be8af0791?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/fa30898d359a66040216ad6be8af0791?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://www.cnblogs.com/markstray/' rel='external nofollow' class='url'>mark_stray</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 51.0.2704.103' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 6 月 24 日 的 下午 5:12				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>评论 博主 膜拜啊！太牛瓣，评论去的人也很牛掰！牛掰到 看了你的这篇文章之后我才知道我是新手? 学习中 留个脚印</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=732#respond' data-commentid="732" data-postid="41710" data-belowelement="comment-732" data-respondelement="respond" aria-label='回复给mark_stray'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-746">
		<article id="comment-746" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ea4b8b690ef2ab88a1d5f378e3e2af4f?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ea4b8b690ef2ab88a1d5f378e3e2af4f?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://www.antimoron.cn' rel='external nofollow' class='url'>AntiMoron</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 51.0.2704.103' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 7 月 14 日 的 上午 11:32				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>博主、我再问一个问题，怀疑是和run loop有关。<br />
    /**<br />
     * 添加快慢效果<br />
     */<br />
    private func animateView(view: UIView, i: Int) {<br />
        var option = UIViewAnimationOptions.CurveEaseInOut<br />
        var duration = 0.5<br />
        switch i {<br />
        case 0:<br />
            option = .CurveEaseIn<br />
            break<br />
        case 1:<br />
            duration = 0.3<br />
            option = .CurveLinear<br />
            break<br />
        case 2:<br />
            duration = 0.3<br />
            option = .CurveLinear<br />
            break<br />
        case 3:<br />
            option = .CurveEaseOut<br />
            break<br />
        default:<br />
            break<br />
        }<br />
        UIView.animateWithDuration(duration, delay: 0, options: option, animations: {<br />
            view.transform = CGAffineTransformRotate(view.transform, -CGFloat(M_PI) * 0.5)<br />
        }) { (completed: Bool) in<br />
            self.animateView(view, i: (i + 1) % 4)<br />
        }<br />
    }<br />
    /**<br />
     * 对loading做无限旋转动画<br />
     */<br />
    private func animateView(view: UIView) {<br />
        animateView(view, i: 0)<br />
    }</p>
<p>这样的代码，去做动画。 当被运动的UIView变多的（10个，应该还好）时候。在模拟器里却越运行越卡。 看他的内存使用没有增加，目测不是无限递归导致（毕竟是尾递归）。</p>
<p>想要分析性能问题出在哪里但是不知道从何入手。能支两招不？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=746#respond' data-commentid="746" data-postid="41710" data-belowelement="comment-746" data-respondelement="respond" aria-label='回复给AntiMoron'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-766">
		<article id="comment-766" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/c31450c22db912c31b3ce92ed74d20a8?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/c31450c22db912c31b3ce92ed74d20a8?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">宝强 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.6.17' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 7 月 30 日 的 下午 9:29				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>看懂这篇文章（或者说深入学习iOS，什么调用栈分析之类的）都需要哪些基础知识。麻烦列举一下，好为后面深入学习做准备。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=766#respond' data-commentid="766" data-postid="41710" data-belowelement="comment-766" data-respondelement="respond" aria-label='回复给宝强'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-769">
		<article id="comment-769" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/3474726f418a76532cf964fe8873f571?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/3474726f418a76532cf964fe8873f571?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">kudocc <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 50.0.2661.102' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 8 月 1 日 的 下午 4:13				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>刚刚在测试的时候看函数的调用栈发现手势识别UITapGestureRecognizer和UIButton的事件都是在source0(__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__)这个函数调用的。</p>
<p>我本人也觉得应该是系统通过message port来把事件传递过来的，而source0貌似只在进程内部来使用，有点困惑啊。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=769#respond' data-commentid="769" data-postid="41710" data-belowelement="comment-769" data-respondelement="respond" aria-label='回复给kudocc'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-775">
		<article id="comment-775" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/0c64421a106c2ad32e3eecc034c78636?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/0c64421a106c2ad32e3eecc034c78636?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">九二 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 601.5.17' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 8 月 6 日 的 下午 3:52				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>&gt; mode 切换为 TrackingRunLoopMode，这时 Timer 就不会被回调，并且也不会影响到滑动操作。<br />
这里应该是Timer依旧会被调用吧，不是同步了吗？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=775#respond' data-commentid="775" data-postid="41710" data-belowelement="comment-775" data-respondelement="respond" aria-label='回复给九二'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-789">
		<article id="comment-789" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/fc4bbed5d565fcce6117aec6edb5c6a5?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/fc4bbed5d565fcce6117aec6edb5c6a5?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">AiOSDeveloper <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 53.0.2785.57' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 8 月 16 日 的 下午 5:12				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>Hi, 线程执行入口函数后，循环逻辑是不是 “接受消息-&gt;处理-&gt;等待”，而不是“接受消息-&gt;等待-&gt;处理”？不好意思，可能没完全理解</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=789#respond' data-commentid="789" data-postid="41710" data-belowelement="comment-789" data-respondelement="respond" aria-label='回复给AiOSDeveloper'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-794">
		<article id="comment-794" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/75f89851f604e0a8c9446c23055e4520?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/75f89851f604e0a8c9446c23055e4520?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://无' rel='external nofollow' class='url'>iCodeWoods</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 52.0.2743.116' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 8 月 20 日 的 上午 10:38				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>疑问：<br />
每当 RunLoop 的内容发生变化时，RunLoop 都会自动将 _commonModeItems 里的 Source/Observer/Timer 同步到具有 &#8220;Common&#8221; 标记的所有Mode里。</p>
<p>当你创建一个 Timer 并加到 DefaultMode 时，Timer 会得到重复回调，但此时滑动一个TableView时，RunLoop 会将 mode 切换为 TrackingRunLoopMode，这时 Timer 就不会被回调，并且也不会影响到滑动操作。</p>
<p>Timer不是在DefaultMode里吗？<br />
DefaultMode不是&#8221;Common&#8221;的吗？<br />
RunLoop不是会自动将_commonModeItems里的Source/Observer/Timer同步到具有&#8221;Common&#8221;标记的所有Mode里吗？</p>
<p>那为什么Timer不会回调咧？难道此时 Timer 不在_commonModeItems里吗？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=794#respond' data-commentid="794" data-postid="41710" data-belowelement="comment-794" data-respondelement="respond" aria-label='回复给iCodeWoods'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-799">
		<article id="comment-799" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/fc4bbed5d565fcce6117aec6edb5c6a5?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/fc4bbed5d565fcce6117aec6edb5c6a5?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Reader <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 53.0.2785.70' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 8 月 23 日 的 下午 4:54				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>这个地方我也有疑问，“应用场景举例：主线程的 RunLoop 里有两个预置的 Mode：kCFRunLoopDefaultMode 和 UITrackingRunLoopMode。这两个 Mode 都已经被标记为&#8221;Common&#8221;属性。”为啥这两个“已经被标记为&#8221;Common&#8221;属性。”这里 UITrackingRunLoopMode 应该没有吧，否则 Timer 在 UITrackingRunLoopMode 下应该执行啊？期待大神解答</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=799#respond' data-commentid="799" data-postid="41710" data-belowelement="comment-799" data-respondelement="respond" aria-label='回复给Reader'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even depth-2" id="li-comment-800">
		<article id="comment-800" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/fc4bbed5d565fcce6117aec6edb5c6a5?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/fc4bbed5d565fcce6117aec6edb5c6a5?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Reader <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 53.0.2785.70' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 8 月 23 日 的 下午 5:28				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>明白了，新添加入的 Timer 是在 DefaultMode 里，但不在 _commonModeItems 里，所以此时切换到 TrackingMode 时，虽然 _commonModeItems 里的状态都被同步了到各自 Mode，但新添加的 Timer 因为不在 _commonModeItems 中，所以不会回调</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=800#respond' data-commentid="800" data-postid="41710" data-belowelement="comment-800" data-respondelement="respond" aria-label='回复给Reader'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-3" id="li-comment-801">
		<article id="comment-801" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/75f89851f604e0a8c9446c23055e4520?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/75f89851f604e0a8c9446c23055e4520?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">iCodeWoods <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 52.0.2743.116' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 8 月 25 日 的 下午 5:46				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>你确定Timer不在_commonModeItems里吗？那_commonModeItems放的都是哪些东西呢？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=801#respond' data-commentid="801" data-postid="41710" data-belowelement="comment-801" data-respondelement="respond" aria-label='回复给iCodeWoods'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-4" id="li-comment-810">
		<article id="comment-810" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/52e1aa3143cc83fddd982d8ca88d804e?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/52e1aa3143cc83fddd982d8ca88d804e?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Gocy <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 52.0.2743.116' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 9 月 3 日 的 下午 5:41				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>_commonModeItems放的是schedule在NSRunLoopCommonModes里的事件源呀，如果你是schedule在DefaultMode中，自然就不在这里，Common这个概念对Mode有用，对Event也有用，只有Common Event+Common Mode才等于多种Mode下都可以跑</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=810#respond' data-commentid="810" data-postid="41710" data-belowelement="comment-810" data-respondelement="respond" aria-label='回复给Gocy'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-809">
		<article id="comment-809" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/52e1aa3143cc83fddd982d8ca88d804e?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/52e1aa3143cc83fddd982d8ca88d804e?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Gocy <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 52.0.2743.116' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 9 月 3 日 的 下午 5:34				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>评论 :|  :|  博主你好，关于你写在定时器部分的有关超时丢弃的部分，我写了一个test，我重写了一个View的drawRect，啥也不干就sleep 3秒，然后在主线程中调用[view setNeedsDisplay]，然后立刻在mainRunLoop中schedule一个timeInterval &lt; 3 的timer，这个timer最后的表现是延迟执行，和文中不符0 0，求问可能原因？另外对于一个Repeat的Timer，如何判断其前几次该触发时的超时，是被缓存延后调用，还是直接被丢弃呢？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=809#respond' data-commentid="809" data-postid="41710" data-belowelement="comment-809" data-respondelement="respond" aria-label='回复给Gocy'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-812">
		<article id="comment-812" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/2063255714c89c7283d2538adadfeea8?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/2063255714c89c7283d2538adadfeea8?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">菜鸟一游 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 50.0.2661.102' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 9 月 5 日 的 上午 9:46				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>评论 :smile: vSync和runloop之间的关系好像没有细讲&#8230;正常transaction的commit不是会在runloop exit和beforeWating吗，那这和vSync似乎并没有关系，而且有可能是矛盾的&#8230;<br />
这两部分是怎么联系起来呢？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=812#respond' data-commentid="812" data-postid="41710" data-belowelement="comment-812" data-respondelement="respond" aria-label='回复给菜鸟一游'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-831">
		<article id="comment-831" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/67ed5afabcac13f91f128a4808b0043d?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/67ed5afabcac13f91f128a4808b0043d?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">向 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 51.0.2704.103' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_0' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 9 月 27 日 的 下午 5:59				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>“当调用 NSObject 的 performSelecter:afterDelay: 后，实际上其内部会创建一个 Timer 并添加到当前线程的 RunLoop 中。所以如果当前线程没有 RunLoop，则这个方法会失效。”请问如何得知内部创建了一个Timer？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=831#respond' data-commentid="831" data-postid="41710" data-belowelement="comment-831" data-respondelement="respond" aria-label='回复给向'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-854">
		<article id="comment-854" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/fcfa3f1e3de9edc7e9e7bd5957ab1e23?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/fcfa3f1e3de9edc7e9e7bd5957ab1e23?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">cookielib <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 54.0.2840.87' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_0' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 11 月 3 日 的 下午 11:20				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>有个问题，为什么启动app的时候，或者点击button的时候，会调用多次befortimers，beforsource。。。呢？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=854#respond' data-commentid="854" data-postid="41710" data-belowelement="comment-854" data-respondelement="respond" aria-label='回复给cookielib'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-866">
		<article id="comment-866" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/606842bc7072b649c0e67fe14fdc9289?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/606842bc7072b649c0e67fe14fdc9289?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">王飞 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 602.1.50' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 11 月 18 日 的 下午 8:06				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>男神你好：你博客里这样写：“这里有个概念叫 &#8220;CommonModes&#8221;：一个 Mode 可以将自己标记为&#8221;Common&#8221;属性（通过将其 ModeName 添加到 RunLoop 的 &#8220;commonModes&#8221; 中）。每当 RunLoop 的内容发生变化时，RunLoop 都会自动将 _commonModeItems 里的 Source/Observer/Timer 同步到具有 &#8220;Common&#8221; 标记的所有Mode里。<br />
应用场景举例：主线程的 RunLoop 里有两个预置的 Mode：kCFRunLoopDefaultMode 和 UITrackingRunLoopMode。这两个 Mode 都已经被标记为&#8221;Common&#8221;属性”<br />
    我的疑问是_commonModeItems里面存放的是commonModes的items吗？<br />
    如果是，为什么主线程的两个“common”标记的mode没有同步呢？<br />
    如果不是，那存储的是什么呢？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=866#respond' data-commentid="866" data-postid="41710" data-belowelement="comment-866" data-respondelement="respond" aria-label='回复给王飞'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment even depth-2" id="li-comment-1035">
		<article id="comment-1035" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/683a84c0c93c58fe6a084f34d662dbd7?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/683a84c0c93c58fe6a084f34d662dbd7?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://skx926.com' rel='external nofollow' class='url'>凯旋 孙</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 57.0.2987.110' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 4 月 1 日 的 下午 2:43				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>DefaultMode有自己的items，TrackingMode也有自己的items，这两个都属于CommonModes，你给CommonModes添加的items就会同时添加给DefaultMode和TrackingMode，所以无论当前RunLoop是处于DefaultMode还是TrackingMode，就都会执行CommonMode的items。实际上CommonModes并不是一个mode，他只是一个集合。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1035#respond' data-commentid="1035" data-postid="41710" data-belowelement="comment-1035" data-respondelement="respond" aria-label='回复给凯旋 孙'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-876">
		<article id="comment-876" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/78ae7b9c535202285181edf022e8d262?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/78ae7b9c535202285181edf022e8d262?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://casscqt.github.io' rel='external nofollow' class='url'>Cass</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 54.0.2840.98' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_11_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 12 月 3 日 的 上午 11:12				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>&#8220;上面的 Source/Timer/Observer 被统称为 mode item，一个 item 可以被同时加入多个 mode。但一个 item 被重复加入同一个 mode 时是不会有效果的。如果一个 mode 中一个 item 都没有，则 RunLoop 会直接退出，不进入循环。”<br />
ibireme大大,这里添加一个Observer item 也可以让runloop中持续跑下去吗？怎么我在一些文章中和代码试验中发现不会跑下去，例如这里的代码：http://www.jianshu.com/users/c5db87501fe1/timeline。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=876#respond' data-commentid="876" data-postid="41710" data-belowelement="comment-876" data-respondelement="respond" aria-label='回复给Cass'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-884">
		<article id="comment-884" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/99c46d8dd701dfaee441488e9f3839e9?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/99c46d8dd701dfaee441488e9f3839e9?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='https://github.com/banchichen' rel='external nofollow' class='url'>谭真</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/firefox.png' title='Mozilla Firefox 50.0' alt='Mozilla Firefox' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10.12' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 12 月 15 日 的 上午 11:42				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>来看第三遍~  :|  发现一个错别字：我们在深入看一下 Darwin 这个核心的架构，是再~  :!:</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=884#respond' data-commentid="884" data-postid="41710" data-belowelement="comment-884" data-respondelement="respond" aria-label='回复给谭真'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-928">
		<article id="comment-928" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/f07ecd03d13679c8dba1e33b43a2105c?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/f07ecd03d13679c8dba1e33b43a2105c?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">丹丹 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 602.1.50' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2016 年 12 月 22 日 的 下午 3:47				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>学习受教了，赞赞赞，收藏了。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=928#respond' data-commentid="928" data-postid="41710" data-belowelement="comment-928" data-respondelement="respond" aria-label='回复给丹丹'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-964">
		<article id="comment-964" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7e7a249301c55d364a1f0c9f030f7b95?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7e7a249301c55d364a1f0c9f030f7b95?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Kenshin <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 602.3.12' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_2' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 2 月 20 日 的 下午 6:47				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>CADisplayLink和NSTimer应该都是CFRunLoopTimer吧，从RunLoop看不到创建了Source。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=964#respond' data-commentid="964" data-postid="41710" data-belowelement="comment-964" data-respondelement="respond" aria-label='回复给Kenshin'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-984">
		<article id="comment-984" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ff92f21f725170e7ba2549faf2fa93c4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ff92f21f725170e7ba2549faf2fa93c4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">kevin <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 56.0.2924.87' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_0' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 2 月 26 日 的 下午 2:56				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>楼主Runloop内部逻辑示例图第7步唤醒runloop的应该是source1(port)</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=984#respond' data-commentid="984" data-postid="41710" data-belowelement="comment-984" data-respondelement="respond" aria-label='回复给kevin'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-985">
		<article id="comment-985" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ff92f21f725170e7ba2549faf2fa93c4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ff92f21f725170e7ba2549faf2fa93c4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">kevin <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 56.0.2924.87' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_0' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 2 月 26 日 的 下午 2:57				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>楼主Runloop内部逻辑示例图第7步唤醒runloop的应该是source1(port)</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=985#respond' data-commentid="985" data-postid="41710" data-belowelement="comment-985" data-respondelement="respond" aria-label='回复给kevin'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-1014">
		<article id="comment-1014" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/85fe4e89cc0dea8a2cb367a29e10c21e?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/85fe4e89cc0dea8a2cb367a29e10c21e?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">余泽锋 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 56.0.2924.87' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 3 月 14 日 的 上午 9:57				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>醍醐灌顶啊，大神能抽时间讲点线程的知识么？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1014#respond' data-commentid="1014" data-postid="41710" data-belowelement="comment-1014" data-respondelement="respond" aria-label='回复给余泽锋'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1018">
		<article id="comment-1018" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/3f9aaf294d1d3b4047f740bd7d097c92?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/3f9aaf294d1d3b4047f740bd7d097c92?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">君 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 602.4.8' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 3 月 20 日 的 下午 2:02				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>有个问题，如果被source1唤醒需要第9步处理source1。那么外部收不到处理这个source1的通知？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1018#respond' data-commentid="1018" data-postid="41710" data-belowelement="comment-1018" data-respondelement="respond" aria-label='回复给君'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-1028">
		<article id="comment-1028" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/224cfc411aeb445780c95aba52fe4d86?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/224cfc411aeb445780c95aba52fe4d86?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Will <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 602.1' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/iphone.png' title='iPhone iPhone OS 10_3 like Mac OS X) AppleWebKit' alt='iPhone' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 3 月 30 日 的 上午 12:03				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>在看af中创建线程的时为了让该线程的runloop不退出而创建了一个nsmachport对象，这里不能是一个timer source或者非port输入源吗？或者是添加一个observer啊？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1028#respond' data-commentid="1028" data-postid="41710" data-belowelement="comment-1028" data-respondelement="respond" aria-label='回复给Will'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1038">
		<article id="comment-1038" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/00169e03f606ed48dc919841dcbaeb5c?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/00169e03f606ed48dc919841dcbaeb5c?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">陈伟鑫 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 602.2.14' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 4 月 13 日 的 下午 2:45				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>楼主，你好，我这边有一个疑问，看到你上面说的“如果需要切换 Mode，只能退出 Loop，再重新指定一个 Mode 进入”，这里为什么要退出Loop？我测试tableView滑动打印堆栈，发现他里面是通过pushRunLoopMode将一个UITrackingRunLoopMode push进去，停止滑动的时候通过popRunLoopMode 返回让当前Mode切换回kCFRunLoopDefaultMode。希望可以解答一下。感谢。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1038#respond' data-commentid="1038" data-postid="41710" data-belowelement="comment-1038" data-respondelement="respond" aria-label='回复给陈伟鑫'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-1054">
		<article id="comment-1054" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ebf5768f08ed57a65f88029a1a80b088?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ebf5768f08ed57a65f88029a1a80b088?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">刘元明 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 602.1.50' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 5 月 6 日 的 上午 11:26				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>大神，pthread_main_np()被写成了pthread_main_thread_np()</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1054#respond' data-commentid="1054" data-postid="41710" data-belowelement="comment-1054" data-respondelement="respond" aria-label='回复给刘元明'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1083">
		<article id="comment-1083" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/8791ac1ac99f1263b6f10e8e34643557?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/8791ac1ac99f1263b6f10e8e34643557?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">小莊  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 602.1.50' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 6 月 9 日 的 下午 12:24				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>ibireme 您好。关于Runloop想请教您一些问题，望解惑。__CFRunLoopDoBlocks(rl, rlm) 这个方法是在执行被加入的block，应该怎么理解？Before waiting之前和After Waiting之后都有一次__CFRunLoopDoBlocks执行，After Waiting这个在执行什么block？ WeMobileDev公众号分享的“iOS 事件处理机制与图像渲染过程”一文中有关于标记UITableView reload 完成的一段代码，这个reload的动作的执行时机怎么会在两个block之间呢？<br />
dispatch_async(dispatch_get_main_queue(), ^{<br />
    _isReloadDone = NO;<br />
    [tableView reload];<br />
    dispatch_async(dispatch_get_main_queue(),^{<br />
        _isReloadDone = YES;<br />
    });<br />
});</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1083#respond' data-commentid="1083" data-postid="41710" data-belowelement="comment-1083" data-respondelement="respond" aria-label='回复给小莊'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-1096">
		<article id="comment-1096" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/415aa630d8a0c1467e8935bf6065bde0?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/415aa630d8a0c1467e8935bf6065bde0?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://kylinroc.github.io/' rel='external nofollow' class='url'>Kylin Roc</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 603.2.4' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 6 月 25 日 的 下午 9:54				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>__CFRunLoopDoBlocks 函数执行的是被 CFRunLoopPerformBlock 函数加入的 blocks</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1096#respond' data-commentid="1096" data-postid="41710" data-belowelement="comment-1096" data-respondelement="respond" aria-label='回复给Kylin Roc'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-1084">
		<article id="comment-1084" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/eee8d0d9aec53d1467be730c852cf1ce?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/eee8d0d9aec53d1467be730c852cf1ce?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">luca <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 603.2.4' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 6 月 11 日 的 上午 11:41				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>在CFRunLoop对外暴露管理Mode的接口这里</p>
<p>CFRunLoopRunInMode这个方法，返回的是CFRunLoopRunResult。<br />
实际上没有CFStringRef这个参数类型，并不需要传入modeName。根据文档介绍: Runs the current thread’s CFRunLoop object in a particular mode.<br />
需要传入的是CFRunLoopMode，CFTimeInterval和Boolean这三个类型。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1084#respond' data-commentid="1084" data-postid="41710" data-belowelement="comment-1084" data-respondelement="respond" aria-label='回复给luca'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-1085">
		<article id="comment-1085" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/849317c6e43d146238d3d2cf0e7498db?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/849317c6e43d146238d3d2cf0e7498db?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">蠢蛋 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 603.2.4' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 6 月 11 日 的 下午 12:32				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>mode<br />
The run loop mode to run. mode can be any arbitrary CFString. You do not need to explicitly create a run loop mode, although a run loop mode needs to contain at least one source or timer to run.</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1085#respond' data-commentid="1085" data-postid="41710" data-belowelement="comment-1085" data-respondelement="respond" aria-label='回复给蠢蛋'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even depth-2" id="li-comment-1097">
		<article id="comment-1097" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/415aa630d8a0c1467e8935bf6065bde0?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/415aa630d8a0c1467e8935bf6065bde0?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://kylinroc.github.io/' rel='external nofollow' class='url'>Kylin Roc</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 603.2.4' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2017 年 6 月 25 日 的 下午 9:56				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>typedef CFStringRef CFRunLoopMode CF_EXTENSIBLE_STRING_ENUM;</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1097#respond' data-commentid="1097" data-postid="41710" data-belowelement="comment-1097" data-respondelement="respond" aria-label='回复给Kylin Roc'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-1315">
		<article id="comment-1315" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/297e507e4b013bee127566e2139991c2?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/297e507e4b013bee127566e2139991c2?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">王 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 604.1.38' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 2 月 7 日 的 下午 6:04				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>runloop内部逻辑的配图，左边的标注是source0 ，按照官方文档，应该是基于port的事件，那就应该是source1呀，是不是？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1315#respond' data-commentid="1315" data-postid="41710" data-belowelement="comment-1315" data-respondelement="respond" aria-label='回复给王'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-1323">
		<article id="comment-1323" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ecc77b13d2cf25c449a46291926aab3a?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ecc77b13d2cf25c449a46291926aab3a?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">paul <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/hk.png" title="Hong Kong" alt="Hong Kong" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 63.0.3239.132' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 3 月 9 日 的 上午 10:48				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>苹果注册了一个 Source1 (基于 mach port 的) 用来接收系统事件，其回调函数为 __IOHIDEventSystemClientQueueCallback()。<br />
这里是不是写错了，应该是source0吧？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1323#respond' data-commentid="1323" data-postid="41710" data-belowelement="comment-1323" data-respondelement="respond" aria-label='回复给paul'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-1324">
		<article id="comment-1324" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/ecc77b13d2cf25c449a46291926aab3a?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/ecc77b13d2cf25c449a46291926aab3a?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">paul <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/hk.png" title="Hong Kong" alt="Hong Kong" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 63.0.3239.132' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_12_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 3 月 9 日 的 上午 10:51				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>附断点堆栈：<br />
    frame #22: 0x00000001887ec350 UIKit<code>-[UICollectionView touchesEnded:withEvent:] + 540<br />
    frame #23: 0x00000001887592a4 UIKit</code>forwardTouchMethod + 336<br />
    frame #24: 0x00000001887a793c UIKit<code>-[UIResponder touchesEnded:withEvent:] + 60<br />
    frame #25: 0x00000001887592a4 UIKit</code>forwardTouchMethod + 336<br />
    frame #26: 0x00000001887a793c UIKit<code>-[UIResponder touchesEnded:withEvent:] + 60<br />
    frame #27: 0x00000001885a4294 UIKit</code>_UIGestureRecognizerUpdate + 8988<br />
    frame #28: 0x00000001885e4820 UIKit<code>-[UIWindow _sendGesturesForEvent:] + 1132<br />
    frame #29: 0x00000001885e3e1c UIKit</code>-[UIWindow sendEvent:] + 764<br />
    frame #30: 0x0000000101ef51c0 LIKE<code>-[HiidoSDKCht sendEvent1:](self=0x00000001257e28a0, _cmd=, event=) at HiidoSDKCht.m:121 [opt]<br />
  * frame #31: 0x00000001885b44cc UIKit</code>-[UIApplication sendEvent:] + 248<br />
    frame #32: 0x00000001885b2794 UIKit<code>_UIApplicationHandleEventQueue + 5528<br />
    frame #33: 0x0000000183878efc CoreFoundation</code>__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 24<br />
    frame #34: 0x0000000183878990 CoreFoundation<code>__CFRunLoopDoSources0 + 540<br />
    frame #35: 0x0000000183876690 CoreFoundation</code>__CFRunLoopRun + 724<br />
    frame #36: 0x00000001837a5680 CoreFoundation`CFRunLoopRunSpecific + 384</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1324#respond' data-commentid="1324" data-postid="41710" data-belowelement="comment-1324" data-respondelement="respond" aria-label='回复给paul'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1331">
		<article id="comment-1331" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/aab76551ae425c305086b4d07e2a6831?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/aab76551ae425c305086b4d07e2a6831?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">谢晨 <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 65.0.3325.162' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 3 月 24 日 的 上午 12:47				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>我设置了 __IOHIDEventSystemClientQueueCallback 符号断点, 打印当前线程, {number = 2, name = com.apple.uikit.eventfetch-thread}  好像并不是主线程, 这里该如何理解?</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1331#respond' data-commentid="1331" data-postid="41710" data-belowelement="comment-1331" data-respondelement="respond" aria-label='回复给谢晨'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-1337">
		<article id="comment-1337" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/8e887131efce0b45ba406bee7a331402?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/8e887131efce0b45ba406bee7a331402?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">jjdd <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 65.0.3325.181' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_1' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 4 月 10 日 的 下午 4:09				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>当调用 performSelector:onThread: 时，实际上其会创建一个 Timer 加到对应的线程去，同样的，如果对应线程没有 RunLoop 该方法也会失效。</p>
<p>好像是source0不是timer</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1337#respond' data-commentid="1337" data-postid="41710" data-belowelement="comment-1337" data-respondelement="respond" aria-label='回复给jjdd'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1346">
		<article id="comment-1346" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/4f15cd438f4fa5c6aaab2f499e630f24?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/4f15cd438f4fa5c6aaab2f499e630f24?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">Jeff <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 605.1.15' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 5 月 2 日 的 上午 11:19				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>__Source0DidDispatchPortLastTime 这个是不是错了？应该是__Source1DidDispatchPortLastTime</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1346#respond' data-commentid="1346" data-postid="41710" data-belowelement="comment-1346" data-respondelement="respond" aria-label='回复给Jeff'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-1376">
		<article id="comment-1376" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/6b8cc020ce8aee676bb27ad838cbe337?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/6b8cc020ce8aee676bb27ad838cbe337?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">JayWang <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 67.0.3396.99' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 7 月 20 日 的 下午 6:05				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>膜拜下大神，看第二遍了，还是有很多地方看不懂，当行不够。继续看吧，希望看第三遍的时候，可以豁然开朗。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1376#respond' data-commentid="1376" data-postid="41710" data-belowelement="comment-1376" data-respondelement="respond" aria-label='回复给JayWang'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1406">
		<article id="comment-1406" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/3cef3b5ffa3eb8cb67fe5dda70c26a9f?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/3cef3b5ffa3eb8cb67fe5dda70c26a9f?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">cr02y <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/au.png" title="Australia" alt="Australia" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 69.0.3497.100' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 10 月 23 日 的 下午 10:34				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>文章中说到在beforewaiting和afterwaiting之间的这段时间线程会休眠，但是我在子线程b中用时间间隔为1ms的定时器去检查子线程a的isExecuting时，发现这个值一直是yes，是我的测试代码写得有问题吗？</p>
<p>另外，我在测试中发现runloop的循环周期时间长度是不固定的。这是不是由于任务量少的时候，runloop循环执行变快。反之，变慢（甚至有可能等于一个上限）。这个上限具体是多少呢？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1406#respond' data-commentid="1406" data-postid="41710" data-belowelement="comment-1406" data-respondelement="respond" aria-label='回复给cr02y'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-1407">
		<article id="comment-1407" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7557c615cb1e219814f8a7007ab09032?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7557c615cb1e219814f8a7007ab09032?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='https://www.jianshu.com/u/d7a4502b4258' rel='external nofollow' class='url'>Mister_Leo</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 69.0.3497.100' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 10 月 25 日 的 上午 11:26				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>内部处理逻辑写翻译的有问题啊，原文是这样的<br />
The Run Loop Sequence of Events<br />
Each time you run it, your thread’s run loop processes pending events and generates notifications for any attached observers. The order in which it does this is very specific and is as follows:</p>
<p>Notify observers that the run loop has been entered.<br />
Notify observers that any ready timers are about to fire.<br />
Notify observers that any input sources that are not port based are about to fire.<br />
Fire any non-port-based input sources that are ready to fire.<br />
If a port-based input source is ready and waiting to fire, process the event immediately. Go to step 9.<br />
Notify observers that the thread is about to sleep.<br />
Put the thread to sleep until one of the following events occurs:<br />
An event arrives for a port-based input source.<br />
A timer fires.<br />
The timeout value set for the run loop expires.<br />
The run loop is explicitly woken up.<br />
Notify observers that the thread just woke up.<br />
Process the pending event.<br />
If a user-defined timer fired, process the timer event and restart the loop. Go to step 2.<br />
If an input source fired, deliver the event.<br />
If the run loop was explicitly woken up but has not yet timed out, restart the loop. Go to step 2.<br />
Notify observers that the run loop has exited.</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1407#respond' data-commentid="1407" data-postid="41710" data-belowelement="comment-1407" data-respondelement="respond" aria-label='回复给Mister_Leo'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1413">
		<article id="comment-1413" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/17b0c5f049c51e672282d39e3055e986?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/17b0c5f049c51e672282d39e3055e986?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://kyson.cn' rel='external nofollow' class='url'>kysonzhu</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 70.0.3538.102' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_13_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2018 年 11 月 22 日 的 下午 11:43				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>麻烦问一下，如何调试cf代码</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1413#respond' data-commentid="1413" data-postid="41710" data-belowelement="comment-1413" data-respondelement="respond" aria-label='回复给kysonzhu'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-1428">
		<article id="comment-1428" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7ef5fb232c2be0032e410d5e1993a2f4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7ef5fb232c2be0032e410d5e1993a2f4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://github.com/hon-key' rel='external nofollow' class='url'>Mattttt</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 71.0.3578.98' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_14_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2019 年 3 月 2 日 的 下午 6:25				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>ibireme 我很崇拜你啊</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1428#respond' data-commentid="1428" data-postid="41710" data-belowelement="comment-1428" data-respondelement="respond" aria-label='回复给Mattttt'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1434">
		<article id="comment-1434" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7ef5fb232c2be0032e410d5e1993a2f4?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7ef5fb232c2be0032e410d5e1993a2f4?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='http://github.com/hon-key' rel='external nofollow' class='url'>Mattttt</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 71.0.3578.98' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_14_3' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2019 年 3 月 26 日 的 下午 5:46				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>就目前来看，其实应该是这样的：<br />
事件的响应的根源：事件的来源是 runloop 注册了一个基于 mach port 的 source1。当发生一个硬件事件时，会生成  IOHIDEvent 对象并注册一个source0<br />
当Runloop被唤醒后处理 Source0，此时回调 __handleHIDEventFetcherDrain() 再转调 __handleEventQueueInternal() 到 __dispatchPreprocessedEventFromEventQueue，来处理并包装成 UIEvent 进行处理和分发。<br />
对于手势识别：当上面的事件进行到 UIWindow 时，window 识别了一个手势，于是向 UIGestureEnvironment 分派该 UIEvent，UIGestureEnvironment 将找到合适的手势对象并发送 Action。<br />
而在之后的一系列相关的Event都将被侦测并转而调用 Cancel 将当前的 touchesBegin/Move/End 系列回调打断。<br />
随后系统将对应的 UIGestureRecognizer 标记为待处理。苹果注册了一个 Observer 监测 BeforeWaiting (Loop即将进入休眠) 事件，这个Observer的回调函数是 _UIGestureRecognizerUpdateObserver()，其内部会获取所有刚被标记为待处理的 GestureRecognizer，并执行GestureRecognizer的回调。<br />
当有 UIGestureRecognizer 的变化(创建/销毁/状态改变)时，这个回调都会进行相应处理。</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1434#respond' data-commentid="1434" data-postid="41710" data-belowelement="comment-1434" data-respondelement="respond" aria-label='回复给Mattttt'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-1447">
		<article id="comment-1447" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/7094ac9568655c1e69d2f717afa68440?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/7094ac9568655c1e69d2f717afa68440?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn"><a href='https://yanci.me' rel='external nofollow' class='url'>@许还真</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 74.0.3729.131' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_14_0' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2019 年 5 月 7 日 的 下午 11:15				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>挺喜欢作者这种风格，从底层（甚至到驱动层，描述掉帧那篇文章，vsync,hsync同步信号）到上层（应用层）讲了一遍，自底向上，非常棒！ 学习！</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1447#respond' data-commentid="1447" data-postid="41710" data-belowelement="comment-1447" data-respondelement="respond" aria-label='回复给@许还真'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1609">
		<article id="comment-1609" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/b105151078cc47cdfe2cd7e6a328fa60?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/b105151078cc47cdfe2cd7e6a328fa60?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">johnXia <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/safari.png' title='Safari 605.1.15' alt='Safari' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_14_5' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2019 年 7 月 13 日 的 下午 8:14				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>runloop可以阻塞住代码运行，有没有同学玩用过……我出现个问题，弹出的alert点击不能取消</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1609#respond' data-commentid="1609" data-postid="41710" data-belowelement="comment-1609" data-respondelement="respond" aria-label='回复给johnXia'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-1610">
		<article id="comment-1610" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/3804df34c62acec1a5f29f4649a685ba?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/3804df34c62acec1a5f29f4649a685ba?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">hhb <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 73.0.3683.86' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_14_4' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2019 年 7 月 19 日 的 上午 10:29				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>IOHIDEvent HID的含义能说说吗？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1610#respond' data-commentid="1610" data-postid="41710" data-belowelement="comment-1610" data-respondelement="respond" aria-label='回复给hhb'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1624">
		<article id="comment-1624" class="comment-body clearfix">
			<div class="comment_avatar">
				<img alt='' src='https://gravatar.ibireme.com/avatar/5414c13e6d398c8d2cc7835cfe085d2d?s=80&#038;d=mm&#038;r=g' srcset='https://gravatar.ibireme.com/avatar/5414c13e6d398c8d2cc7835cfe085d2d?s=160&#038;d=mm&#038;r=g 2x' class='avatar avatar-80 photo' height='80' width='80' />			</div>

			<div class="comment_postinfo">
				<span class="fn">yumo zhu <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/chrome.png' title='Google Chrome 79.0.3945.117' alt='Google Chrome' width='14px' height='14px' class='browser-icon' />   <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/macos.png' title='Mac OS X 10_14_6' alt='Mac OS' width='14px' height='14px' class='os-icon' />  </span>				<span class="comment_date">
				在 2020 年 2 月 2 日 的 下午 11:08				</span>
										</div> <!-- .comment_postinfo -->

			<div class="comment_area">
				
				<div class="comment-content clearfix">
				<p>首先表示感谢，看了两晚上，再艰难地阅读了下源码后，终于大概了解了个七七八八。<br />
另外我这有个疑问，观察kCFRunLoopBeforeTimers有实际的应用场景吗？因为在我的理解中，接收到这个通知貌似除了意味着新的一个循环开始执行了，不能代表其他任何事，甚至都不一定存在timer，只是因为不停有source事件插入于是不停地在循环，于是就会进行多次kCFRunLoopBeforeTimers的回调，那这种回调有什么意义？</p>
<span class="reply-container"><a rel='nofollow' class='comment-reply-link' href='/2015/05/18/runloop/?replytocom=1624#respond' data-commentid="1624" data-postid="41710" data-belowelement="comment-1624" data-respondelement="respond" aria-label='回复给yumo zhu'>回复</a></span>				</div> <!-- end comment-content-->
			</div> <!-- end comment_area-->
		</article> <!-- .comment-body -->
</li><!-- #comment-## -->
			</ol>
		
		
					<div id="trackbacks">
				<h3 id="trackbacks-title">引用/广播</h3>
				<ol class="pinglist">
						<li id="comment-44"><a href='http://www.jkeabc.com/p/978621.html' rel='external nofollow' class='url'>WWDC 15看点汇总 &#8211; iOS移动开发周报 &#8211; 剑客|关注科技互联网</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.2.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 《深入理解RunLoop》：iOS 开发中对 Runloop 和 Thread 的概念的理解和使用往往是区分开发者层次的重要部分。这篇文章中从基础开始详细介绍了 Runloop 的种种，很值得学习。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-83"><a href='http://123.56.94.74/wordpress/?p=94' rel='external nofollow' class='url'>[转载]《招聘一个靠谱的iOS》面试题参考答案（下） - See You Again</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.2.4' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 《深入理解RunLoop》 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-85"><a href='http://www.100mian.com/2015/09/%e6%8b%9b%e8%81%98%e4%b8%80%e4%b8%aa%e9%9d%a0%e8%b0%b1%e7%9a%84ios%e7%a8%8b%e5%ba%8f%e5%91%98%e9%9d%a2%e8%af%95%e9%a2%98%e7%ad%94%e6%a1%88%e9%83%a8%e5%88%86%e3%80%90%e4%' rel='external nofollow' class='url'>招聘一个靠谱的iOS程序员面试题答案部分【下】 |</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 《深入理解RunLoop》 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-99"><a href='http://jwzhangjie.cn/2015/10/11/%e6%b7%b1%e5%ba%a6%e8%a7%a3%e6%9e%90ios%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f/' rel='external nofollow' class='url'>深度解析iOS应用程序的生命周期 | jwzhangjie</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-181"><a href='http://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/' rel='external nofollow' class='url'>iOS 保持界面流畅的技巧 | Garan no dou</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章 深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-195"><a href='http://www.numob.com/blog/ios/smooth_user_interfaces_for_ios' rel='external nofollow' class='url'>iOS 保持界面流畅的技巧 | 青岛诺动信息科技有限公司</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-313"><a href='http://www.itdadao.com/article/25145/' rel='external nofollow' class='url'>深入理解RunLoop</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 的概念RunLoop 与线程的关系RunLoop 对外的接口RunLoop 的 ModeRunLoop 的内部逻辑RunLoop 的底层实现苹果用 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-324"><a href='http://caoyuanhe.com/wordpress/2015/12/02/%e5%a6%82%e4%bd%95%e8%ae%a9ios-%e4%bf%9d%e6%8c%81%e7%95%8c%e9%9d%a2%e6%b5%81%e7%95%85%ef%bc%9f%e8%bf%99%e4%ba%9b%e6%8a%80%e5%b7%a7%e4%bd%a0%e7%9f%a5%e9%81%93%' rel='external nofollow' class='url'>如何让iOS 保持界面流畅？这些技巧你知道吗</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章 深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-359"><a href='http://www.zawaya.xyz/2015/12/09/%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3runloop%e8%bd%ac/' rel='external nofollow' class='url'>深入理解RunLoop(转) | Hello World.</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/hk.png" title="Hong Kong" alt="Hong Kong" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop 的概念 RunLoop 与线程的关系 RunLoop 对外的接口 RunLoop 的 Mode RunLoop 的内部逻辑 RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-360"><a href='http://www.zawaya.xyz/2015/12/09/ios-%e4%bf%9d%e6%8c%81%e7%95%8c%e9%9d%a2%e6%b5%81%e7%95%85%e7%9a%84%e6%8a%80%e5%b7%a7%ef%bc%88%e8%bd%ac%ef%bc%89/' rel='external nofollow' class='url'>iOS 保持界面流畅的技巧（转） | Hello World.</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/hk.png" title="Hong Kong" alt="Hong Kong" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章 深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-429"><a href='http://www.itdadao.com/article/77424/' rel='external nofollow' class='url'>芒果iOS开发之高级面试题二-IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 《深入理解RunLoop》 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-446"><a href='http://www.itdadao.com/article/93987/' rel='external nofollow' class='url'>iOS 保持界面流畅的技巧(最全最详尽的了)-IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop，里面对 ASDK 也有所提及。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-476"><a href='http://www.itdadao.com/article/160330/' rel='external nofollow' class='url'>深入理解RunLoop-IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop 的概念 RunLoop 与线程的关系 RunLoop 对外的接口 RunLoop 的 Mode RunLoop 的内部逻辑 RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-521"><a href='http://www.itdadao.com/article/254078/' rel='external nofollow' class='url'>iOS 保持界面流畅的技巧-IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章&nbsp;深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-528"><a href='http://www.itdadao.com/article/287781/' rel='external nofollow' class='url'>互联网上iOS学习系列博文（收集）-IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop | Garan no dou [&#8230;]</li><!-- #comment-## -->
	<li id="comment-530"><a href='http://www.itdadao.com/article/292983/' rel='external nofollow' class='url'>RunLoop深度探究（三）-IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] http://blog.ibireme.com/2015/05/18/runloop/#more-41710 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-531"><a href='http://www.itdadao.com/article/292985/' rel='external nofollow' class='url'>RunLoop深度探究（二）-IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] http://blog.ibireme.com/2015/05/18/runloop/#more-41710 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-534"><a href='http://www.itdadao.com/article/309878/' rel='external nofollow' class='url'>从代码中认识RunLoop-IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 现在网上关于RunLoop的资料真是太多了，而且大同小异，如果只是看一遍不在代码里面实现一下的话，也只能了解点皮毛，当然这样动笔写一些，更能加深印象。这次学习笔记参考自：链接1链接2链接3本文代码都可以下载demo调试或者自己编写测试 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-568"><a href='http://www.aliog.com/98335.html' rel='external nofollow' class='url'>iOS知识树，知识目录（包括对象、Block、消息转发、GCD、运行时、runloop、动画、Push、KVO、tableview，UIViewController、提交AppStore） - 移动开发 - 阿里欧歌</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.4.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;|-&gt;&nbsp;CFRunnloop &nbsp;【ibireme出品&nbsp;点击】&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [&#8230;]</li><!-- #comment-## -->
	<li id="comment-569"><a href='http://www.itdadao.com/article/460518/' rel='external nofollow' class='url'>Toll-free bridging - IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] http://blog.ibireme.com/2015/05/18/runloop/ [&#8230;]</li><!-- #comment-## -->
	<li id="comment-572"><a href='http://www.itdadao.com/article/468410/' rel='external nofollow' class='url'>iOS知识树，知识目录（包括对象、Block、消息转发、GCD、运行时、runloop、动画、Push、KVO、tableview，UIViewController、提交AppStore） - IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;|-&gt;&nbsp;CFRunnloop &nbsp;【ibireme出品&nbsp;点击】 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&hellip;</li><!-- #comment-## -->
	<li id="comment-580"><a href='http://www.itdadao.com/article/529012/' rel='external nofollow' class='url'>深入理解Runloop - IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] &nbsp;阅读原文 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-591"><a href='http://www.alexcode.cn/2016/03/14/articlecollection/' rel='external nofollow' class='url'>Alex博客笔记 | 移动开发技能点收集整理(长期更新2016.3.14)</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.4.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-594"><a href='http://www.itdadao.com/article/592175/' rel='external nofollow' class='url'>让界面更加流畅的几个技巧 - IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-596"><a href='http://www.aliog.com/99563.html' rel='external nofollow' class='url'>从NSTimer的失效性谈起（一）：关于NSTimer和NSRunLoop - 移动开发 - 阿里欧歌</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.4.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 关于NSRunLoop的进一步探究，可以参考：Run Loops，NSRunLoop Internals，CFRunLoop.c，深入理解RunLoop。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-597"><a href='http://www.itdadao.com/article/597187/' rel='external nofollow' class='url'>从NSTimer的失效性谈起（一）：关于NSTimer和NSRunLoop - IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 关于NSRunLoop的进一步探究，可以参考：Run Loops，NSRunLoop Internals，CFRunLoop.c，深入理解RunLoop。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-610"><a href='http://iphil.cc/?p=279' rel='external nofollow' class='url'>深入理解RunLoop |</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.4.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop 的概念 RunLoop 与线程的关系 RunLoop 对外的接口 RunLoop 的 Mode RunLoop 的内部逻辑 RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-612"><a href='http://www.itdadao.com/article/649572/' rel='external nofollow' class='url'>61.iOS 保持界面流畅的技巧 - IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.4.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] &nbsp;深入理解RunLoop，里面对 ASDK 也有所提及。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-616"><a href='http://www.itdadao.com/article/669721/' rel='external nofollow' class='url'>初次接触 RunLoop - IT大道</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.4.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-622"><a href='http://www.shellsec.com/news/7907.html' rel='external nofollow' class='url'>IOS Timer 盘点 | 神刀安全网</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] http://blog.ibireme.com/2015/05/18/runloop/ [&#8230;]</li><!-- #comment-## -->
	<li id="comment-625"><a href='http://news.ouoshop.com/archives/83994' rel='external nofollow' class='url'>让 BAT 的 Offer 不再难拿 &#8212; developerWorks-同行快讯网</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.4.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-636"><a href='http://zjh.ooo/2016/04/11/problems-part-2/' rel='external nofollow' class='url'>problems part.2 &#8211; Startor</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/hk.png" title="Hong Kong" alt="Hong Kong" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.4.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 《深入理解RunLoop》 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-642"><a href='http://www.aliog.com/103933.html' rel='external nofollow' class='url'>iOS 保持界面流畅的技巧 - 编程语言 - 阿里欧歌</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.4.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-643"><a href='http://blog.qiji.tech/archives/9125' rel='external nofollow' class='url'>[iOS] RunLoop 学习 | 技术学习小组</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] ibireme 的博客 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-649"><a href='https://kyoucr-078n.rhcloud.com/2016/04/20/%e8%ae%a9-bat-%e7%9a%84-offer-%e4%b8%8d%e5%86%8d%e9%9a%be%e6%8b%bf/' rel='external nofollow' class='url'>让 BAT 的 Offer 不再难拿 &#8211; kyoucr博客</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.5' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-651"><a href='https://www.hrbustacm.com/2957.html' rel='external nofollow' class='url'>三月份实习校招后，也该为 BAT 秋招囤一些干货了 | 老豆比IT站</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.4.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 基本概念，猜想一下内部是怎么实现的－参考链接 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-663"><a href='http://www.dazhongdu.com/?p=2502' rel='external nofollow' class='url'>iOS中autorelease的那些事儿 | 大众阅读</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.2.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] &#x6DF1;&#x5165;&#x7406;&#x89E3;RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-677"><a href='http://life4school.com/%e5%b0%8f%e7%ac%a8%e7%8b%bc%e6%bc%ab%e8%b0%88%e5%a4%9a%e7%ba%bf%e7%a8%8b%ef%bc%9ansthread/' rel='external nofollow' class='url'>小笨狼漫谈多线程：NSThread - 恰同学少年-不称</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.2.8' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] runloop相关知识可以阅读ibireme的深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-679"><a href='http://life4school.com/ios-%e4%ba%8b%e4%bb%b6%e5%a4%84%e7%90%86%e6%9c%ba%e5%88%b6%e4%b8%8e%e5%9b%be%e5%83%8f%e6%b8%b2%e6%9f%93%e8%bf%87%e7%a8%8b/' rel='external nofollow' class='url'>iOS 事件处理机制与图像渲染过程 - 恰同学少年-不称</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.2.8' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解runloop (http://blog.ibireme.com/2015/05/18/runloop/) [&#8230;]</li><!-- #comment-## -->
	<li id="comment-680"><a href='http://life4school.com/%e5%a6%82%e4%bd%95%e8%ae%a9ios-%e4%bf%9d%e6%8c%81%e7%95%8c%e9%9d%a2%e6%b5%81%e7%95%85%ef%bc%9f%e8%bf%99%e4%ba%9b%e6%8a%80%e5%b7%a7%e4%bd%a0%e7%9f%a5%e9%81%93%e5%90%97/' rel='external nofollow' class='url'>如何让iOS 保持界面流畅？这些技巧你知道吗 - 恰同学少年-不称</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.2.8' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章&nbsp;深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-681"><a href='http://life4school.com/%e3%80%8a%e6%8b%9b%e8%81%98%e4%b8%80%e4%b8%aa%e9%9d%a0%e8%b0%b1%e7%9a%84ios%e3%80%8b%e9%9d%a2%e8%af%95%e9%a2%98%e5%8f%82%e8%80%83%e7%ad%94%e6%a1%88%ef%bc%88%e4%b8%8b%ef%bc%89/' rel='external nofollow' class='url'>《招聘一个靠谱的iOS》面试题参考答案（下） - 恰同学少年-不称</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.2.8' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 《深入理解RunLoop》 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-682"><a href='http://life4school.com/ios%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f/' rel='external nofollow' class='url'>iOS应用程序的生命周期 - 恰同学少年-不称</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.2.8' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Programming Guide for iOSDeveloping iOS 7 App for iPhone and iPad深入理解RunLoopObjective-C Autorelease Pool [&#8230;]</li><!-- #comment-## -->
	<li id="comment-695"><a href='http://tech.itdadao.com/8501.html' rel='external nofollow' class='url'>从实践谈iOS生命周期-IT技术</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.5.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-697"><a href='http://tech.itdadao.com/11749.html' rel='external nofollow' class='url'>多线程：NSThread-IT技术</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.5.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] runloop相关知识可以阅读ibireme的 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-698"><a href='http://tech.itdadao.com/12103.html' rel='external nofollow' class='url'>小笨狼漫谈多线程：NSThread-IT技术</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.5.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] runloop相关知识可以阅读ibireme的 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-699"><a href='http://tech.itdadao.com/12738.html' rel='external nofollow' class='url'>其实 iOS 多线程，都在这里了-IT技术</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.5.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 来处理消息，Runloop 相关的知识可以去看 @ibireme 大神的文章《 深入理解 RunLoop 》。主线程负责处理 App 的 UI [&#8230;]</li><!-- #comment-## -->
	<li id="comment-700"><a href='http://tech.itdadao.com/14862.html' rel='external nofollow' class='url'>初识 Run Loop-IT技术</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.5.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop | Garan no dou [&#8230;]</li><!-- #comment-## -->
	<li id="comment-701"><a href='http://www.shellsec.com/news/23828.html' rel='external nofollow' class='url'>初识 Run Loop | 神刀安全网</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.4' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop | Garan no dou [&#8230;]</li><!-- #comment-## -->
	<li id="comment-715"><a href='http://www.shellsec.com/news/27356.html' rel='external nofollow' class='url'>试答卓同学的 iOS 面试题 | 神刀安全网</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.4' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深挖请去看此文 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-734"><a href='http://takeaseat.me/2016/06/06/%e9%98%85%e8%af%bb%e6%96%87%e7%ab%a0%e8%ae%b0%e5%bd%95/' rel='external nofollow' class='url'>阅读文章记录 &#8211; Take a Seat</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.5.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-743"><a href='http://www.shellsec.com/news/34773.html' rel='external nofollow' class='url'>再看CVE-2016-1757-浅析mach message的使用 | 神刀安全网</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.5' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 图片转自(http://blog.ibireme.com/2015/05/18/runloop/)。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-744"><a href='http://77mq.com/2016/07/08/%e5%86%8d%e7%9c%8bcve-2016-1757-%e6%b5%85%e6%9e%90mach-message%e7%9a%84%e4%bd%bf%e7%94%a8/' rel='external nofollow' class='url'>再看CVE-2016-1757-浅析mach message的使用 - 莹莹之色</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.5' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 图片转自(http://blog.ibireme.com/2015/05/18/runloop/)。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-761"><a href='http://www.shellsec.com/news/39432.html' rel='external nofollow' class='url'>深入研究 Runloop 与线程保活 | 神刀安全网</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.5' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解 RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-791"><a href='http://devthinking.com/2016/01/03/ios%e7%bd%91%e5%9d%80%e5%a4%a7%e5%85%a8/' rel='external nofollow' class='url'>iOS网址大全 &#8211; ShawnDu的博客</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解runloop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-793"><a href='https://devthinking.com/?p=43' rel='external nofollow' class='url'>iOS网址大全 | ShawnDu博客</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解runloop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-797"><a href='https://devthinking.com/ios-%e7%bd%91%e5%9d%80%e5%a4%a7%e5%85%a8-%e5%bc%80%e5%8f%91%e8%b5%84%e6%ba%90%e9%9b%86%e5%90%88/' rel='external nofollow' class='url'>iOS 网址大全 开发资源集合 - Shawn Du&#039;s Blog</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解runloop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-808"><a href='http://www.codeba.cc/ios-%e4%bf%9d%e6%8c%81%e7%95%8c%e9%9d%a2%e6%b5%81%e7%95%85%e7%9a%84%e6%8a%80%e5%b7%a7.html' rel='external nofollow' class='url'>iOS 保持界面流畅的技巧 | Codeba</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.5.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-827"><a href='http://www.appservice.club/?p=337' rel='external nofollow' class='url'>iOS 保持界面流畅的技巧 | 梦幻泡影--孔德志个人博客</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-844"><a href='http://77mq.com/2016/10/19/%e5%85%b3%e4%ba%8e-ios-%e5%bc%82%e6%ad%a5%e5%bc%80%e5%8f%91%e7%9a%84%e7%9f%a5%e8%af%86%e6%80%bb%e7%bb%93-objective-c-swift-%e5%8f%8c%e8%af%ad/' rel='external nofollow' class='url'>关于 iOS 异步开发的知识总结 - (Objective-C &amp;&amp; Swift 双语) - 莹莹之色</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 来处理消息，Runloop 相关的知识可以去看 @ibireme 大神的文章《 深入理解 RunLoop 》是我看到最好的介绍 Runloop 相关知识的文章。主线程负责处理 App 的 UI [&#8230;]</li><!-- #comment-## -->
	<li id="comment-847"><a href='http://code.bejson.com/html/3610.html' rel='external nofollow' class='url'>爱代码 &raquo; iOS开发&#8211; RunLoop的基本概念与运用</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.5.4' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 【http://blog.ibireme.com/2015/05/18/runloop/】 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-848"><a href='http://www.codeba.cc/ios%e5%bc%80%e5%8f%91-8.html' rel='external nofollow' class='url'>iOS开发 | Codeba</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.5.4' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 【http://blog.ibireme.com/2015/05/18/runloop/】 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-856"><a href='http://life4school.com/%e4%bb%8e%e6%ba%90%e7%a0%81%e7%9c%8brunloop/' rel='external nofollow' class='url'>从源码看runLoop | 恰同学少年-不称</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-857"><a href='http://www.shellsec.com/news/32673.html' rel='external nofollow' class='url'>iOS多线程&#8211;彻底学会多线程之『RunLoop』 | 神刀安全网</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 先来看一张表示这5个类的关系图（来源：http://blog.ibireme.com/2015/05/18/runloop/）。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-863"><a href='http://life4school.com/%e4%bd%bf%e7%94%a8-asdk-%e6%80%a7%e8%83%bd%e8%b0%83%e4%bc%98-%e6%8f%90%e5%8d%87-ios-%e7%95%8c%e9%9d%a2%e7%9a%84%e6%b8%b2%e6%9f%93%e6%80%a7%e8%83%bd/' rel='external nofollow' class='url'>使用 ASDK 性能调优 &#8211; 提升 iOS 界面的渲染性能 | 恰同学少年-不称</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解 RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-880"><a href='http://fandong.me/?p=3106' rel='external nofollow' class='url'>RunLoop 总结：RunLoop的应用场景（二） - 范东</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop(不要看到右边滚动条很长，其实文章占篇幅2/5左右，下面有很多的评论，可见这篇文章的火热) [&#8230;]</li><!-- #comment-## -->
	<li id="comment-882"><a href='http://life4school.com/runloop-%e6%80%bb%e7%bb%93%ef%bc%9arunloop%e7%9a%84%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af%ef%bc%88%e4%ba%8c%ef%bc%89/' rel='external nofollow' class='url'>RunLoop 总结：RunLoop的应用场景（二） | 恰同学少年-不称</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop(不要看到右边滚动条很长，其实文章占篇幅2/5左右，下面有很多的评论，可见这篇文章的火热) [&#8230;]</li><!-- #comment-## -->
	<li id="comment-887"><a href='http://aes.jypc.org/?p=7033' rel='external nofollow' class='url'>从源码看runLoop &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop  [&#8230;]</li><!-- #comment-## -->
	<li id="comment-888"><a href='http://aes.jypc.org/?p=7543' rel='external nofollow' class='url'>iOS多线程&#8211;彻底学会多线程之『RunLoop』 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 先来看一张表示这5个类的关系图（来源：http://blog.ibireme.com/2015/05/18/runloop/）。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-889"><a href='http://aes.jypc.org/?p=8459' rel='external nofollow' class='url'>iOS 开发 &#8211; 深入理解 NSTimer 为什么要配合 NSRunLoop 进行使用 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop的基本概念与例子分析##深入理解RunLoop##5.另外附上本片博客所使用的 demo 的 github 地址 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-890"><a href='http://aes.jypc.org/?p=8527' rel='external nofollow' class='url'>runLoop的终极大杀器 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 参考: 一个iOS菜菜的白话文记录YY大神百度孙源的runLoop视频 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-898"><a href='http://aes.jypc.org/?p=17506' rel='external nofollow' class='url'>获取任意线程调用栈的那些事 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-900"><a href='http://aes.jypc.org/?p=18383' rel='external nofollow' class='url'>iOS 常见知识点（二）：RunLoop &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] ibireme 的 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-904"><a href='http://aes.jypc.org/?p=23320' rel='external nofollow' class='url'>深入研究 Runloop 与线程保活 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解 RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-907"><a href='http://aes.jypc.org/?p=28686' rel='external nofollow' class='url'>iOS 精品博客资源（持续完善） &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 1、深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-909"><a href='http://aes.jypc.org/?p=30950' rel='external nofollow' class='url'>[进阶] 关于 iOS 多线程，都在这里了 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 来处理消息，Runloop 相关的知识可以去看 @ibireme 大神的文章《深入理解 RunLoop》是我看到最好的介绍 Runloop 相关知识的文章。主线程负责处理 App 的 UI [&#8230;]</li><!-- #comment-## -->
	<li id="comment-910"><a href='http://aes.jypc.org/?p=35114' rel='external nofollow' class='url'>iOS RunLoop进阶 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 1.http://blog.ibireme.com/2015/05/18/runloop/2.http://iphonedevwiki.net/index.php/IOHIDFamily3.http://www.dreamingwish.com/article/ios-multithread-program-runloop-the.html [&#8230;]</li><!-- #comment-## -->
	<li id="comment-911"><a href='http://aes.jypc.org/?p=35761' rel='external nofollow' class='url'>iOS RunLoop 学习笔记 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop 时所作的一些笔记，主要来源于 YYKit 作者 的这篇文章，感谢 ibireme [&#8230;]</li><!-- #comment-## -->
	<li id="comment-912"><a href='http://aes.jypc.org/?p=35945' rel='external nofollow' class='url'>iOS里的内存泄露 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 我们能看到断点1和断点2 runloop还是在执行的，断点3表示runloop一个迭代已经结束了，即将进入睡眠。这里如果对runloop不了解的话可以看ibireme的这篇深入理解RunLoop。我截取里面的一小段，大家可以看一下。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-916"><a href='http://aes.jypc.org/?p=39554' rel='external nofollow' class='url'>初次接触 RunLoop &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-918"><a href='http://aes.jypc.org/?p=44036' rel='external nofollow' class='url'>从代码中认识RunLoop &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 现在网上关于RunLoop的资料真是太多了，而且大同小异，如果只是看一遍不在代码里面实现一下的话，也只能了解点皮毛，当然这样动笔写一些，更能加深印象。这次学习笔记参考自：链接1链接2链接3本文代码都可以下载demo调试或者自己编写测试 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-919"><a href='http://aes.jypc.org/?p=44976' rel='external nofollow' class='url'>小笨狼漫谈多线程：NSThread &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] runloop相关知识可以阅读ibireme的深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-925"><a href='http://aes.jypc.org/?p=50082' rel='external nofollow' class='url'>关于OC运行时的干货集合 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-926"><a href='http://aes.jypc.org/?p=51065' rel='external nofollow' class='url'>iOS应用程序的生命周期 &#8211; 项目经验积累与分享</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Programming Guide for iOSDeveloping iOS 7 App for iPhone and iPad深入理解RunLoopObjective-C Autorelease Pool [&#8230;]</li><!-- #comment-## -->
	<li id="comment-934"><a href='http://devthinking.com/%e7%9c%8b-cfrunloop%e6%ba%90%e7%a0%81%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3-runloop/' rel='external nofollow' class='url'>看 CFRunLoop源码深入理解 RunLoop - Shawn Du&#039;s Blog</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-956"><a href='http://bkcoding.cn/archives/2686.html' rel='external nofollow' class='url'>RunLoop 总结：RunLoop的应用场景（二） | BkCoding</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop(不要看到右边滚动条很长，其实文章占篇幅2/5左右，下面有很多的评论，可见这篇文章的火热) [&#8230;]</li><!-- #comment-## -->
	<li id="comment-958"><a href='http://bkcoding.cn/archives/7113.html' rel='external nofollow' class='url'>使用 ASDK 性能调优 &#8211; 提升 iOS 界面的渲染性能 | BkCoding</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解 RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-959"><a href='http://bkcoding.cn/archives/7316.html' rel='external nofollow' class='url'>从源码看runLoop | BkCoding</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-965"><a href='http://www.appdu.cn/wp/blog/2017/02/21/%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3runloop/' rel='external nofollow' class='url'>深入理解RunLoop &#8211; Chen&#039;s Blog</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7.2' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-972"><a href='http://www.uu3aa.com/a/19744' rel='external nofollow' class='url'>RunLoop学习笔记-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-973"><a href='http://www.uu3aa.com/a/19816' rel='external nofollow' class='url'>基于runloop的线程保活、销毁与通信-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 关于runloop，还有一些更深层次拓展性的内容，包括与gcd的协同关系、AutoreleasePool的释放时机、GCDTimer和NStimer区别等等，本来是想写一写的，奈何篇幅已经很大了，实在写不动了，推荐感兴趣的可以看看YY大神这篇：深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-974"><a href='http://www.uu3aa.com/a/19832' rel='external nofollow' class='url'>RunLoop总结：RunLoop的应用场景（三）滚动视图流畅性优化-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop(不要看到右边滚动条很长，其实文章占篇幅2/5左右，下面有很多的评论，可见这篇文章的火热) [&#8230;]</li><!-- #comment-## -->
	<li id="comment-977"><a href='http://www.uu3aa.com/a/19934' rel='external nofollow' class='url'>获取任意线程调用栈的那些事-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-978"><a href='http://www.uu3aa.com/a/20118' rel='external nofollow' class='url'>iOS应用程序的生命周期-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Programming Guide for iOSDeveloping iOS 7 App for iPhone and iPad深入理解RunLoopObjective-C Autorelease Pool [&#8230;]</li><!-- #comment-## -->
	<li id="comment-980"><a href='http://www.uu3aa.com/a/20176' rel='external nofollow' class='url'>深入研究 Runloop 与线程保活-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解 RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-982"><a href='http://www.uu3aa.com/a/20468' rel='external nofollow' class='url'>RunLoop 总结：RunLoop的应用场景（二）让Timer正常运转-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop(不要看到右边滚动条很长，其实文章占篇幅2/5左右，下面有很多的评论，可见这篇文章的火热) [&#8230;]</li><!-- #comment-## -->
	<li id="comment-983"><a href='http://hack.hk.cn/2017/02/24/%e9%80%83%e4%b8%8d%e5%87%ba%e7%9a%84%e5%9c%88%e5%ad%90-runloop/' rel='external nofollow' class='url'>逃不出的圈子 -- RunLoop - 莹莹之色</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/us.png" title="United States" alt="United States" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.8' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-991"><a href='http://www.uu3aa.com/a/34710' rel='external nofollow' class='url'>看 CFRunLoop源码深入理解 RunLoop-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-992"><a href='http://www.uu3aa.com/a/34740' rel='external nofollow' class='url'>深入理解RunLoop-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-994"><a href='http://www.uu3aa.com/a/34742' rel='external nofollow' class='url'>iOS 保持界面流畅的技巧-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章 深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-997"><a href='http://www.uu3aa.com/a/34816' rel='external nofollow' class='url'>iOS 网址大全 开发资源集合-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解runloop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-998"><a href='http://www.uu3aa.com/a/34841' rel='external nofollow' class='url'>深入理解RunLoop-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop 的概念 RunLoop 与线程的关系 RunLoop 对外的接口 RunLoop 的 Mode RunLoop 的内部逻辑 RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1003"><a href='http://www.uu3aa.com/a/36819' rel='external nofollow' class='url'>逃不出的圈子 &#8212; RunLoop-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1006"><a href='http://www.shellsec.com/news/37339.html' rel='external nofollow' class='url'>iOS 常见知识点（二）：RunLoop | 神刀安全网</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.8' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] ibireme 的 深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1011"><a href='http://www.xiupinzhe.com/9975.html' rel='external nofollow' class='url'>深入研究 Runloop 与线程保活 | 秀品折</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 深入理解 RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1013"><a href='http://w2.xiupinzhe.com/17834.html' rel='external nofollow' class='url'>iOS NSTimer 为什么要配合 NSRunLoop 进行使用 | 秀品折</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 4.如果对 runLoop 的一些更详细的概念和底层实现有兴趣的，在这里我推荐两篇博客：##iOS开发-- RunLoop的基本概念与例子分析##深入理解RunLoop## [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1022"><a href='http://lipengxuan.tk/ios-%e4%bf%9d%e6%8c%81%e7%95%8c%e9%9d%a2%e6%b5%81%e7%95%85%e7%9a%84%e6%8a%80%e5%b7%a7-garan-no-dou/' rel='external nofollow' class='url'>iOS 保持界面流畅的技巧 &#8211; 木穆的博客</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7.3' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] Runloop 还不太了解，可以看一下我之前的文章 深入理解RunLoop，里面对 ASDK [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1024"><a href='http://w2.xiupinzhe.com/41441.html' rel='external nofollow' class='url'>runLoop的终极大杀器 | 秀品折</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 参考: 一个iOS菜菜的白话文记录YY大神百度孙源的runLoop视频 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1032"><a href='http://w2.xiupinzhe.com/56262.html' rel='external nofollow' class='url'>iOS里的内存泄露 | 秀品折</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 我们能看到断点1和断点2 runloop还是在执行的，断点3表示runloop一个迭代已经结束了，即将进入睡眠。这里如果对runloop不了解的话可以看ibireme的这篇深入理解RunLoop。我截取里面的一小段，大家可以看一下。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1041"><a href='http://w2.xiupinzhe.com/80069.html' rel='external nofollow' class='url'>各个线程 Autorelease 对象的内存管理 | 秀品折</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 针对第一个问题，比较容易理解，可以看一下：ibireme 的 深入理解RunLoop，主线程默认为我们开启 Runloop，Runloop 会自动帮我们创建Autoreleasepool，并进行Push、Pop 等操作来进行内存管理 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1042"><a href='http://www.shellsec.com/news/39314.html' rel='external nofollow' class='url'>基于runloop的线程保活、销毁与通信 | 神刀安全网</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/jp.png" title="Japan" alt="Japan" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.8' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 关于runloop，还有一些更深层次拓展性的内容，包括与gcd的协同关系、AutoreleasePool的释放时机、GCDTimer和NStimer区别等等，本来是想写一写的，奈何篇幅已经很大了，实在写不动了，推荐感兴趣的可以看看YY大神这篇：深入理解RunLoop [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1043"><a href='http://w2.xiupinzhe.com/87041.html' rel='external nofollow' class='url'>iOS多线程 | 秀品折</a>  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.3.1' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 先来看一张表示这5个类的关系图（来源：http://blog.ibireme.com/2015/05/18/runloop/）。 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1045"><a href='http://www.uu3aa.com/a/51860' rel='external nofollow' class='url'>从VVeboTableViewDemo到YYAsyncLayer（二）-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.5' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop：深入理解RunLoopiOS线下分享《RunLoop》iOS RunLoop 编程手册 （译） runloop原理 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1052"><a href='http://www.uu3aa.com/a/75442' rel='external nofollow' class='url'>老司机出品——源码解析之RunLoop详解-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.5' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] ————引自深入理解RunLoop  [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1057"><a href='http://lnvov.com/8580.html' rel='external nofollow' class='url'>深入理解Runloop，看我一篇就够了 | 澪动科技</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.7.4' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 实在太多了，如果大家对runloop想有更深层次的了解，大家可以看看YYKit的作者写的这篇文章：深入理解RunLoop  其中介绍了与GCD的协同关系、AutoreleasePool的释放时机、GCDTimer与NSTimer还有CADisplayLink的区别等等，并举出AFNetworking和AsyncDisplayKit的实际应用，对提升很有帮助。  最后的最后，奉上一个runloop的小demo，通过监听runloop的状态，优化图片加载，地址是：RunLoopDemo [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1059"><a href='http://www.uu3aa.com/a/86951' rel='external nofollow' class='url'>SDWebImage 源码阅读笔记-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] http://blog.ibireme.com/2015/05/18/runloop/ [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1062"><a href='http://www.uu3aa.com/a/87860' rel='external nofollow' class='url'>深入理解RunLoop-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop 的概念 RunLoop 与线程的关系 RunLoop 对外的接口 RunLoop 的 Mode RunLoop 的内部逻辑 RunLoop 的底层实现 苹果用 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1063"><a href='http://www.uu3aa.com/a/87860' rel='external nofollow' class='url'>深入理解RunLoop-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] RunLoop 的概念 RunLoop 与线程的关系 RunLoop 对外的接口 RunLoop 的 Mode RunLoop 的内部逻辑 RunLoop 的底层实现 苹果用 RunLoop 实现的功能 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1065"><a href='http://www.uu3aa.com/a/96409' rel='external nofollow' class='url'>iOS-autorelease与autoreleasepool-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 参考资料官方文档黑幕背后的Autorelease深入理解RunLoopObjective-C Autorelease Pool 的实现原理 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1066"><a href='http://www.uu3aa.com/a/96849' rel='external nofollow' class='url'>iOS-RunLoop浅析-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 参考资料:CF框架源码RunLoop 原理和核心机制CoreFoundation深入理解RunLoop滑动卡顿优化官方文档 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1067"><a href='http://www.uu3aa.com/a/96849' rel='external nofollow' class='url'>iOS-RunLoop浅析-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 参考资料:CF框架源码RunLoop 原理和核心机制CoreFoundation深入理解RunLoop滑动卡顿优化官方文档 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1072"><a href='http://www.uu3aa.com/a/126387' rel='external nofollow' class='url'>Re:从零开始的RunLoop实践01-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] http://blog.ibireme.com/2015/05/18/runloop/ 此篇为RunLoop写的相当好的一篇 强烈建议大家学习 也希望我早日能写出这种技术博文 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1073"><a href='http://www.uu3aa.com/a/126401' rel='external nofollow' class='url'>Re:从零开始的Runloop实践02-使用ports 或custom input sources 和其他线程通信-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] http://www.jianshu.com/p/4d5b6fc33519http://blog.ibireme.com/2015/05/18/runloop/ [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1078"><a href='http://www.uu3aa.com/a/142280' rel='external nofollow' class='url'>关于Runloop的原理探究及基本使用-IT文库</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 参考文章：官方文档经典runloop技术文：深入理解RunLooprunloop源码分析（runloop几个重要的函数源码阅读）：Runloop源码分析Mach相关：Mach消息发送机制进程间通信 (OSX/iOS)其他：runloop嵌套：NSRunLoop原理详解——不再有盲点 Cocoa深入学习:NSOperationQueue、NSRunLoop和线程安全源码解析之RunLoop详解ios开发－－RunLoop 与GCD 、Autorelease Pool之间的关系 [&#8230;]</li><!-- #comment-## -->
	<li id="comment-1098"><a href='http://life4school.com/%e4%b8%81%e9%a6%99%e5%9b%adios%e7%94%b5%e8%af%9d%e9%9d%a2%e8%af%95%e9%97%ae%e9%a2%98%e6%80%bb%e7%bb%93/' rel='external nofollow' class='url'>丁香园iOS电话面试问题总结 | 恰同学少年-不称</a> <img src="https://blog.ibireme.com/wp-content/plugins/show-useragent/flags/cn.png" title="China" alt="China" class="country-flag" /> <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/wp.png' title='WordPress 4.6.6' alt='WordPress' width='14px' height='14px' class='browser-icon' />  <img src='https://blog.ibireme.com/wp-content/plugins/show-useragent/browsers/other.png' title='Unknow Os ' alt='Unknow Os' width='14px' height='14px' class='os-icon' />  - [&#8230;] 超级棒的文章地址 [&#8230;]</li><!-- #comment-## -->
				</ol>
			</div>
							<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"><span>提交评论</span> <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2015/05/18/runloop/#respond" style="display:none;">取消回复</a></small></h3>			<form action="https://blog.ibireme.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
				<p class="comment-notes"><span id="email-notes">电子邮件地址不会被公开。</span> 必填项已用<span class="required">*</span>标注</p><p class="comment-form-comment"><label for="comment">评论</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">姓名 <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p>
<p class="comment-form-email"><label for="email">电子邮件 <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p>
<p class="comment-form-url"><label for="url">站点</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /><label for="wp-comment-cookies-consent">在此浏览器中保存我的名字、电邮和网站。</label></p>
<div id="wp-smileyblock"></div>
		<p class="math-captcha-form">
			<label>验证码<br/></label>
			<span><input type="text" size="2" length="2" id="mc-input" class="mc-input" name="mc-value" value="" aria-required="true"/> &#215; &#x35; = &#x32;&#48;</span>
		</p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit et_pb_button" value="提交评论" /> <input type='hidden' name='comment_post_ID' value='41710' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p>			</form>
			</div><!-- #respond -->
	
    <script>
		/* <![CDATA[ */
		var smileyarray = [ 
		]; 

		jQuery(document).ready(function($) {
		$('a[id*="s-"]').click(function() { // any anchor with an id that begins with "s-" is clickable
		$("#comment").insertAtCaret(smileyarray[this.id.substr(2)]); // insert the appropriate code into the textarea
		});
		});
	</script>	</section>					</div> <!-- .et_post_meta_wrapper -->
				</article> <!-- .et_pb_post -->

										</div> <!-- #left-area -->

				<div id="sidebar">
		<div id="aboutmewidget-5" class="et_pb_widget widget_aboutmewidget"><h4 class="widgettitle">关于</h4>		<div class="clearfix">
			<img src="" id="about-image" alt="" />
			伽蓝之堂——<br />一只魔法师的工坊		</div> <!-- end about me section -->
	</div> <!-- end .et_pb_widget --><div id="text-2" class="et_pb_widget widget_text"><h4 class="widgettitle">相关链接</h4>			<div class="textwidget"><ul>
<li><a href="http://github.com/ibireme/" target="_blank" rel="noopener noreferrer">Github</a></li>
<li><a href="http://weibo.com/ibireme" target="_blank" rel="noopener noreferrer">Weibo</a></li>
<li><a href="https://twitter.com/ibireme" target="_blank" rel="noopener noreferrer">Twitter</a></li>
<li><a href="https://www.linkedin.com/in/ibireme/" target="_blank" rel="noopener noreferrer">LinkedIn</a></li>
<li><a href="http://ibireme.deviantart.com/" target="_blank" rel="noopener noreferrer">DeviantART</a></li>
</ul>
</div>
		</div> <!-- end .et_pb_widget --><div id="meta-2" class="et_pb_widget widget_meta"><h4 class="widgettitle">功能</h4>			<ul>
						<li><a href="https://blog.ibireme.com/wp-login.php">登录</a></li>
			<li><a href="https://blog.ibireme.com/feed/">文章<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://blog.ibireme.com/comments/feed/">评论<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://cn.wordpress.org/" title="基于WordPress，一个优美、先进的个人信息发布平台。">WordPress.org</a></li>			</ul>
			</div> <!-- end .et_pb_widget -->	</div> <!-- end #sidebar -->
		</div> <!-- #content-area -->
	</div> <!-- .container -->
</div> <!-- #main-content -->


			<footer id="main-footer">
				

		
				<div id="footer-bottom">
					<div class="container clearfix">
				
						<p id="copyright">
							Copyright 2018 ibireme
						</p>
					</div>	<!-- .container -->
				</div>
			</footer> <!-- #main-footer -->
		</div> <!-- #et-main-area -->


	</div> <!-- #page-container -->

	<!-- Baidu Analytics -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6f3007d3fe15244980eff589f9d78063";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-43017647-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-43017647-1');
</script>
<!-- WP Audio player plugin v1.9.6 - https://www.tipsandtricks-hq.com/wordpress-audio-music-player-plugin-4556/ -->
    <script type="text/javascript">
        soundManager.useFlashBlock = true; // optional - if used, required flashblock.css
        soundManager.url = 'https://blog.ibireme.com/wp-content/plugins/compact-wp-audio-player/swf/soundmanager2.swf';
        function play_mp3(flg, ids, mp3url, volume, loops)
        {
            //Check the file URL parameter value
            var pieces = mp3url.split("|");
            if (pieces.length > 1) {//We have got an .ogg file too
                mp3file = pieces[0];
                oggfile = pieces[1];
                //set the file URL to be an array with the mp3 and ogg file
                mp3url = new Array(mp3file, oggfile);
            }

            soundManager.createSound({
                id: 'btnplay_' + ids,
                volume: volume,
                url: mp3url
            });

            if (flg == 'play') {
                    soundManager.play('btnplay_' + ids, {
                    onfinish: function() {
                        if (loops == 'true') {
                            loopSound('btnplay_' + ids);
                        }
                        else {
                            document.getElementById('btnplay_' + ids).style.display = 'inline';
                            document.getElementById('btnstop_' + ids).style.display = 'none';
                        }
                    }
                });
            }
            else if (flg == 'stop') {
    //soundManager.stop('btnplay_'+ids);
                soundManager.pause('btnplay_' + ids);
            }
        }
        function show_hide(flag, ids)
        {
            if (flag == 'play') {
                document.getElementById('btnplay_' + ids).style.display = 'none';
                document.getElementById('btnstop_' + ids).style.display = 'inline';
            }
            else if (flag == 'stop') {
                document.getElementById('btnplay_' + ids).style.display = 'inline';
                document.getElementById('btnstop_' + ids).style.display = 'none';
            }
        }
        function loopSound(soundID)
        {
            window.setTimeout(function() {
                soundManager.play(soundID, {onfinish: function() {
                        loopSound(soundID);
                    }});
            }, 1);
        }
        function stop_all_tracks()
        {
            soundManager.stopAll();
            var inputs = document.getElementsByTagName("input");
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].id.indexOf("btnplay_") == 0) {
                    inputs[i].style.display = 'inline';//Toggle the play button
                }
                if (inputs[i].id.indexOf("btnstop_") == 0) {
                    inputs[i].style.display = 'none';//Hide the stop button
                }
            }
        }
    </script>
    <script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/includes/builder/scripts/frontend-builder-global-functions.js?ver=2.5.3'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-includes/js/comment-reply.min.js?ver=5.2.5'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/js/custom.js?ver=2.5.3'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/includes/builder/scripts/jquery.fitvids.js?ver=2.5.3'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/includes/builder/scripts/waypoints.min.js?ver=2.5.3'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/includes/builder/scripts/jquery.magnific-popup.js?ver=2.5.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var et_custom = {"ajaxurl":"https:\/\/blog.ibireme.com\/wp-admin\/admin-ajax.php","images_uri":"https:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/images","builder_images_uri":"https:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/includes\/builder\/images","et_load_nonce":"f69ededbf4","subscription_failed":"Please, check the fields below to make sure you entered the correct information.","fill":"Fill","field":"field","invalid":"Invalid email","captcha":"Captcha","prev":"Prev","previous":"\u4e0a\u4e00\u9875","next":"\u4e0b\u4e00\u9875","is_builder_plugin_used":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/includes/builder/scripts/frontend-builder-scripts.js?ver=2.5.3'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-includes/js/wp-embed.min.js?ver=5.2.5'></script>
</body>
</html>
